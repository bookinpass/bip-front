<div *ngIf="loading" class="main-loader">
  <p>Veuillez patienter SVP!</p>
</div>

<div *ngIf="!loading" class="ui form container mt-4 mb-2">
  <div class="ui horizontal stackable segments d-flex flex-column flex-lg-row step-1 p-2">
    <div class="ui divided items raised segment">
      <div class="item">
        <div class="ui medium rectangle image">
          <img [src]="eventImage" alt="">
        </div>
        <div class="content">
          <a class="header">{{event.designation}}</a>
          <div class="description d-flex flex-column">
            <p><span>Type</span>: {{event.eventType}}</p>
            <p><span>Lieu</span>: {{event.place.designation}}</p>
            <p><span>Début</span>: {{event.startingDate | date: 'EEEE, dd MMMM yyyy' | titlecase}} a
              {{event.startingTime}}</p>
            <p><span>Fin</span>: {{event.endingDate | date: 'EEEE, dd MMMM yyyy' | titlecase}} a
              {{event.endingTime}}</p>
          </div>
        </div>
      </div>
      <div class="item d-flex flex-column">
        <p class="font-weight-bold underlined h5">Description:</p>
        <p class="h5 font-weight-normal">{{event.description}}</p>
      </div>
    </div>
    <div class="ui raised segment p-2" style="width: 80px">
      <div class="ui dividing header h4">Billet disponible</div>
      <div *ngFor="let item of sortPricing()" class="d-flex flex-column">
        <h5 class="ui horizontal divider header"><i class="ticket icon"></i>{{item.description | titlecase}}</h5>
        <p class="d-flex flex-row w-100 justify-content-between">
          <span>Prix</span>
          <span>{{item.price}}</span>
        </p>
        <p class="d-flex flex-row w-100 justify-content-between">
          <span>Ticket Restant</span>
          <span>{{!item.remainingTicket ? item.totalTickets : item.remainingTicket <= 0 ? 'Sold out' : item.remainingTicket}}</span>
        </p>
      </div>
    </div>
  </div>

  <div *ngIf="currentStep === 1" class="ui raised segment">
    <div class="ui dividing header">Ajout de ticket a mon panier</div>
    <div class="ui form">
      <div class="ui fields d-flex flex-column flex-lg-row">
        <div class="required field">
          <label>Type du billet</label>
          <select (change)="updateSelectedTicketType()" [(ngModel)]="cartTicket.type" class="ui search selection dropdown"
                  name="ticketType">
            <option value="">Séléctionner</option>
            <option *ngFor="let item of filteredPricing()" [ngClass]="itemExistInCart(item) ? 'd-none' : ''"
                    [value]="item.description">{{item.description | titlecase}}</option>
          </select>
        </div>
        <div class="required field">
          <label>Nombre de billet</label>
          <select (change)="cartTicket.totalPrice = cartTicket.unitPrice * cartTicket.amount" [(ngModel)]="cartTicket.amount"
                  [disabled]="cartTicket.type  === '' &&  cartTicket.unitPrice  === 0" class="ui selection dropdown" name="amount">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
        </div>
        <div class="field">
          <label>Prix unitaire</label>
          <input [value]="cartTicket.unitPrice | currency: 'XOF': 'symbol-narrow': '1.1-2'"
                 placeholder="Prix unitaire" readonly type="text">
        </div>
        <div class="field">
          <label>Prix total</label>
          <input [value]="cartTicket.totalPrice | currency: 'XOF': 'symbol-narrow': '1.1-2'"
                 readonly type="text">
        </div>
        <div class="field d-flex flex-row justify-content-end align-items-end ui two wide column sixteen wide tablet mt-2 mt-lg-0">
          <div (click)="cartTicket.amount > 0 ? addToCart() : ''"
               [ngClass]="cartTicket.amount > 0 && cartTicket.type !== '' ? 'blue vertical animated' : 'grey cursor-default'"
               class="ui button">
            <div *ngIf="cartTicket.amount > 0 && cartTicket.type !== ''" class="hidden content"><i class="shop icon"></i></div>
            <div class="visible content">Ajouter</div>
          </div>
        </div>
      </div>
    </div>
    <!-- End of Adding to cart-->

    <!-- Display Cart -->
    <div class="ui dividing header">Mon panier</div>
    <table class="ui black striped very compact stackable celled five column table">
      <thead>
      <tr>
        <th class="text-center">Type</th>
        <th class="text-center">Nombre</th>
        <th class="text-center">Prix unitaire</th>
        <th class="text-center">Prix Total</th>
        <th class="text-center">Action</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngIf="cart.length === 0">
        <td class="text-center h4 text-dark" colspan="5">Votre panier est vide</td>
      </tr>
      <tr *ngFor="let item of cart">
        <td>{{item.type}}</td>
        <td class="text-right">{{item.amount}}</td>
        <td class="text-right">{{item.unitPrice | currency: 'XOF': 'symbol-narrow': '1.1-2'}}</td>
        <td class="text-right">{{item.totalPrice | currency: 'XOF': 'symbol-narrow': '1.1-2'}}</td>
        <td class="d-flex flex-row justify-content-around w-100 ui one column">
          <button (click)="editItem(item)" class="ui icon button text-primary">
            <i class="pencil icon"></i>
          </button>
          <button (click)="deleteItem(item)" class="ui icon button text-danger">
            <i class="trash icon"></i>
          </button>
        </td>
      </tr>
      </tbody>
      <tfoot *ngIf="cart.length > 0">
      <tr>
        <th>Total</th>
        <th class="text-right">{{cartTotalTicket()}}</th>
        <th></th>
        <th class="text-right">{{cartTotalPrice() | currency: 'XOF': 'symbol-narrow': '1.1-2'}}</th>
        <th></th>
      </tr>
      </tfoot>
    </table>
    <!-- end of displaying cart -->
    <!--    Recaptcha-->
    <re-captcha (resolved)="resolvedCaptcha($event)" *ngIf="cart.length > 0" badge="inline"
                siteKey="6Ld2j84UAAAAAJkyoD4lsZIF2oy4iO1JJOiXh3Fj"></re-captcha>
    <!--    end recaptcha-->
  </div>

  <div *ngIf="currentStep === 2" class="step-2">
    <!--    <app-core-payment-v2-->
    <!--      (goBack)="previousStep()"-->
    <!--      (persons)="persons = $event"-->
    <!--      [cart]="cart"-->
    <!--      [description]="'Vos tickets de ' + event.eventType"-->
    <!--      [event]="event"-->
    <!--      [fromCurrency]="currency"-->
    <!--      [image]="eventImage"-->
    <!--      [name]="'Billet de '+ event.eventType + ' ' + event.designation"-->
    <!--      [price]="cartTotalPrice()"></app-core-payment-v2>-->
  </div>
</div>
