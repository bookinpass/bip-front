<div class="ui form container mt-4">
  <div *ngIf="loading" class="ui active dimmer">
    <div class="ui massive text loader">Loading</div>
  </div>
  <div class="ui tablet stackable steps fluid d-md-none">
    <div [ngClass]="currentStep === 1 ? '' : 'disabled'" class="step">
      <i class="calendar icon"></i>
      <div class="content">
        <div class="title">Date</div>
        <div class="description">Séléctionner une date</div>
      </div>
    </div>
    <div [ngClass]="currentStep === 2 ? '' : 'disabled'" class="step">
      <i class="payment icon"></i>
      <div class="content">
        <div class="title">Paiement</div>
        <div class="description">Entrer vos informations</div>
      </div>
    </div>
    <div [ngClass]="currentStep === 3 ? '' : 'disabled'" class="step">
      <i class="info icon"></i>
      <div class="content">
        <div class="title">Confirmation</div>
      </div>
    </div>
  </div>

  <div *ngIf="currentStep === 1" class="d-flex flex-column flex-lg-row justify-content-center justify-content-lg-around step-1">
    <div class="pr-lg-4">
      <div class="d-flex flex-row justify-content-around">
        <div
          (viewDateChange)="closeOpenMonthViewDay()"
          [(viewDate)]="viewDate"
          [view]="view"
          class="ui grey button"
          mwlCalendarPreviousView>
          Mois Précédent
        </div>
        <div>
          <p class="mb-0 h4 text-capitalize">{{ viewDate | calendarDate:(view + 'ViewTitle'):'fr' }}</p>
        </div>
        <div
          (viewDateChange)="closeOpenMonthViewDay()"
          [(viewDate)]="viewDate"
          [view]="view"
          class="ui violet button"
          mwlCalendarNextView>
          Mois suivant
        </div>
      </div>
      <div [ngSwitch]="view">
        <mwl-calendar-month-view
          (dayClicked)="dayClicked($event.day)"
          (eventClicked)="eventClicked($event)"
          *ngSwitchCase="CalendarView.Month"
          [activeDayIsOpen]="activeDayIsOpen"
          [events]="events"
          [refresh]="refresh"
          [viewDate]="viewDate" [weekStartsOn]="1">
        </mwl-calendar-month-view>
      </div>
    </div>
    <div class="ui form mt-lg-5">
      <div class="field">
        <p class="h5 mb-3" style="color: #00004a"><span class="mb-0 underlined font-weight-bold">Itineraire</span>:
          {{from | titlecase}} - {{to | titlecase}}
        </p>
      </div>
      <div class="field">
        <p class="h5 mb-3" style="color: #00004a"><span class="mb-0 underlined font-weight-bold"> Départ</span>:
          <span *ngIf="selectedDate">{{selectedDate | date: 'EEEE, dd MMMM yyyy' | titlecase}} à
            {{selectedDate | date: 'HH:mm'}}</span>
        </p>
      </div>
      <div class="field">
        <p class="h5 mb-3" style="color: #00004a"><span class="mb-0 underlined font-weight-bold"> Prix par passager</span>:
          {{unitPrice | currency : 'XOF' : 'symbol-narrow' : '1.1-2'}}
        </p>
      </div>
      <div class="required field">
        <label>Passager(s)</label>
        <input [(ngModel)]="passengers" max="5" min="1" name="adult" type="number">
      </div>
      <div class="field">
        <p class="h5 mb-3" style="color: #00004a"><span class="mb-0 underlined font-weight-bold"> Prix Total</span>:
          {{unitPrice * passengers | currency : 'XOF' : 'symbol-narrow' : '1.1-2'}}
        </p>
      </div>
      <div *ngIf="from.startsWith('Zig') || to.startsWith('Zig')" class="ui list h6">
        <p class="item mb-0">
          La présentation de la pièce d’identité ou du passeport en cours de validité est obligatoire sur ce trajet. Il est obligatoire
          pour chaque enfant un extrait de naissance s’il est accompagné de ses parents biologiques ou une autorisation parentale si
          l’enfant est accompagné d’une personne autre que ses parents.
        </p>
        <p class="item mb-0">Les enfants et mineurs ne voyagent pas seuls.</p>
        <p class="item mb-0">Bien vérifier les informations indiquées sur votre titre de voyage après achat.
          BookIn Pass et Sénégal Dem Dikk NE RÉPONDRONT À AUCUNE RÉCLAMATION en cas d’erreur sur votre billet le jour de votre voyage.</p>
        <p class="item mb-0">Nous vous conseillons de vous présenter une heure avant votre voyage.
          <span class="font-weight-bolder">Le ticket est non remboursable en cas de retard.</span></p>
        <p class="item mb-0">Les bagages ne sont pas gratuits. Mais chaque passager a droit à une valisette.</p>
      </div>
      <div class="field">
        <div (click)="checkData()" class="ui orange button">Suivant</div>
      </div>
    </div>
  </div>
  <div *ngIf="currentStep === 2"
       class="d-flex flex-column flex-lg-row justify-content-center justify-content-lg-around step-2">
    <app-core-payment (loading)="setLoading($event)"
                      (transactionDetails)="updatePaymentData($event)"
                      (transactionDetailsEmitter)="onPaymentSucceed($event)"
                      (transactionErrorEmitter)="onPaymentError($event)"
                      (updateStep)="updateStep($event)"
                      [description]="'Vos tickets de transport ' + from + ' - ' + to + '.'"
                      [fromCurrency]="'XOF'"
                      [name]="'Ticket Bus Senegal Dem Dikk'"
                      [numberOfOtherTravelers]="passengers - 1"
                      [price]="unitPrice * passengers"
                      [quantity]="'1'"></app-core-payment>
  </div>
  <div *ngIf="currentStep === 3" class="d-flex flex-column flex-lg-row justify-content-center justify-content-lg-around step-3">
    <div class="d-flex flex-row justify-content-around w-100">
      <div>
        <h3 class="ui dividing header underlined mt-2">Récapitulatif</h3>
        <div class="field">
          <p class="h5 mb-2 mt-2" style="color: #00004a"><span class="mb-0 underlined font-weight-bold"> ID Transaction</span>:
            {{paymentData.orderId}}</p>
        </div>
        <div class="field">
          <p class="h5 mb-2" style="color: #00004a"><span class="mb-0 underlined font-weight-bold"> Itineraire</span>:
            {{from}} - {{to}}</p>
        </div>
        <div class="field">
          <p class="h5 mb-2" style="color: #00004a"><span class="mb-0 underlined font-weight-bold">Départ</span>:
            {{selectedDate | date: 'EEEE, dd MMMM yyyy à HH:mm'}}
          </p>
        </div>
        <div class="field">
          <p class="h5 mb-2" style="color: #00004a"><span class="mb-0 underlined font-weight-bold">Prix unitaire</span>:
            {{unitPrice | currency: 'XOF' : 'symbol-narrow' : '1.1-2'}}</p>
        </div>
        <div class="field">
          <p class="h5 mb-2" style="color: #00004a"><span class="mb-0 underlined font-weight-bold">Nombre de passager</span>:
            {{passengers}}</p>
        </div>
        <div class="field">
          <p class="h5 mb-2" style="color: #00004a"><span class="mb-0 underlined font-weight-bold">Prix total</span>:
            {{unitPrice * passengers | currency: 'XOF' : 'symbol-narrow' : '1.1-2'}}</p>
        </div>
      </div>

      <div class="d-flex flex-column">
        <div class="d-flex flex-column justify-content-center align-items-center mb-2" id="ticket-container">
          <div>
            <img alt="sen-dd bus img" src="../../assets/images/icons/sen-dd.jpg" width="200px"/>
          </div>
          <p class="h6 mb-1"><span class="underlined">Date</span>: {{selectedDate | date : 'dd/MM/yy à HH:mm'}}</p>
          <p class="h6 mb-1"><span class="underlined">Prix</span>:
            {{unitPrice * passengers | currency: 'XOF' : 'symbol-narrow' : '1.1-2'}}</p>
          <p class="font-weight-bolder h7 mb-1">Ce ticket est non remboursable.</p>
          <div class="d-flex justify-content-center align-item center">
            <qrcode [allowEmptyString]="false" [elementType]="'url'" [errorCorrectionLevel]="'H'"
                    [qrdata]="generatedID" [version]="10" [width]="150"></qrcode>
          </div>
          <p class="text-right h7 underlined w-100">Vendu par BookinPass</p>
        </div>
        <div (click)="captureScreen()" class="ui button floating right orange aligned h4">Télécharger</div>
      </div>
    </div>
  </div>
</div>
