<div class="ui form container mt-4">
  <div *ngIf="loading" class="ui active dimmer">
    <div class="ui massive text loader">Loading</div>
  </div>
  <div class="ui tablet stackable steps fluid d-md-none">
    <div [ngClass]="currentStep === 1 ? '' : 'disabled'" class="step">
      <i class="calendar icon"></i>
      <div class="content">
        <div class="title">Date</div>
        <div class="description">Séléctionner une date</div>
      </div>
    </div>
    <div [ngClass]="currentStep === 2 ? '' : 'disabled'" class="step">
      <i class="payment icon"></i>
      <div class="content">
        <div class="title">Paiement</div>
        <div class="description">Entrer vos informations</div>
      </div>
    </div>
    <div [ngClass]="currentStep === 3 ? '' : 'disabled'" class="step">
      <i class="info icon"></i>
      <div class="content">
        <div class="title">Confirmation</div>
      </div>
    </div>
  </div>

  <div *ngIf="currentStep === 1" class="d-flex flex-column flex-lg-row justify-content-center justify-content-lg-around step-1">
    <div>
      <div class="d-flex flex-row justify-content-around">
        <div
          (viewDateChange)="closeOpenMonthViewDay()"
          [(viewDate)]="viewDate"
          [view]="view"
          class="ui grey button"
          mwlCalendarPreviousView>
          Mois Précédent
        </div>
        <div>
          <p class="mb-0 h4 text-capitalize">{{ viewDate | calendarDate:(view + 'ViewTitle'):'fr' }}</p>
        </div>
        <div
          (viewDateChange)="closeOpenMonthViewDay()"
          [(viewDate)]="viewDate"
          [view]="view"
          class="ui violet button"
          mwlCalendarNextView>
          Mois suivant
        </div>
      </div>
      <div [ngSwitch]="view">
        <mwl-calendar-month-view
          (dayClicked)="dayClicked($event.day)"
          (eventClicked)="eventClicked($event)"
          *ngSwitchCase="CalendarView.Month"
          [activeDayIsOpen]="activeDayIsOpen"
          [events]="events"
          [refresh]="refresh"
          [viewDate]="viewDate" [weekStartsOn]="1">
        </mwl-calendar-month-view>
      </div>
    </div>
    <div class="ui form">
      <hr width="mt-3 w-75">
      <div class="field">
        <p class="h5 mb-3" style="color: #00004a"><span class="mb-0 underlined font-weight-bold"> Départ</span>:
          {{getDate() | date: 'EEEE, dd MMMM yyyy' | titlecase }}
          {{selectedDate ? 'a ' + departTime + 'h:00' : '' }}</p>
        <p class="h5 mb-3" style="color: #00004a"><span class="mb-0 underlined font-weight-bold"> Bateau</span>:
          {{selectedBoat || null}}</p>
        <div *ngIf="this.selectedBoat.length > 1" class="ui ordered list h7">
          <p class="item mb-0">{{selectedBoat.toLowerCase().startsWith('ali') ?
            'Jusqu\'a 200 KG de bagage authorisé dont 20 KG de bagage a main.' : '20KG de bagage authorisé'}}</p>
          <p class="item mb-0">{{selectedBoat.toLowerCase().startsWith('ali') ? '150 fr par kilogramme d\'excédent de bagages' :
            '100 fr par kilogramme d\'excédent de bagages'}}</p>
          <p *ngIf="this.selectedBoat?.toLowerCase().startsWith('ali')" class="item mb-0">
            L'enregistrement des bagages peut se faire tous les jours de 8H30 a 17h00</p>
          <div *ngIf="!selectedBoat?.toLowerCase().startsWith('ali')" class="item">
            <p class="item mb-0">Enregistrement des vos bagages:</p>
            <div class="ordered list">
              <p class="item mb-0">Tous les jours sauf les mercredi</p>
              <p class="item mb-0">De 8h00 a 18h00 les Mardi, Vendredi, Samedi et Diamnche</p>
              <p class="item mb-0">De 8H00 a 15h00 les Lundi et Jeudi</p>
            </div>
          </div>
        </div>
      </div>
      <hr class="w-75">
      <div class="required field">
        <label class="font-weight-bold darkBlueLabel">Êtes-vous un résident sénégalais? </label>
        <div class="field">
          <div class="ui radio checkbox">
            <input (click)="isResident = true" [checked]="isResident" class="hidden" name="resident" tabindex="0" type="radio">
            <label (click)="isResident = true" class="cursor-pointer">Oui</label>
          </div>
          <div class="ui radio checkbox ml-3">
            <input (click)="isResident = false" [checked]="!isResident" class="hidden" name="resident" tabindex="0" type="radio">
            <label (click)="isResident = false" class="cursor-pointer">Non</label>
          </div>
        </div>
      </div>

      <div class="required field">
        <label>Classe</label>
        <select (change)="setSelectedPrice()" *ngIf="isResident" [(ngModel)]="idClass" class="ui fluid dropdown"
                name="class">
          <option value="">Séléctionner</option>
          <option *ngFor="let item of dkrZig.resident" [value]="item.type">{{item.description | titlecase}},
            {{item.price | currency: dkrZig.currency : 'symbol-narrow' : '1.1-2' : 'fr'}}</option>
        </select>
        <select (change)="setSelectedPrice()" *ngIf="!isResident" [(ngModel)]="idClass" class="ui fluid dropdown" name="class">
          <option value="">Séléctionner</option>
          <option *ngFor="let item of dkrZig['non-resident']" [value]="item.type">{{item.description | titlecase}},
            {{item.price | currency: dkrZig.currency : 'symbol-narrow' : '1.1-2' : 'fr'}}</option>
        </select>
      </div>

      <div class="field">
        <label>Nombre de cabine</label>
        <select [(ngModel)]="cabine" class="ui fluid dropdown" name="class">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>

      <p class="w-100 ">Nombre de voyageur</p>
      <div class="required field">
        <label>Adulte (+12 ans)</label>
        <input [(ngModel)]="adult" max="5" min="1" name="adult" type="number">
      </div>
      <div class="required field">
        <label>Enfant (-12 ans)</label>
        <input [(ngModel)]="child" max="5" min="0" name="child" type="number">
      </div>
      <p class="mb-0">Les enfants qui ont entre 2 et 11 ans ne paieront que la moitié du prix de vente en vigeur</p>
      <p>Les enfants qui ont moins de 2 ans sont exemptés de ticket de transport</p>

      <p class="w-100">Bagage en soute</p>
      <div class="field">
        <label>Véhicule</label>
        <div class="ui right labeled input">
          <input [(ngModel)]="car" min="0" placeholder="Nombre de vehicule" type="number">
          <div class="ui violet label">
            Frais: {{dkrZig.soute[0].price | currency: dkrZig.currency: 'symbol-narrow': '1.1-2'}}
          </div>
        </div>
      </div>
      <div class="field">
        <label>Moto</label>
        <div class="ui right labeled input">
          <input [(ngModel)]="bike" min="0" placeholder="Nombre de moto" type="number">
          <div class="ui violet label">
            Frais: {{dkrZig.soute[1].price | currency: dkrZig.currency: 'symbol-narrow': '1.1-2'}}
          </div>
        </div>
      </div>
      <div class="ui animated fade button" tabindex="0">
        <div class="visible content"><i class="shop icon"></i></div>
        <div class="hidden content">
          Procéder au paiement
        </div>
      </div>
      <button (click)="proceedToPayment()" class="ui left floated orange button">Valider</button>
    </div>
  </div>
  <div *ngIf="currentStep === 2"
       class="d-flex flex-column flex-lg-row justify-content-center justify-content-lg-around step-2">
    <app-core-payment (loading)="setLoading($event)"
                      (transactionDetails)="updatePaymentData($event)"
                      (transactionDetailsEmitter)="onPaymentSucceed($event)"
                      (transactionErrorEmitter)="onPaymentError($event)"
                      (updateStep)="updateStep($event)"
                      [description]="'Vos tickets de transport maritime,' + selectedClass.description"
                      [fromCurrency]="dkrZig.currency"
                      [name]="'Billet de transport ' + departure + ' - ' + arrival"
                      [numberOfOtherTravelers]="(adult+child) - 1"
                      [price]="setPrice()"
                      [quantity]="'1'"></app-core-payment>
  </div>
  <div *ngIf="currentStep === 3" class="d-flex flex-column flex-lg-row justify-content-center justify-content-lg-around step-3">
    <div class="d-flex flex-row justify-content-around w-100">
      <div>
        <h3 class="ui dividing header underlined mt-2">Récapitulatif</h3>
        <div class="field">
          <p class="h5 mb-2 mt-2" style="color: #00004a"><span class="mb-0 underlined font-weight-bold"> ID Transaction</span>:
            {{paymentData.orderId}}</p>
        </div>
        <div class="field">
          <p class="h5 mb-2" style="color: #00004a"><span class="mb-0 underlined font-weight-bold"> Itineraire</span>:
            {{departure}} - {{arrival}}</p>
        </div>
        <div class="field">
          <p class="h5 mb-2" style="color: #00004a"><span class="mb-0 underlined font-weight-bold">Départ</span>:
            {{selectedDate | date: 'EEEE, dd MMMM yyyy à HH:mm'}}
          </p>
        </div>
        <div class="field">
          <p class="h5 mb-2" style="color: #00004a"><span class="mb-0 underlined font-weight-bold">Prix unitaire</span>:
            {{selectedClass?.price | currency: 'XOF' : 'symbol-narrow' : '1.1-2'}}</p>
        </div>
        <div class="field">
          <p class="h5 mb-2" style="color: #00004a"><span class="mb-0 underlined font-weight-bold">Nombre de passager</span>:
            {{adult + child}}</p>
        </div>
        <div class="field">
          <p class="h5 mb-2" style="color: #00004a"><span class="mb-0 underlined font-weight-bold">Prix total</span>:
            {{setPrice() | currency: 'XOF' : 'symbol-narrow' : '1.1-2'}}</p>
        </div>
      </div>

      <div class="d-flex flex-column">
        <div class="d-flex flex-column justify-content-center align-items-center mb-2" id="ticket-container">
          <div>
            <img alt="cruize dkr-zig" src="../../assets/images/icons/dkr_zig.jpg" width="200px"/>
          </div>
          <p class="h6 mb-1"><span class="underlined">Date</span>: {{selectedDate | date : 'dd/MM/yy à HH:mm'}}</p>
          <p class="h6 mb-1"><span class="underlined">Prix</span>:
            {{setPrice() | currency: 'XOF' : 'symbol-narrow' : '1.1-2'}}</p>
          <p class="font-weight-bolder h7 mb-1">Ce ticket est non remboursable.</p>
          <div class="d-flex justify-content-center align-item center">
            <qrcode [allowEmptyString]="false" [elementType]="'url'" [errorCorrectionLevel]="'H'"
                    [qrdata]="generatedID" [version]="10" [width]="150"></qrcode>
          </div>
          <p class="text-right h7 underlined w-100">Vendu par BookinPass</p>
        </div>
        <div (click)="captureScreen()" class="ui button floating right orange aligned h4">Télécharger</div>
      </div>
    </div>
  </div>
</div>
