<div class="content-wrapper">
  <p class="m-0" mat-dialog-title>
    <mat-card-title matDialogTitle>{{enterCode ? 'Activation du compte' : 'Inscription'}}
      <fa-icon (click)="dialogRef.close(false)" [icon]="faClose" class="float-right cursor-pointer"></fa-icon>
    </mat-card-title>
  </p>
  <div *ngIf="!enterCode" [ngClass]="loading ? 'loading' : ''" class="ui form">
    <div [ngClass]="validationError.includes('firstName') ? 'error' : ''" class="ui field required">
      <label>Prénom</label>
      <input [(ngModel)]="user.firstName" name="firstName" placeholder="Prénom" type="text"/>
    </div>

    <div [ngClass]="validationError.includes('lastName') ? 'error' : ''" class="ui field required">
      <label>Nom</label>
      <input [(ngModel)]="user.lastName" name="lastName" placeholder="Nom" type="text"/>
    </div>

    <div [ngClass]="validationError.includes('email') ? 'error' : ''" class="ui field">
      <label>Email</label>
      <input [(ngModel)]="user.email" name="email" placeholder="Email" type="text"/>
    </div>

    <div [ngClass]="validationError.includes('username') ? 'error' : ''" class="ui field required">
      <label>Nom d'utilisateur</label>
      <input [(ngModel)]="user.credential.username" name="username" placeholder="Nom d'utilisateur" type="text"/>
    </div>

    <div [ngClass]="validationError.includes('password') ? 'error' : ''" class="ui field required">
      <label>Mot de passe</label>
      <div class="ui icon input">
        <input (blur)="verifyPassword()" (focusin)="displayPasswordHint = true" (focusout)="displayPasswordHint = false"
               (keyup)="setPasswordStatus()" [(ngModel)]="user.credential.password" [type]="showPassword ? 'text' : 'password'"
               autocomplete="false" name="password" placeholder="*******"/>
        <i (click)="showPassword = !showPassword" [ngClass]="showPassword ? 'eye slash icon' : 'eye icon'" class="cursor-pointer"
           style="pointer-events: auto"></i>
      </div>
      <div *ngIf="displayPasswordHint" class="d-flex flex-column bubble">
        <div>
          <fa-icon [icon]="passwordArrayValidator.includes('min') ? faClose : faCheck"></fa-icon>
          Minimum 8 caractères
        </div>
        <div>
          <fa-icon [icon]="passwordArrayValidator.includes('uppercase') ? faClose : faCheck"></fa-icon>
          Au moins une majuscule
        </div>
        <div>
          <fa-icon [icon]="passwordArrayValidator.includes('lowercase') ? faClose : faCheck"></fa-icon>
          Au moins une minuscule
        </div>
        <div>
          <fa-icon [icon]="passwordArrayValidator.includes('digits') ? faClose : faCheck"></fa-icon>
          Au moins un chiffre
        </div>
      </div>
    </div>

    <div class="ui field required">
      <label>Séléctionner votre pays</label>
      <select (change)="updateDialCode()" [(ngModel)]="user.country" class="ui selection dropdown" name="countrySelect">
        <option *ngFor="let ctr of countries" [selected]="ctr.code === user.country" [value]="ctr.code">{{ctr.name}}</option>
      </select>
    </div>

    <div [ngClass]="validationError.includes('telephone') ? 'error' : ''" class="ui field required">
      <label>Téléphone</label>
      <div class="ui labeled input">
        <div class="ui basic label">{{dialCode}}</div>
        <input (blur)="verifyPhoneNumber()" (keyup)="formatNumber()" [(ngModel)]="user.telephone" name="telephone" placeholder="Téléphone"
               type="tel">
      </div>
      <div *ngIf="!isPhoneNumberValid" class="mat-error">
        Ce numéro de téléphone n'est pas valide pour le pays séléctionnné.
      </div>
    </div>
    <div matDialogActions>
      <div class="ui grey button" matDialogClose>Annuler</div>
      <div (click)="save()" class="ui green button">Enregistrer</div>
    </div>
  </div>
  <div *ngIf="enterCode" [ngClass]="loading ? 'loading' : ''" class="ui form">
    <div class="field">
      <label>Entrer le code de verification</label>
      <input [(ngModel)]="code" placeholder="Code de verification" type="text"/>
    </div>
    <div (click)="loading = true; validateAccount()" class="ui green button mb-2">Valider</div>
  </div>
</div>
