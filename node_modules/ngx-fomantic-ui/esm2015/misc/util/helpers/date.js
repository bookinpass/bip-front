/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Util } from './util';
/** @enum {number} */
const DatePrecision = {
    Decade: 0,
    Year: 1,
    Month: 2,
    Date: 3,
    Hour: 4,
    Minute: 5,
};
export { DatePrecision };
DatePrecision[DatePrecision.Decade] = 'Decade';
DatePrecision[DatePrecision.Year] = 'Year';
DatePrecision[DatePrecision.Month] = 'Month';
DatePrecision[DatePrecision.Date] = 'Date';
DatePrecision[DatePrecision.Hour] = 'Hour';
DatePrecision[DatePrecision.Minute] = 'Minute';
/** @type {?} */
export const DateUtil = {
    /**
     * @param {?} precision
     * @param {?} date
     * @param {?=} resetAll
     * @return {?}
     */
    startOf(precision, date, resetAll = false) {
        switch (precision) {
            case DatePrecision.Decade:
                /** @type {?} */
                const start = Math.floor(date.getFullYear() / 10) * 10 + 1;
                date.setFullYear(start);
                if (!resetAll) {
                    break;
                }
            // falls through
            case DatePrecision.Year:
                date.setMonth(0);
                if (!resetAll) {
                    break;
                }
            // falls through
            case DatePrecision.Month:
                date.setDate(1);
                if (!resetAll) {
                    break;
                }
            // falls through
            case DatePrecision.Date:
                date.setHours(0);
                if (!resetAll) {
                    break;
                }
            // falls through
            case DatePrecision.Hour:
                date.setMinutes(0);
                if (!resetAll) {
                    break;
                }
            // falls through
            case DatePrecision.Minute:
                date.setSeconds(0, 0);
        }
        return date;
    },
    /**
     * @param {?} precision
     * @param {?} date
     * @return {?}
     */
    endOf(precision, date) {
        switch (precision) {
            case DatePrecision.Year:
                date.setMonth(12, 0);
            // falls through
            case DatePrecision.Month:
                date.setMonth(date.getMonth() + 1, 0);
            // falls through
            case DatePrecision.Date:
                date.setHours(23, 59, 59, 999);
                break;
            case DatePrecision.Hour:
                date.setMinutes(59, 59, 999);
                break;
            case DatePrecision.Minute:
                date.setSeconds(59, 999);
                break;
        }
        return date;
    },
    /**
     * @param {?} precision
     * @param {?} a
     * @param {?} b
     * @return {?}
     */
    equal(precision, a, b) {
        /** @type {?} */
        let equal = true;
        switch (precision) {
            case DatePrecision.Minute:
                equal = equal && a.getMinutes() === b.getMinutes();
            // falls through
            case DatePrecision.Hour:
                equal = equal && a.getHours() === b.getHours();
            // falls through
            case DatePrecision.Date:
                equal = equal && a.getDate() === b.getDate();
            // falls through
            case DatePrecision.Month:
                equal = equal && a.getMonth() === b.getMonth();
            // falls through
            case DatePrecision.Year:
                equal = equal && a.getFullYear() === b.getFullYear();
        }
        return equal;
    },
    /**
     * @param {?} precision
     * @param {?} date
     * @return {?}
     */
    next(precision, date) {
        return DateUtil.add(precision, date, 1);
    },
    /**
     * @param {?} precision
     * @param {?} date
     * @param {?} i
     * @return {?}
     */
    add(precision, date, i) {
        /** @type {?} */
        const year = date.getFullYear();
        /** @type {?} */
        const month = date.getMonth();
        /** @type {?} */
        const day = date.getDate();
        switch (precision) {
            case DatePrecision.Decade:
                date.setFullYear(year + i * 10);
                if (date.getMonth() !== month) {
                    date.setDate(0);
                }
                break;
            case DatePrecision.Year:
                date.setFullYear(year + i);
                if (date.getMonth() !== month) {
                    date.setDate(0);
                }
                break;
            case DatePrecision.Month:
                date.setMonth(month + i);
                if (date.getMonth() !== Util.Math.mod(month + i, 12)) {
                    date.setDate(0);
                }
                break;
            case DatePrecision.Date:
                date.setDate(day + i);
                break;
            case DatePrecision.Hour:
                date.setHours(date.getHours() + i);
                break;
            case DatePrecision.Minute:
                date.setMinutes(date.getMinutes() + i);
                break;
        }
        return date;
    },
    /**
     * @param {?} precision
     * @param {?} date
     * @return {?}
     */
    previous(precision, date) {
        /** @type {?} */
        const year = date.getFullYear();
        /** @type {?} */
        const month = date.getMonth();
        /** @type {?} */
        const day = date.getDate();
        switch (precision) {
            case DatePrecision.Decade:
                date.setFullYear(year - 10);
                if (date.getMonth() !== month) {
                    date.setDate(0);
                }
                break;
            case DatePrecision.Year:
                date.setFullYear(year - 1);
                if (date.getMonth() !== month) {
                    date.setDate(0);
                }
                break;
            case DatePrecision.Month:
                date.setMonth(month - 1);
                if (date.getMonth() !== Util.Math.mod(month - 1, 12)) {
                    date.setDate(0);
                }
                break;
            case DatePrecision.Date:
                date.setDate(day - 1);
                break;
            case DatePrecision.Hour:
                /** @type {?} */
                const hours = date.getHours();
                date.setHours(hours - 1);
                if (date.getHours() !== Util.Math.mod(hours - 1, 24)) {
                    date.setHours(hours - 2);
                }
                break;
            case DatePrecision.Minute:
                /** @type {?} */
                const minutes = date.getMinutes();
                date.setMinutes(minutes - 1);
        }
        return date;
    },
    /**
     * @param {?} date
     * @return {?}
     */
    clone(date) {
        return new Date(date.getTime());
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1mb21hbnRpYy11aS8iLCJzb3VyY2VzIjpbIm1pc2MvdXRpbC9oZWxwZXJzL2RhdGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBQyxJQUFJLEVBQUMsTUFBTSxRQUFRLENBQUM7OztJQUcxQixTQUFVO0lBQ1YsT0FBUTtJQUNSLFFBQVM7SUFDVCxPQUFRO0lBQ1IsT0FBUTtJQUNSLFNBQVU7Ozs7Ozs7Ozs7QUFHWixNQUFNLE9BQU8sUUFBUSxHQUFHOzs7Ozs7O0lBQ3RCLE9BQU8sQ0FBQyxTQUF3QixFQUFFLElBQVUsRUFBRSxXQUFvQixLQUFLO1FBQ3JFLFFBQVEsU0FBUyxFQUFFO1lBQ2pCLEtBQUssYUFBYSxDQUFDLE1BQU07O3NCQUNqQixLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUM7Z0JBQzFELElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ3hCLElBQUksQ0FBQyxRQUFRLEVBQUU7b0JBQ2IsTUFBTTtpQkFDUDtZQUNILGdCQUFnQjtZQUNoQixLQUFLLGFBQWEsQ0FBQyxJQUFJO2dCQUNyQixJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNqQixJQUFJLENBQUMsUUFBUSxFQUFFO29CQUNiLE1BQU07aUJBQ1A7WUFDSCxnQkFBZ0I7WUFDaEIsS0FBSyxhQUFhLENBQUMsS0FBSztnQkFDdEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDaEIsSUFBSSxDQUFDLFFBQVEsRUFBRTtvQkFDYixNQUFNO2lCQUNQO1lBQ0gsZ0JBQWdCO1lBQ2hCLEtBQUssYUFBYSxDQUFDLElBQUk7Z0JBQ3JCLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2pCLElBQUksQ0FBQyxRQUFR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LElBQUk7Z0JBQ3JCLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUN0QixNQUFNO1lBQ1IsS0FBSyxhQUFhLENBQUMsSUFBSTs7c0JBQ2YsS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUU7Z0JBQzdCLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUN6QixJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUUsS0FBSyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFO29CQUNwRCxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztpQkFDMUI7Z0JBQ0QsTUFBTTtZQUNSLEtBQUssYUFBYSxDQUFDLE1BQU07O3NCQUNqQixPQUFPLEdBQUcsSUFBSSxDQUFDLFVBQVUsRUFBRTtnQkFDakMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLENBQUM7U0FDaEM7UUFDRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7Ozs7O0lBRUQsS0FBSyxDQUFDLElBQVU7UUFDZCxPQUFPLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO0lBQ2xDLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7VXRpbH0gZnJvbSAnLi91dGlsJztcclxuXHJcbmV4cG9ydCBlbnVtIERhdGVQcmVjaXNpb24ge1xyXG4gIERlY2FkZSA9IDAsXHJcbiAgWWVhciA9IDEsXHJcbiAgTW9udGggPSAyLFxyXG4gIERhdGUgPSAzLFxyXG4gIEhvdXIgPSA0LFxyXG4gIE1pbnV0ZSA9IDVcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IERhdGVVdGlsID0ge1xyXG4gIHN0YXJ0T2YocHJlY2lzaW9uOiBEYXRlUHJlY2lzaW9uLCBkYXRlOiBEYXRlLCByZXNldEFsbDogYm9vbGVhbiA9IGZhbHNlKTogRGF0ZSB7XHJcbiAgICBzd2l0Y2ggKHByZWNpc2lvbikge1xyXG4gICAgICBjYXNlIERhdGVQcmVjaXNpb24uRGVjYWRlOlxyXG4gICAgICAgIGNvbnN0IHN0YXJ0ID0gTWF0aC5mbG9vcihkYXRlLmdldEZ1bGxZZWFyKCkgLyAxMCkgKiAxMCArIDE7XHJcbiAgICAgICAgZGF0ZS5zZXRGdWxsWWVhcihzdGFydCk7XHJcbiAgICAgICAgaWYgKCFyZXNldEFsbCkge1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAvLyBmYWxscyB0aHJvdWdoXHJcbiAgICAgIGNhc2UgRGF0ZVByZWNpc2lvbi5ZZWFyOlxyXG4gICAgICAgIGRhdGUuc2V0TW9udGgoMCk7XHJcbiAgICAgICAgaWYgKCFyZXNldEFsbCkge1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAvLyBmYWxscyB0aHJvdWdoXHJcbiAgICAgIGNhc2UgRGF0ZVByZWNpc2lvbi5Nb250aDpcclxuICAgICAgICBkYXRlLnNldERhdGUoMSk7XHJcbiAgICAgICAgaWYgKCFyZXNldEFsbCkge1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAvLyBmYWxscyB0aHJvdWdoXHJcbiAgICAgIGNhc2UgRGF0ZVByZWNpc2lvbi5EYXRlOlxyXG4gICAgICAgIGRhdGUuc2V0SG91cnMoMCk7XHJcbiAgICAgICAgaWYgKCFyZXNldEFsbCkge1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAvLyBmYWxscyB0aHJvdWdoXHJcbiAgICAgIGNhc2UgRGF0ZVByZWNpc2lvbi5Ib3VyOlxyXG4gICAgICAgIGRhdGUuc2V0TWludXRlcygwKTtcclxuICAgICAgICBpZiAoIXJlc2V0QWxsKSB7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgIC8vIGZhbGxzIHRocm91Z2hcclxuICAgICAgY2FzZSBEYXRlUHJlY2lzaW9uLk1pbnV0ZTpcclxuICAgICAgICBkYXRlLnNldFNlY29uZHMoMCwgMCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGRhdGU7XHJcbiAgfSxcclxuXHJcbiAgZW5kT2YocHJlY2lzaW9uOiBEYXRlUHJlY2lzaW9uLCBkYXRlOiBEYXRlKTogRGF0ZSB7XHJcbiAgICBzd2l0Y2ggKHByZWNpc2lvbikge1xyXG4gICAgICBjYXNlIERhdGVQcmVjaXNpb24uWWVhcjpcclxuICAgICAgICBkYXRlLnNldE1vbnRoKDEyLCAwKTtcclxuICAgICAgLy8gZmFsbHMgdGhyb3VnaFxyXG4gICAgICBjYXNlIERhdGVQcmVjaXNpb24uTW9udGg6XHJcbiAgICAgICAgZGF0ZS5zZXRNb250aChkYXRlLmdldE1vbnRoKCkgKyAxLCAwKTtcclxuICAgICAgLy8gZmFsbHMgdGhyb3VnaFxyXG4gICAgICBjYXNlIERhdGVQcmVjaXNpb24uRGF0ZTpcclxuICAgICAgICBkYXRlLnNldEhvdXJzKDIzLCA1OSwgNTksIDk5OSk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgRGF0ZVByZWNpc2lvbi5Ib3VyOlxyXG4gICAgICAgIGRhdGUuc2V0TWludXRlcyg1OSwgNTksIDk5OSk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgRGF0ZVByZWNpc2lvbi5NaW51dGU6XHJcbiAgICAgICAgZGF0ZS5zZXRTZWNvbmRzKDU5LCA5OTkpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBkYXRlO1xyXG4gIH0sXHJcblxyXG4gIGVxdWFsKHByZWNpc2lvbjogRGF0ZVByZWNpc2lvbiwgYTogRGF0ZSwgYjogRGF0ZSk6IGJvb2xlYW4ge1xyXG4gICAgbGV0IGVxdWFsID0gdHJ1ZTtcclxuICAgIHN3aXRjaCAocHJlY2lzaW9uKSB7XHJcbiAgICAgIGNhc2UgRGF0ZVByZWNpc2lvbi5NaW51dGU6XHJcbiAgICAgICAgZXF1YWwgPSBlcXVhbCAmJiBhLmdldE1pbnV0ZXMoKSA9PT0gYi5nZXRNaW51dGVzKCk7XHJcbiAgICAgIC8vIGZhbGxzIHRocm91Z2hcclxuICAgICAgY2FzZSBEYXRlUHJlY2lzaW9uLkhvdXI6XHJcbiAgICAgICAgZXF1YWwgPSBlcXVhbCAmJiBhLmdldEhvdXJzKCkgPT09IGIuZ2V0SG91cnMoKTtcclxuICAgICAgLy8gZmFsbHMgdGhyb3VnaFxyXG4gICAgICBjYXNlIERhdGVQcmVjaXNpb24uRGF0ZTpcclxuICAgICAgICBlcXVhbCA9IGVxdWFsICYmIGEuZ2V0RGF0ZSgpID09PSBiLmdldERhdGUoKTtcclxuICAgICAgLy8gZmFsbHMgdGhyb3VnaFxyXG4gICAgICBjYXNlIERhdGVQcmVjaXNpb24uTW9udGg6XHJcbiAgICAgICAgZXF1YWwgPSBlcXVhbCAmJiBhLmdldE1vbnRoKCkgPT09IGIuZ2V0TW9udGgoKTtcclxuICAgICAgLy8gZmFsbHMgdGhyb3VnaFxyXG4gICAgICBjYXNlIERhdGVQcmVjaXNpb24uWWVhcjpcclxuICAgICAgICBlcXVhbCA9IGVxdWFsICYmIGEuZ2V0RnVsbFllYXIoKSA9PT0gYi5nZXRGdWxsWWVhcigpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGVxdWFsO1xyXG4gIH0sXHJcblxyXG4gIG5leHQocHJlY2lzaW9uOiBEYXRlUHJlY2lzaW9uLCBkYXRlOiBEYXRlKTogRGF0ZSB7XHJcbiAgICByZXR1cm4gRGF0ZVV0aWwuYWRkKHByZWNpc2lvbiwgZGF0ZSwgMSk7XHJcbiAgfSxcclxuXHJcbiAgYWRkKHByZWNpc2lvbjogRGF0ZVByZWNpc2lvbiwgZGF0ZTogRGF0ZSwgaTogbnVtYmVyKTogRGF0ZSB7XHJcbiAgICBjb25zdCB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpO1xyXG4gICAgY29uc3QgbW9udGggPSBkYXRlLmdldE1vbnRoKCk7XHJcbiAgICBjb25zdCBkYXkgPSBkYXRlLmdldERhdGUoKTtcclxuXHJcbiAgICBzd2l0Y2ggKHByZWNpc2lvbikge1xyXG4gICAgICBjYXNlIERhdGVQcmVjaXNpb24uRGVjYWRlOlxyXG4gICAgICAgIGRhdGUuc2V0RnVsbFllYXIoeWVhciArIGkgKiAxMCk7XHJcbiAgICAgICAgaWYgKGRhdGUuZ2V0TW9udGgoKSAhPT0gbW9udGgpIHtcclxuICAgICAgICAgIGRhdGUuc2V0RGF0ZSgwKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgRGF0ZVByZWNpc2lvbi5ZZWFyOlxyXG4gICAgICAgIGRhdGUuc2V0RnVsbFllYXIoeWVhciArIGkpO1xyXG4gICAgICAgIGlmIChkYXRlLmdldE1vbnRoKCkgIT09IG1vbnRoKSB7XHJcbiAgICAgICAgICBkYXRlLnNldERhdGUoMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIERhdGVQcmVjaXNpb24uTW9udGg6XHJcbiAgICAgICAgZGF0ZS5zZXRNb250aChtb250aCArIGkpO1xyXG4gICAgICAgIGlmIChkYXRlLmdldE1vbnRoKCkgIT09IFV0aWwuTWF0aC5tb2QobW9udGggKyBpLCAxMikpIHtcclxuICAgICAgICAgIGRhdGUuc2V0RGF0ZSgwKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgRGF0ZVByZWNpc2lvbi5EYXRlOlxyXG4gICAgICAgIGRhdGUuc2V0RGF0ZShkYXkgKyBpKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSBEYXRlUHJlY2lzaW9uLkhvdXI6XHJcbiAgICAgICAgZGF0ZS5zZXRIb3VycyhkYXRlLmdldEhvdXJzKCkgKyBpKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSBEYXRlUHJlY2lzaW9uLk1pbnV0ZTpcclxuICAgICAgICBkYXRlLnNldE1pbnV0ZXMoZGF0ZS5nZXRNaW51dGVzKCkgKyBpKTtcclxuICAgICAgICBicmVhaztcclxuICAgIH1cclxuICAgIHJldHVybiBkYXRlO1xyXG4gIH0sXHJcblxyXG4gIHByZXZpb3VzKHByZWNpc2lvbjogRGF0ZVByZWNpc2lvbiwgZGF0ZTogRGF0ZSk6IERhdGUge1xyXG4gICAgY29uc3QgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTtcclxuICAgIGNvbnN0IG1vbnRoID0gZGF0ZS5nZXRNb250aCgpO1xyXG4gICAgY29uc3QgZGF5ID0gZGF0ZS5nZXREYXRlKCk7XHJcblxyXG4gICAgc3dpdGNoIChwcmVjaXNpb24pIHtcclxuICAgICAgY2FzZSBEYXRlUHJlY2lzaW9uLkRlY2FkZTpcclxuICAgICAgICBkYXRlLnNldEZ1bGxZZWFyKHllYXIgLSAxMCk7XHJcbiAgICAgICAgaWYgKGRhdGUuZ2V0TW9udGgoKSAhPT0gbW9udGgpIHtcclxuICAgICAgICAgIGRhdGUuc2V0RGF0ZSgwKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgRGF0ZVByZWNpc2lvbi5ZZWFyOlxyXG4gICAgICAgIGRhdGUuc2V0RnVsbFllYXIoeWVhciAtIDEpO1xyXG4gICAgICAgIGlmIChkYXRlLmdldE1vbnRoKCkgIT09IG1vbnRoKSB7XHJcbiAgICAgICAgICBkYXRlLnNldERhdGUoMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIERhdGVQcmVjaXNpb24uTW9udGg6XHJcbiAgICAgICAgZGF0ZS5zZXRNb250aChtb250aCAtIDEpO1xyXG4gICAgICAgIGlmIChkYXRlLmdldE1vbnRoKCkgIT09IFV0aWwuTWF0aC5tb2QobW9udGggLSAxLCAxMikpIHtcclxuICAgICAgICAgIGRhdGUuc2V0RGF0ZSgwKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgRGF0ZVByZWNpc2lvbi5EYXRlOlxyXG4gICAgICAgIGRhdGUuc2V0RGF0ZShkYXkgLSAxKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSBEYXRlUHJlY2lzaW9uLkhvdXI6XHJcbiAgICAgICAgY29uc3QgaG91cnMgPSBkYXRlLmdldEhvdXJzKCk7XHJcbiAgICAgICAgZGF0ZS5zZXRIb3Vycyhob3VycyAtIDEpO1xyXG4gICAgICAgIGlmIChkYXRlLmdldEhvdXJzKCkgIT09IFV0aWwuTWF0aC5tb2QoaG91cnMgLSAxLCAyNCkpIHtcclxuICAgICAgICAgIGRhdGUuc2V0SG91cnMoaG91cnMgLSAyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgRGF0ZVByZWNpc2lvbi5NaW51dGU6XHJcbiAgICAgICAgY29uc3QgbWludXRlcyA9IGRhdGUuZ2V0TWludXRlcygpO1xyXG4gICAgICAgIGRhdGUuc2V0TWludXRlcyhtaW51dGVzIC0gMSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGF0ZTtcclxuICB9LFxyXG5cclxuICBjbG9uZShkYXRlOiBEYXRlKTogRGF0ZSB7XHJcbiAgICByZXR1cm4gbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkpO1xyXG4gIH1cclxufTtcclxuIl19