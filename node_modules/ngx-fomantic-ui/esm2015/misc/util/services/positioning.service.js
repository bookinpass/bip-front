/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import Popper from 'popper.js';
/** @type {?} */
export const PositioningPlacement = {
    Auto: (/** @type {?} */ ('auto')),
    TopLeft: (/** @type {?} */ ('top left')),
    Top: (/** @type {?} */ ('top')),
    TopRight: (/** @type {?} */ ('top right')),
    LeftTop: (/** @type {?} */ ('left top')),
    Left: (/** @type {?} */ ('left')),
    LeftBottom: (/** @type {?} */ ('left bottom')),
    BottomLeft: (/** @type {?} */ ('bottom left')),
    Bottom: (/** @type {?} */ ('bottom')),
    BottomRight: (/** @type {?} */ ('bottom right')),
    RightTop: (/** @type {?} */ ('right top')),
    Right: (/** @type {?} */ ('right')),
    RightBottom: (/** @type {?} */ ('right bottom'))
};
/**
 * @record
 */
export function IPositionBoundingBox() { }
if (false) {
    /** @type {?} */
    IPositionBoundingBox.prototype.width;
    /** @type {?} */
    IPositionBoundingBox.prototype.height;
    /** @type {?} */
    IPositionBoundingBox.prototype.top;
    /** @type {?} */
    IPositionBoundingBox.prototype.left;
    /** @type {?} */
    IPositionBoundingBox.prototype.bottom;
    /** @type {?} */
    IPositionBoundingBox.prototype.right;
}
/**
 * @param {?} placement
 * @return {?}
 */
function placementToPopper(placement) {
    if (!placement || placement === PositioningPlacement.Auto) {
        return 'auto';
    }
    // All placements of the format: `direction alignment`, e.g. `top left`.
    const [direction, alignment] = placement.split(' ');
    // Direction alone covers case of just `top`, `left`, `bottom`, `right`.
    /** @type {?} */
    const chosenPlacement = [direction];
    // Add `start` / `end` to placement, depending on alignment direction.
    switch (alignment) {
        case 'top':
        case 'left':
            chosenPlacement.push('start');
            break;
        case 'bottom':
        case 'right':
            chosenPlacement.push('end');
            break;
    }
    // Join with hyphen to create Popper compatible placement.
    return (/** @type {?} */ (chosenPlacement.join('-')));
}
/**
 * @param {?} popper
 * @return {?}
 */
function popperToPlacement(popper) {
    if (!popper || popper === 'auto') {
        return 'auto';
    }
    const [direction, alignment] = popper.split('-');
    /** @type {?} */
    const chosenPlacement = [direction];
    switch (direction) {
        case 'top':
        case 'bottom':
            switch (alignment) {
                case 'start':
                    chosenPlacement.push('left');
                    break;
                case 'end':
                    chosenPlacement.push('right');
                    break;
            }
            break;
        case 'left':
        case 'right':
            switch (alignment) {
                case 'start':
                    chosenPlacement.push('top');
                    break;
                case 'end':
                    chosenPlacement.push('bottom');
                    break;
            }
            break;
    }
    return (/** @type {?} */ (chosenPlacement.join(' ')));
}
export class PositioningService {
    /**
     * @param {?} anchor
     * @param {?} subject
     * @param {?} placement
     * @param {?=} arrowSelector
     */
    constructor(anchor, subject, placement, arrowSelector) {
        this.anchor = anchor;
        this.subject = subject;
        this._placement = placement;
        this._arrowSelector = arrowSelector;
        this.init();
    }
    /**
     * @return {?}
     */
    get actualPlacement() {
        if (!this._popperState) {
            return PositioningPlacement.Auto;
        }
        return popperToPlacement(this._popperState.placement);
    }
    /**
     * @return {?}
     */
    get state() {
        return this._popperState;
    }
    /**
     * @return {?}
     */
    get placement() {
        return this._placement;
    }
    /**
     * @param {?} placement
     * @return {?}
     */
    set placement(placement) {
        this._placement = placement;
        if (this._popper) {
            this._popper.options.placement = placementToPopper(placement);
        }
    }
    /**
     * @param {?} hasArrow
     * @return {?}
     */
    set hasArrow(hasArrow) {
        this._hasArrow = hasArrow;
    }
    /**
     * @return {?}
     */
    init() {
        /** @type {?} */
        const modifiers = {
            computeStyle: {
                gpuAcceleration: false
            },
            preventOverflow: {
                escapeWithReference: true,
                boundariesElement: document.body
            },
            arrow: {
                element: this._arrowSelector
            },
            offset: {
                fn: (/**
                 * @param {?} data
                 * @return {?}
                 */
                (data) => {
                    if (this._hasArrow) {
                        /** @type {?} */
                        const offsets = this.calculateOffsets();
                        data.offsets.popper.left += offsets.left;
                        data.offsets.popper.top += offsets.top;
                    }
                    return data;
                })
            }
        };
        if (!this._arrowSelector) {
            delete modifiers.arrow;
        }
        this._popper = (/** @type {?} */ (new Popper(this.anchor.nativeElement, this.subject.nativeElement, {
            placement: placementToPopper(this._placement),
            modifiers,
            onCreate: (/**
             * @param {?} initial
             * @return {?}
             */
            initial => this._popperState = initial),
            onUpdate: (/**
             * @param {?} update
             * @return {?}
             */
            update => this._popperState = update)
        })));
    }
    /**
     * @return {?}
     */
    update() {
        this._popper.update();
    }
    /**
     * @return {?}
     */
    destroy() {
        this._popper.destroy();
    }
    /**
     * @private
     * @return {?}
     */
    calculateOffsets() {
        /** @type {?} */
        let left = 0;
        /** @type {?} */
        let top = 0;
        // To support correct positioning for all popup sizes we should calculate offset using em
        /** @type {?} */
        const fontSize = parseFloat(window.getComputedStyle(this.subject.nativeElement).getPropertyValue('font-size'));
        // The Fomantic UI popup arrow width and height are 0.71428571em and the margin from the popup edge is 1em
        /** @type {?} */
        const arrowCenter = (0.71428571 / 2 + 1) * fontSize;
        if (this.anchor.nativeElement.offsetWidth <= arrowCenter * 2) {
            /** @type {?} */
            const anchorCenterWidth = this.anchor.nativeElement.offsetWidth / 2;
            if (this._placement === PositioningPlacement.TopLeft || this._placement === PositioningPlacement.BottomLeft) {
                left = anchorCenterWidth - arrowCenter;
            }
            if (this._placement === PositioningPlacement.TopRight || this._placement === PositioningPlacement.BottomRight) {
                left = arrowCenter - anchorCenterWidth;
            }
        }
        if (this.anchor.nativeElement.offsetHeight <= arrowCenter * 2) {
            /** @type {?} */
            const anchorCenterHeight = this.anchor.nativeElement.offsetHeight / 2;
            if (this._placement === PositioningPlacement.LeftTop || this._placement === PositioningPlacement.RightTop) {
                top = anchorCenterHeight - arrowCenter;
            }
            if (this._placement === PositioningPlacement.LeftBottom || this._placement === PositioningPlacement.RightBottom) {
                top = arrowCenter - anchorCenterHeight;
            }
        }
        return { top, left, width: 0, height: 0 };
    }
}
if (false) {
    /** @type {?} */
    PositioningService.prototype.anchor;
    /** @type {?} */
    PositioningService.prototype.subject;
    /**
     * @type {?}
     * @private
     */
    PositioningService.prototype._popper;
    /**
     * @type {?}
     * @private
     */
    PositioningService.prototype._popperState;
    /**
     * @type {?}
     * @private
     */
    PositioningService.prototype._arrowSelector;
    /**
     * @type {?}
     * @private
     */
    PositioningService.prototype._placement;
    /**
     * @type {?}
     * @private
     */
    PositioningService.prototype._hasArrow;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9zaXRpb25pbmcuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1mb21hbnRpYy11aS8iLCJzb3VyY2VzIjpbIm1pc2MvdXRpbC9zZXJ2aWNlcy9wb3NpdGlvbmluZy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFDQSxPQUFPLE1BQW1ELE1BQU0sV0FBVyxDQUFDOztBQW1CNUUsTUFBTSxPQUFPLG9CQUFvQixHQUFHO0lBQ2xDLElBQUksRUFBRSxtQkFBQSxNQUFNLEVBQXdCO0lBQ3BDLE9BQU8sRUFBRSxtQkFBQSxVQUFVLEVBQXdCO0lBQzNDLEdBQUcsRUFBRSxtQkFBQSxLQUFLLEVBQXdCO0lBQ2xDLFFBQVEsRUFBRSxtQkFBQSxXQUFXLEVBQXdCO0lBQzdDLE9BQU8sRUFBRSxtQkFBQSxVQUFVLEVBQXdCO0lBQzNDLElBQUksRUFBRSxtQkFBQSxNQUFNLEVBQXdCO0lBQ3BDLFVBQVUsRUFBRSxtQkFBQSxhQUFhLEVBQXdCO0lBQ2pELFVBQVUsRUFBRSxtQkFBQSxhQUFhLEVBQXdCO0lBQ2pELE1BQU0sRUFBRSxtQkFBQSxRQUFRLEVBQXdCO0lBQ3hDLFdBQVcsRUFBRSxtQkFBQSxjQUFjLEVBQXdCO0lBQ25ELFFBQVEsRUFBRSxtQkFBQSxXQUFXLEVBQXdCO0lBQzdDLEtBQUssRUFBRSxtQkFBQSxPQUFPLEVBQXdCO0lBQ3RDLFdBQVcsRUFBRSxtQkFBQSxjQUFjLEVBQXdCO0NBQ3BEOzs7O0FBRUQsMENBT0M7OztJQU5DLHFDQUFjOztJQUNkLHNDQUFlOztJQUNmLG1DQUFZOztJQUNaLG9DQUFhOztJQUNiLHNDQUFlOztJQUNmLHFDQUFjOzs7Ozs7QUFHaEIsU0FBUyxpQkFBaUIsQ0FBQyxTQUErQjtJQUN4RCxJQUFJLENBQUMsU0FBUyxJQUFJLFNBQVMsS0FBSyxvQkFBb0IsQ0FBQyxJQUFJLEVBQUU7UUFDekQsT0FBTyxNQUFNLENBQUM7S0FDZjs7VUFHSyxDQUFDLFNBQVMsRUFBRSxTQUFTLENBQUMsR0FB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QUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsWUFBWSxJQUFJLFdBQVcsR0FBRyxDQUFDLEVBQUU7O2tCQUN2RCxrQkFBa0IsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxZQUFZLEdBQUcsQ0FBQztZQUNyRSxJQUFJLElBQUksQ0FBQyxVQUFVLEtBQUssb0JBQW9CLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxVQUFVLEtBQUssb0JBQW9CLENBQUMsUUFBUSxFQUFFO2dCQUN6RyxHQUFHLEdBQUcsa0JBQWtCLEdBQUcsV0FBVyxDQUFDO2FBQ3hDO1lBQ0QsSUFBSSxJQUFJLENBQUMsVUFBVSxLQUFLLG9CQUFvQixDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsVUFBVSxLQUFLLG9CQUFvQixDQUFDLFdBQVcsRUFBRTtnQkFDL0csR0FBRyxHQUFHLFdBQVcsR0FBRyxrQkFBa0IsQ0FBQzthQUN4QztTQUNGO1FBQ0QsT0FBTyxFQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFDLENBQUM7SUFDMUMsQ0FBQztDQUVGOzs7SUEzSEMsb0NBQW1DOztJQUNuQyxxQ0FBb0M7Ozs7O0lBQ3BDLHFDQUFnQzs7Ozs7SUFDaEMsMENBQTJCOzs7OztJQUMzQiw0Q0FBMkM7Ozs7O0lBc0IzQyx3Q0FBeUM7Ozs7O0lBYXpDLHVDQUEyQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7RWxlbWVudFJlZn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCBQb3BwZXIsIHtEYXRhLCBNb2RpZmllcnMsIFBsYWNlbWVudCwgUG9wcGVyT3B0aW9uc30gZnJvbSAncG9wcGVyLmpzJztcclxuXHJcbnR5cGUgUG9wcGVyTW9kaWZpZXJzID0gTW9kaWZpZXJzICYge1xyXG4gIGNvbXB1dGVTdHlsZT86IHtcclxuICAgIGdwdUFjY2VsZXJhdGlvbjogYm9vbGVhbjtcclxuICB9O1xyXG59O1xyXG50eXBlIFBvcHBlckluc3RhbmNlID0gUG9wcGVyICYge1xyXG4gIG9wdGlvbnM6IFBvcHBlck9wdGlvbnMgJiB7XHJcbiAgICBtb2RpZmllcnM6IFBvcHBlck1vZGlmaWVycztcclxuICB9O1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgUG9zaXRpb25pbmdQbGFjZW1lbnQgPSAnYXV0bycgfFxyXG4gICd0b3AgbGVmdCcgfCAndG9wJyB8ICd0b3AgcmlnaHQnIHxcclxuICAnYm90dG9tIGxlZnQnIHwgJ2JvdHRvbScgfCAnYm90dG9tIHJpZ2h0JyB8XHJcbiAgJ2xlZnQgdG9wJyB8ICdsZWZ0JyB8ICdsZWZ0IGJvdHRvbScgfFxyXG4gICdyaWdodCB0b3AnIHwgJ3JpZ2h0JyB8ICdyaWdodCBib3R0b20nO1xyXG5cclxuZXhwb3J0IGNvbnN0IFBvc2l0aW9uaW5nUGxhY2VtZW50ID0ge1xyXG4gIEF1dG86ICdhdXRvJyBhcyBQb3NpdGlvbmluZ1BsYWNlbWVudCxcclxuICBUb3BMZWZ0OiAndG9wIGxlZnQnIGFzIFBvc2l0aW9uaW5nUGxhY2VtZW50LFxyXG4gIFRvcDogJ3RvcCcgYXMgUG9zaXRpb25pbmdQbGFjZW1lbnQsXHJcbiAgVG9wUmlnaHQ6ICd0b3AgcmlnaHQnIGFzIFBvc2l0aW9uaW5nUGxhY2VtZW50LFxyXG4gIExlZnRUb3A6ICdsZWZ0IHRvcCcgYXMgUG9zaXRpb25pbmdQbGFjZW1lbnQsXHJcbiAgTGVmdDogJ2xlZnQnIGFzIFBvc2l0aW9uaW5nUGxhY2VtZW50LFxyXG4gIExlZnRCb3R0b206ICdsZWZ0IGJvdHRvbScgYXMgUG9zaXRpb25pbmdQbGFjZW1lbnQsXHJcbiAgQm90dG9tTGVmdDogJ2JvdHRvbSBsZWZ0JyBhcyBQb3NpdGlvbmluZ1BsYWNlbWVudCxcclxuICBCb3R0b206ICdib3R0b20nIGFzIFBvc2l0aW9uaW5nUGxhY2VtZW50LFxyXG4gIEJvdHRvbVJpZ2h0OiAnYm90dG9tIHJpZ2h0JyBhcyBQb3NpdGlvbmluZ1BsYWNlbWVudCxcclxuICBSaWdodFRvcDogJ3JpZ2h0IHRvcCcgYXMgUG9zaXRpb25pbmdQbGFjZW1lbnQsXHJcbiAgUmlnaHQ6ICdyaWdodCcgYXMgUG9zaXRpb25pbmdQbGFjZW1lbnQsXHJcbiAgUmlnaHRCb3R0b206ICdyaWdodCBib3R0b20nIGFzIFBvc2l0aW9uaW5nUGxhY2VtZW50XHJcbn07XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIElQb3NpdGlvbkJvdW5kaW5nQm94IHtcclxuICB3aWR0aDogbnVtYmVyO1xyXG4gIGhlaWdodDogbnVtYmVyO1xyXG4gIHRvcDogbnVtYmVyO1xyXG4gIGxlZnQ6IG51bWJlcjtcclxuICBib3R0b206IG51bWJlcjtcclxuICByaWdodDogbnVtYmVyO1xyXG59XHJcblxyXG5mdW5jdGlvbiBwbGFjZW1lbnRUb1BvcHBlcihwbGFjZW1lbnQ6IFBvc2l0aW9uaW5nUGxhY2VtZW50KTogUGxhY2VtZW50IHtcclxuICBpZiAoIXBsYWNlbWVudCB8fCBwbGFjZW1lbnQgPT09IFBvc2l0aW9uaW5nUGxhY2VtZW50LkF1dG8pIHtcclxuICAgIHJldHVybiAnYXV0byc7XHJcbiAgfVxyXG5cclxuICAvLyBBbGwgcGxhY2VtZW50cyBvZiB0aGUgZm9ybWF0OiBgZGlyZWN0aW9uIGFsaWdubWVudGAsIGUuZy4gYHRvcCBsZWZ0YC5cclxuICBjb25zdCBbZGlyZWN0aW9uLCBhbGlnbm1lbnRdID0gcGxhY2VtZW50LnNwbGl0KCcgJyk7XHJcblxyXG4gIC8vIERpcmVjdGlvbiBhbG9uZSBjb3ZlcnMgY2FzZSBvZiBqdXN0IGB0b3BgLCBgbGVmdGAsIGBib3R0b21gLCBgcmlnaHRgLlxyXG4gIGNvbnN0IGNob3NlblBsYWNlbWVudCA9IFtkaXJlY3Rpb25dO1xyXG5cclxuICAvLyBBZGQgYHN0YXJ0YCAvIGBlbmRgIHRvIHBsYWNlbWVudCwgZGVwZW5kaW5nIG9uIGFsaWdubWVudCBkaXJlY3Rpb24uXHJcbiAgc3dpdGNoIChhbGlnbm1lbnQpIHtcclxuICAgIGNhc2UgJ3RvcCc6XHJcbiAgICBjYXNlICdsZWZ0JzpcclxuICAgICAgY2hvc2VuUGxhY2VtZW50LnB1c2goJ3N0YXJ0Jyk7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAnYm90dG9tJzpcclxuICAgIGNhc2UgJ3JpZ2h0JzpcclxuICAgICAgY2hvc2VuUGxhY2VtZW50LnB1c2goJ2VuZCcpO1xyXG4gICAgICBicmVhaztcclxuICB9XHJcblxyXG4gIC8vIEpvaW4gd2l0aCBoeXBoZW4gdG8gY3JlYXRlIFBvcHBlciBjb21wYXRpYmxlIHBsYWNlbWVudC5cclxuICByZXR1cm4gY2hvc2VuUGxhY2VtZW50LmpvaW4oJy0nKSBhcyBQbGFjZW1lbnQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHBvcHBlclRvUGxhY2VtZW50KHBvcHBlcjogc3RyaW5nKTogUG9zaXRpb25pbmdQbGFjZW1lbnQge1xyXG4gIGlmICghcG9wcGVyIHx8IHBvcHBlciA9PT0gJ2F1dG8nKSB7XHJcbiAgICByZXR1cm4gJ2F1dG8nO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgW2RpcmVjdGlvbiwgYWxpZ25tZW50XSA9IHBvcHBlci5zcGxpdCgnLScpO1xyXG5cclxuICBjb25zdCBjaG9zZW5QbGFjZW1lbnQgPSBbZGlyZWN0aW9uXTtcclxuXHJcbiAgc3dpdGNoIChkaXJlY3Rpb24pIHtcclxuICAgIGNhc2UgJ3RvcCc6XHJcbiAgICBjYXNlICdib3R0b20nOlxyXG4gICAgICBzd2l0Y2ggKGFsaWdubWVudCkge1xyXG4gICAgICAgIGNhc2UgJ3N0YXJ0JzpcclxuICAgICAgICAgIGNob3NlblBsYWNlbWVudC5wdXNoKCdsZWZ0Jyk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdlbmQnOlxyXG4gICAgICAgICAgY2hvc2VuUGxhY2VtZW50LnB1c2goJ3JpZ2h0Jyk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBicmVhaztcclxuICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgY2FzZSAncmlnaHQnOlxyXG4gICAgICBzd2l0Y2ggKGFsaWdubWVudCkge1xyXG4gICAgICAgIGNhc2UgJ3N0YXJ0JzpcclxuICAgICAgICAgIGNob3NlblBsYWNlbWVudC5wdXNoKCd0b3AnKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ2VuZCc6XHJcbiAgICAgICAgICBjaG9zZW5QbGFjZW1lbnQucHVzaCgnYm90dG9tJyk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBicmVhaztcclxuICB9XHJcblxyXG4gIHJldHVybiBjaG9zZW5QbGFjZW1lbnQuam9pbignICcpIGFzIFBvc2l0aW9uaW5nUGxhY2VtZW50O1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgUG9zaXRpb25pbmdTZXJ2aWNlIHtcclxuXHJcbiAgcHVibGljIHJlYWRvbmx5IGFuY2hvcjogRWxlbWVudFJlZjtcclxuICBwdWJsaWMgcmVhZG9ubHkgc3ViamVjdDogRWxlbWVudFJlZjtcclxuICBwcml2YXRlIF9wb3BwZXI6IFBvcHBlckluc3RhbmNlO1xyXG4gIHByaXZhdGUgX3BvcHBlclN0YXRlOiBEYXRhO1xyXG4gIHByaXZhdGUgX2Fycm93U2VsZWN0b3I6IHN0cmluZyB8IHVuZGVmaW5lZDtcclxuXHJcbiAgY29uc3RydWN0b3IoYW5jaG9yOiBFbGVtZW50UmVmLCBzdWJqZWN0OiBFbGVtZW50UmVmLCBwbGFjZW1lbnQ6IFBvc2l0aW9uaW5nUGxhY2VtZW50LCBhcnJvd1NlbGVjdG9yPzogc3RyaW5nKSB7XHJcbiAgICB0aGlzLmFuY2hvciA9IGFuY2hvcjtcclxuICAgIHRoaXMuc3ViamVjdCA9IHN1YmplY3Q7XHJcbiAgICB0aGlzLl9wbGFjZW1lbnQgPSBwbGFjZW1lbnQ7XHJcbiAgICB0aGlzLl9hcnJvd1NlbGVjdG9yID0gYXJyb3dTZWxlY3RvcjtcclxuICAgIHRoaXMuaW5pdCgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBhY3R1YWxQbGFjZW1lbnQoKTogUG9zaXRpb25pbmdQbGFjZW1lbnQge1xyXG4gICAgaWYgKCF0aGlzLl9wb3BwZXJTdGF0ZSkge1xyXG4gICAgICByZXR1cm4gUG9zaXRpb25pbmdQbGFjZW1lbnQuQXV0bztcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcG9wcGVyVG9QbGFjZW1lbnQodGhpcy5fcG9wcGVyU3RhdGUucGxhY2VtZW50KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgc3RhdGUoKTogRGF0YSB7XHJcbiAgICByZXR1cm4gdGhpcy5fcG9wcGVyU3RhdGU7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9wbGFjZW1lbnQ6IFBvc2l0aW9uaW5nUGxhY2VtZW50O1xyXG5cclxuICBwdWJsaWMgZ2V0IHBsYWNlbWVudCgpOiBQb3NpdGlvbmluZ1BsYWNlbWVudCB7XHJcbiAgICByZXR1cm4gdGhpcy5fcGxhY2VtZW50O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldCBwbGFjZW1lbnQocGxhY2VtZW50OiBQb3NpdGlvbmluZ1BsYWNlbWVudCkge1xyXG4gICAgdGhpcy5fcGxhY2VtZW50ID0gcGxhY2VtZW50O1xyXG4gICAgaWYgKHRoaXMuX3BvcHBlcikge1xyXG4gICAgICB0aGlzLl9wb3BwZXIub3B0aW9ucy5wbGFjZW1lbnQgPSBwbGFjZW1lbnRUb1BvcHBlcihwbGFjZW1lbnQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfaGFzQXJyb3c6IGJvb2xlYW47XHJcblxyXG4gIHB1YmxpYyBzZXQgaGFzQXJyb3coaGFzQXJyb3c6IGJvb2xlYW4pIHtcclxuICAgIHRoaXMuX2hhc0Fycm93ID0gaGFzQXJyb3c7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaW5pdCgpOiB2b2lkIHtcclxuICAgIGNvbnN0IG1vZGlmaWVyczogUG9wcGVyTW9kaWZpZXJzID0ge1xyXG4gICAgICBjb21wdXRlU3R5bGU6IHtcclxuICAgICAgICBncHVBY2NlbGVyYXRpb246IGZhbHNlXHJcbiAgICAgIH0sXHJcbiAgICAgIHByZXZlbnRPdmVyZmxvdzoge1xyXG4gICAgICAgIGVzY2FwZVdpdGhSZWZlcmVuY2U6IHRydWUsXHJcbiAgICAgICAgYm91bmRhcmllc0VsZW1lbnQ6IGRvY3VtZW50LmJvZHlcclxuICAgICAgfSxcclxuICAgICAgYXJyb3c6IHtcclxuICAgICAgICBlbGVtZW50OiB0aGlzLl9hcnJvd1NlbGVjdG9yXHJcbiAgICAgIH0sXHJcbiAgICAgIG9mZnNldDoge1xyXG4gICAgICAgIGZuOiAoZGF0YTogUG9wcGVyLkRhdGEpID0+IHtcclxuICAgICAgICAgIGlmICh0aGlzLl9oYXNBcnJvdykge1xyXG4gICAgICAgICAgICBjb25zdCBvZmZzZXRzID0gdGhpcy5jYWxjdWxhdGVPZmZzZXRzKCk7XHJcbiAgICAgICAgICAgIGRhdGEub2Zmc2V0cy5wb3BwZXIubGVmdCArPSBvZmZzZXRzLmxlZnQ7XHJcbiAgICAgICAgICAgIGRhdGEub2Zmc2V0cy5wb3BwZXIudG9wICs9IG9mZnNldHMudG9wO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGlmICghdGhpcy5fYXJyb3dTZWxlY3Rvcikge1xyXG4gICAgICBkZWxldGUgbW9kaWZpZXJzLmFycm93O1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuX3BvcHBlciA9IG5ldyBQb3BwZXIoXHJcbiAgICAgIHRoaXMuYW5jaG9yLm5hdGl2ZUVsZW1lbnQsXHJcbiAgICAgIHRoaXMuc3ViamVjdC5uYXRpdmVFbGVtZW50LFxyXG4gICAgICB7XHJcbiAgICAgICAgcGxhY2VtZW50OiBwbGFjZW1lbnRUb1BvcHBlcih0aGlzLl9wbGFjZW1lbnQpLFxyXG4gICAgICAgIG1vZGlmaWVycyxcclxuICAgICAgICBvbkNyZWF0ZTogaW5pdGlhbCA9PiB0aGlzLl9wb3BwZXJTdGF0ZSA9IGluaXRpYWwsXHJcbiAgICAgICAgb25VcGRhdGU6IHVwZGF0ZSA9PiB0aGlzLl9wb3BwZXJTdGF0ZSA9IHVwZGF0ZVxyXG4gICAgICB9KSBhcyBQb3BwZXJJbnN0YW5jZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyB1cGRhdGUoKTogdm9pZCB7XHJcbiAgICB0aGlzLl9wb3BwZXIudXBkYXRlKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZGVzdHJveSgpOiB2b2lkIHtcclxuICAgIHRoaXMuX3BvcHBlci5kZXN0cm95KCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNhbGN1bGF0ZU9mZnNldHMoKTogUG9wcGVyLk9mZnNldCB7XHJcbiAgICBsZXQgbGVmdCA9IDA7XHJcbiAgICBsZXQgdG9wID0gMDtcclxuXHJcbiAgICAvLyBUbyBzdXBwb3J0IGNvcnJlY3QgcG9zaXRpb25pbmcgZm9yIGFsbCBwb3B1cCBzaXplcyB3ZSBzaG91bGQgY2FsY3VsYXRlIG9mZnNldCB1c2luZyBlbVxyXG4gICAgY29uc3QgZm9udFNpemUgPSBwYXJzZUZsb2F0KHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHRoaXMuc3ViamVjdC5uYXRpdmVFbGVtZW50KS5nZXRQcm9wZXJ0eVZhbHVlKCdmb250LXNpemUnKSk7XHJcbiAgICAvLyBUaGUgRm9tYW50aWMgVUkgcG9wdXAgYXJyb3cgd2lkdGggYW5kIGhlaWdodCBhcmUgMC43MTQyODU3MWVtIGFuZCB0aGUgbWFyZ2luIGZyb20gdGhlIHBvcHVwIGVkZ2UgaXMgMWVtXHJcbiAgICBjb25zdCBhcnJvd0NlbnRlciA9ICgwLjcxNDI4NTcxIC8gMiArIDEpICogZm9udFNpemU7XHJcblxyXG4gICAgaWYgKHRoaXMuYW5jaG9yLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGggPD0gYXJyb3dDZW50ZXIgKiAyKSB7XHJcbiAgICAgIGNvbnN0IGFuY2hvckNlbnRlcldpZHRoID0gdGhpcy5hbmNob3IubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aCAvIDI7XHJcbiAgICAgIGlmICh0aGlzLl9wbGFjZW1lbnQgPT09IFBvc2l0aW9uaW5nUGxhY2VtZW50LlRvcExlZnQgfHwgdGhpcy5fcGxhY2VtZW50ID09PSBQb3NpdGlvbmluZ1BsYWNlbWVudC5Cb3R0b21MZWZ0KSB7XHJcbiAgICAgICAgbGVmdCA9IGFuY2hvckNlbnRlcldpZHRoIC0gYXJyb3dDZW50ZXI7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKHRoaXMuX3BsYWNlbWVudCA9PT0gUG9zaXRpb25pbmdQbGFjZW1lbnQuVG9wUmlnaHQgfHwgdGhpcy5fcGxhY2VtZW50ID09PSBQb3NpdGlvbmluZ1BsYWNlbWVudC5Cb3R0b21SaWdodCkge1xyXG4gICAgICAgIGxlZnQgPSBhcnJvd0NlbnRlciAtIGFuY2hvckNlbnRlcldpZHRoO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuYW5jaG9yLm5hdGl2ZUVsZW1lbnQub2Zmc2V0SGVpZ2h0IDw9IGFycm93Q2VudGVyICogMikge1xyXG4gICAgICBjb25zdCBhbmNob3JDZW50ZXJIZWlnaHQgPSB0aGlzLmFuY2hvci5uYXRpdmVFbGVtZW50Lm9mZnNldEhlaWdodCAvIDI7XHJcbiAgICAgIGlmICh0aGlzLl9wbGFjZW1lbnQgPT09IFBvc2l0aW9uaW5nUGxhY2VtZW50LkxlZnRUb3AgfHwgdGhpcy5fcGxhY2VtZW50ID09PSBQb3NpdGlvbmluZ1BsYWNlbWVudC5SaWdodFRvcCkge1xyXG4gICAgICAgIHRvcCA9IGFuY2hvckNlbnRlckhlaWdodCAtIGFycm93Q2VudGVyO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh0aGlzLl9wbGFjZW1lbnQgPT09IFBvc2l0aW9uaW5nUGxhY2VtZW50LkxlZnRCb3R0b20gfHwgdGhpcy5fcGxhY2VtZW50ID09PSBQb3NpdGlvbmluZ1BsYWNlbWVudC5SaWdodEJvdHRvbSkge1xyXG4gICAgICAgIHRvcCA9IGFycm93Q2VudGVyIC0gYW5jaG9yQ2VudGVySGVpZ2h0O1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4ge3RvcCwgbGVmdCwgd2lkdGg6IDAsIGhlaWdodDogMH07XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=