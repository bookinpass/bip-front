/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { TransitionDirection } from './transition';
export class TransitionController {
    /**
     * @param {?=} isInitiallyVisible
     * @param {?=} display
     */
    constructor(isInitiallyVisible = true, display = 'block') {
        // isInitiallyVisible sets whether the element starts out visible.
        this._isVisible = isInitiallyVisible;
        this._isHidden = !this._isVisible;
        this._display = display;
        this._queue = [];
        this._isAnimating = false;
    }
    /**
     * @return {?}
     */
    get isAnimating() {
        return this._isAnimating;
    }
    /**
     * @return {?}
     */
    get isVisible() {
        return this._isVisible;
    }
    /**
     * @return {?}
     */
    get isHidden() {
        return this._isHidden;
    }
    // Used to delay animations until we have an element to animate.
    /**
     * @private
     * @return {?}
     */
    get _isReady() {
        return this._renderer != undefined && this._element != undefined && this._changeDetector != undefined;
    }
    // Gets the first transition in the queue.
    /**
     * @private
     * @return {?}
     */
    get _queueFirst() {
        return this._queue[0];
    }
    // Gets the last transition in the queue.
    /**
     * @private
     * @return {?}
     */
    get _queueLast() {
        return this._queue[this._queue.length - 1];
    }
    // Sets the renderer to be used for animating.
    /**
     * @param {?} renderer
     * @return {?}
     */
    registerRenderer(renderer) {
        this._renderer = renderer;
        this.performTransition();
    }
    // Sets the element to perform the animations on.
    /**
     * @param {?} element
     * @return {?}
     */
    registerElement(element) {
        this._element = element;
        this.performTransition();
    }
    // Sets the change detector to detect changes when using ChangeDetectionStrategy.OnPush.
    /**
     * @param {?} changeDetector
     * @return {?}
     */
    registerChangeDetector(changeDetector) {
        this._changeDetector = changeDetector;
        this.performTransition();
    }
    /**
     * @param {?} transition
     * @return {?}
     */
    animate(transition) {
        // Test if transition is one of the list that doesn't change the visible state.
        // Should these eventually become classes?
        /** @type {?} */
        const isDirectionless = ['jiggle', 'flash', 'shake', 'pulse', 'tada', 'bounce'].indexOf(transition.type) !== -1;
        if (isDirectionless) {
            transition.direction = TransitionDirection.Static;
        }
        else if (transition.direction == undefined || transition.direction === TransitionDirection.Either) {
            // Set the direction to the opposite of the current visible state automatically if not set, or set to either direction.
            transition.direction = this._isVisible ? TransitionDirection.Out : TransitionDirection.In;
            if (this._queueLast) {
                // If there is an transition in the queue already, set the direction to the opposite of the direction of that transition.
                if (this._queueLast.direction === TransitionDirection.In) {
                    transition.direction = TransitionDirection.Out;
                }
                else if (this._queueLast.direction === TransitionDirection.Out) {
                    transition.direction = TransitionDirection.In;
                }
            }
        }
        // Store the transition in the queue before attempting to perform it.
        this._queue.push(transition);
        this.performTransition();
    }
    // Stops the current transition, leaves the rest of the queue intact.
    /**
     * @param {?=} transition
     * @return {?}
     */
    stop(transition = this._queueFirst) {
        if (!transition || !this._isAnimating) {
            return;
        }
        this.finalizeTransition(transition);
    }
    // Cancels the current transition, leaves the rest of the queue intact.
    /**
     * @param {?=} transition
     * @return {?}
     */
    cancel(transition = this._queueFirst) {
        if (!transition || !this._isAnimating) {
            return;
        }
        this.completeTransition(transition);
        if (transition.direction === TransitionDirection.In) {
            // Return hidden class if we were originally transitioning in.
            this._isHidden = true;
        }
    }
    // Stops the current transition, and empties the queue.
    /**
     * @return {?}
     */
    stopAll() {
        this.clearQueue();
        this.stop();
    }
    /**
     * @return {?}
     */
    cancelAll() {
        this.clearQueue();
        this.cancel();
    }
    // Empties the transition queue but carries on with the current transition.
    /**
     * @return {?}
     */
    clearQueue() {
        if (this.isAnimating) {
            this._queue = [this._queueFirst];
            return;
        }
        this._queue = [];
    }
    /**
     * @private
     * @return {?}
     */
    performTransition() {
        if (!this._isReady || this._isAnimating || !this._queueFirst) {
            // Don't transition until we are ready, or if we are animating, or if there aren't any transitions in the queue.
            return;
        }
        this._isAnimating = true;
        /** @type {?} */
        const transition = this._queueFirst;
        // Set the Fomantic UI classes for transitioning.
        transition.classes.forEach((/**
         * @param {?} c
         * @return {?}
         */
        c => this._renderer.addClass(this._element, c)));
        this._renderer.addClass(this._element, `animating`);
        this._renderer.addClass(this._element, transition.directionClass);
        // Set the Fomantic UI styles for transitioning.
        this._renderer.setStyle(this._element, `animationDuration`, `${transition.duration}ms`);
        this._renderer.setStyle(this._element, `display`, this._display);
        if (transition.direction === TransitionDirection.In) {
            // Unset hidden if we are transitioning in.
            this._isHidden = false;
        }
        // Wait the length of the animation before calling the complete callback.
        this._animationTimeout = window.setTimeout((/**
         * @return {?}
         */
        () => this.finalizeTransition(transition)), transition.duration);
    }
    /**
     * @private
     * @param {?} transition
     * @return {?}
     */
    completeTransition(transition) {
        transition.classes.forEach((/**
         * @param {?} c
         * @return {?}
         */
        c => this._renderer.removeClass(this._element, c)));
        this._renderer.removeClass(this._element, `animating`);
        this._renderer.removeClass(this._element, transition.directionClass);
        this._renderer.removeStyle(this._element, `animationDuration`);
        this._renderer.removeStyle(this._element, `display`);
        // Delete the transition from the queue.
        this._queue.shift();
        this._isAnimating = false;
        this._changeDetector.markForCheck();
        clearTimeout(this._animationTimeout);
    }
    // Called when a transition has completed.
    /**
     * @private
     * @param {?} transition
     * @return {?}
     */
    finalizeTransition(transition) {
        this.completeTransition(transition);
        if (transition.direction === TransitionDirection.In) {
            // If we have just animated in, we are now visible.
            this._isVisible = true;
        }
        else if (transition.direction === TransitionDirection.Out) {
            // If we have transitioned out, we should be invisible and hidden.
            this._isVisible = false;
            this._isHidden = true;
        }
        if (transition.onComplete) {
            // Call the user-defined transition callback.
            transition.onComplete();
        }
        // Immediately attempt to perform another transition.
        this.performTransition();
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    TransitionController.prototype._renderer;
    /**
     * @type {?}
     * @private
     */
    TransitionController.prototype._element;
    /**
     * @type {?}
     * @private
     */
    TransitionController.prototype._changeDetector;
    /**
     * @type {?}
     * @private
     */
    TransitionController.prototype._display;
    /**
     * @type {?}
     * @private
     */
    TransitionController.prototype._queue;
    /**
     * @type {?}
     * @private
     */
    TransitionController.prototype._animationTimeout;
    /**
     * @type {?}
     * @private
     */
    TransitionController.prototype._isAnimating;
    /**
     * @type {?}
     * @private
     */
    TransitionController.prototype._isVisible;
    /**
     * @type {?}
     * @private
     */
    TransitionController.prototype._isHidden;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNpdGlvbi1jb250cm9sbGVyLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LWZvbWFudGljLXVpLyIsInNvdXJjZXMiOlsibW9kdWxlcy90cmFuc2l0aW9uL2NsYXNzZXMvdHJhbnNpdGlvbi1jb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFDQSxPQUFPLEVBQWEsbUJBQW1CLEVBQUMsTUFBTSxjQUFjLENBQUM7QUFFN0QsTUFBTSxPQUFPLG9CQUFvQjs7Ozs7SUFhL0IsWUFBWSxxQkFBOEIsSUFBSSxFQUFFLFVBQWtCLE9BQU87UUFDdkUsa0VBQWtFO1FBQ2xFLElBQUksQ0FBQyxVQUFVLEdBQUcsa0JBQWtCLENBQUM7UUFDckMsSUFBSSxDQUFDLFNBQVMsR0FBRyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUM7UUFFbEMsSUFBSSxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUM7UUFDeEIsSUFBSSxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUM7UUFFakIsSUFBSSxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUM7SUFDNUIsQ0FBQzs7OztJQUlELElBQVcsV0FBVztRQUNwQixPQUFPLElBQUksQ0FBQyxZQUFZLENBQUM7SUFDM0IsQ0FBQzs7OztJQUtELElBQVcsU0FBUztRQUNsQixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUM7SUFDekIsQ0FBQzs7OztJQUtELElBQVcsUUFBUTtRQUNqQixPQUFPLElBQUksQ0FBQyxTQUFTLENBQUM7SUFDeEIsQ0FBQzs7Ozs7O0lBR0QsSUFBWSxRQUFRO1FBQ2xCLE9BQU8sSUFBSSxDQUFDLFNBQVMsSUFBSSxTQUFTLElBQUksSUFBSSxDQUFDLFFBQVEsSUFBSSxTQUFTLElBQUksSUFBSSxDQUFDLGVBQWUsSUFBSSxTQUFTLENBQUM7SUFDeEcsQ0FBQzs7Ozs7O0lBR0QsSUFBWSxXQUFXO1FBQ3JCLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN4QixDQUFDOzs7Ozs7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QUFDO0lBQ3ZDLENBQUM7Ozs7Ozs7SUFHTyxrQkFBa0IsQ0FBQyxVQUFzQjtRQUMvQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFcEMsSUFBSSxVQUFVLENBQUMsU0FBUyxLQUFLLG1CQUFtQixDQUFDLEVBQUUsRUFBRTtZQUNuRCxtREFBbUQ7WUFDbkQsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUM7U0FDeEI7YUFBTSxJQUFJLFVBQVUsQ0FBQyxTQUFTLEtBQUssbUJBQW1CLENBQUMsR0FBRyxFQUFFO1lBQzNELGtFQUFrRTtZQUNsRSxJQUFJLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQztZQUN4QixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztTQUN2QjtRQUVELElBQUksVUFBVSxDQUFDLFVBQVUsRUFBRTtZQUN6Qiw2Q0FBNkM7WUFDN0MsVUFBVSxDQUFDLFVBQVUsRUFBRSxDQUFDO1NBQ3pCO1FBRUQscURBQXFEO1FBQ3JELElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO0lBQzNCLENBQUM7Q0FDRjs7Ozs7O0lBbE5DLHlDQUE2Qjs7Ozs7SUFFN0Isd0NBQTZCOzs7OztJQUU3QiwrQ0FBMkM7Ozs7O0lBRTNDLHdDQUF5Qjs7Ozs7SUFFekIsc0NBQTZCOzs7OztJQUU3QixpREFBa0M7Ozs7O0lBYWxDLDRDQUE4Qjs7Ozs7SUFPOUIsMENBQTRCOzs7OztJQU81Qix5Q0FBMkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NoYW5nZURldGVjdG9yUmVmLCBFbGVtZW50UmVmLCBSZW5kZXJlcjJ9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge1RyYW5zaXRpb24sIFRyYW5zaXRpb25EaXJlY3Rpb259IGZyb20gJy4vdHJhbnNpdGlvbic7XHJcblxyXG5leHBvcnQgY2xhc3MgVHJhbnNpdGlvbkNvbnRyb2xsZXIge1xyXG4gIHByaXZhdGUgX3JlbmRlcmVyOiBSZW5kZXJlcjI7XHJcblxyXG4gIHByaXZhdGUgX2VsZW1lbnQ6IEVsZW1lbnRSZWY7XHJcblxyXG4gIHByaXZhdGUgX2NoYW5nZURldGVjdG9yOiBDaGFuZ2VEZXRlY3RvclJlZjtcclxuICAvLyBTZXRzIHRoZSAnZGlzcGxheScgc3R5bGUgd2hlbiB2aXNpYmxlLlxyXG4gIHByaXZhdGUgX2Rpc3BsYXk6IHN0cmluZztcclxuICAvLyBTdG9yZXMgcXVldWVkIHRyYW5zaXRpb25zLlxyXG4gIHByaXZhdGUgX3F1ZXVlOiBUcmFuc2l0aW9uW107XHJcbiAgLy8gU3RvcmVzIHRoZSBzZXRUaW1lb3V0IHBvaW50ZXIgZm9yIGNhbmNlbGxpbmcgdGhlIGFuaW1hdGlvbiBjYWxsYmFjay5cclxuICBwcml2YXRlIF9hbmltYXRpb25UaW1lb3V0OiBudW1iZXI7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGlzSW5pdGlhbGx5VmlzaWJsZTogYm9vbGVhbiA9IHRydWUsIGRpc3BsYXk6IHN0cmluZyA9ICdibG9jaycpIHtcclxuICAgIC8vIGlzSW5pdGlhbGx5VmlzaWJsZSBzZXRzIHdoZXRoZXIgdGhlIGVsZW1lbnQgc3RhcnRzIG91dCB2aXNpYmxlLlxyXG4gICAgdGhpcy5faXNWaXNpYmxlID0gaXNJbml0aWFsbHlWaXNpYmxlO1xyXG4gICAgdGhpcy5faXNIaWRkZW4gPSAhdGhpcy5faXNWaXNpYmxlO1xyXG5cclxuICAgIHRoaXMuX2Rpc3BsYXkgPSBkaXNwbGF5O1xyXG4gICAgdGhpcy5fcXVldWUgPSBbXTtcclxuXHJcbiAgICB0aGlzLl9pc0FuaW1hdGluZyA9IGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfaXNBbmltYXRpbmc6IGJvb2xlYW47XHJcblxyXG4gIHB1YmxpYyBnZXQgaXNBbmltYXRpbmcoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5faXNBbmltYXRpbmc7XHJcbiAgfVxyXG5cclxuICAvLyBTZXQgd2hlbiB0aGUgZWxlbWVudCBpcyB2aXNpYmxlLCBhbmQgd2hpbGUgaXQgaXMgdHJhbnNpdGlvbmluZyBvdXQuXHJcbiAgcHJpdmF0ZSBfaXNWaXNpYmxlOiBib29sZWFuO1xyXG5cclxuICBwdWJsaWMgZ2V0IGlzVmlzaWJsZSgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLl9pc1Zpc2libGU7XHJcbiAgfVxyXG5cclxuICAvLyBTZXQgd2hlbiB0aGUgZWxlbWVudCBpcyBoaWRkZW4sIGFuZCBub3Qgd2hpbGUgaXQgaXMgdHJhbnNpdGlvbmluZy5cclxuICBwcml2YXRlIF9pc0hpZGRlbjogYm9vbGVhbjtcclxuXHJcbiAgcHVibGljIGdldCBpc0hpZGRlbigpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLl9pc0hpZGRlbjtcclxuICB9XHJcblxyXG4gIC8vIFVzZWQgdG8gZGVsYXkgYW5pbWF0aW9ucyB1bnRpbCB3ZSBoYXZlIGFuIGVsZW1lbnQgdG8gYW5pbWF0ZS5cclxuICBwcml2YXRlIGdldCBfaXNSZWFkeSgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLl9yZW5kZXJlciAhPSB1bmRlZmluZWQgJiYgdGhpcy5fZWxlbWVudCAhPSB1bmRlZmluZWQgJiYgdGhpcy5fY2hhbmdlRGV0ZWN0b3IgIT0gdW5kZWZpbmVkO1xyXG4gIH1cclxuXHJcbiAgLy8gR2V0cyB0aGUgZmlyc3QgdHJhbnNpdGlvbiBpbiB0aGUgcXVldWUuXHJcbiAgcHJpdmF0ZSBnZXQgX3F1ZXVlRmlyc3QoKTogVHJhbnNpdGlvbiB7XHJcbiAgICByZXR1cm4gdGhpcy5fcXVldWVbMF07XHJcbiAgfVxyXG5cclxuICAvLyBHZXRzIHRoZSBsYXN0IHRyYW5zaXRpb24gaW4gdGhlIHF1ZXVlLlxyXG4gIHByaXZhdGUgZ2V0IF9xdWV1ZUxhc3QoKTogVHJhbnNpdGlvbiB7XHJcbiAgICByZXR1cm4gdGhpcy5fcXVldWVbdGhpcy5fcXVldWUubGVuZ3RoIC0gMV07XHJcbiAgfVxyXG5cclxuICAvLyBTZXRzIHRoZSByZW5kZXJlciB0byBiZSB1c2VkIGZvciBhbmltYXRpbmcuXHJcbiAgcHVibGljIHJlZ2lzdGVyUmVuZGVyZXIocmVuZGVyZXI6IFJlbmRlcmVyMik6IHZvaWQge1xyXG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcclxuICAgIHRoaXMucGVyZm9ybVRyYW5zaXRpb24oKTtcclxuICB9XHJcblxyXG4gIC8vIFNldHMgdGhlIGVsZW1lbnQgdG8gcGVyZm9ybSB0aGUgYW5pbWF0aW9ucyBvbi5cclxuICBwdWJsaWMgcmVnaXN0ZXJFbGVtZW50KGVsZW1lbnQ6IEVsZW1lbnRSZWYpOiB2b2lkIHtcclxuICAgIHRoaXMuX2VsZW1lbnQgPSBlbGVtZW50O1xyXG4gICAgdGhpcy5wZXJmb3JtVHJhbnNpdGlvbigpO1xyXG4gIH1cclxuXHJcbiAgLy8gU2V0cyB0aGUgY2hhbmdlIGRldGVjdG9yIHRvIGRldGVjdCBjaGFuZ2VzIHdoZW4gdXNpbmcgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLlxyXG4gIHB1YmxpYyByZWdpc3RlckNoYW5nZURldGVjdG9yKGNoYW5nZURldGVjdG9yOiBDaGFuZ2VEZXRlY3RvclJlZik6IHZvaWQge1xyXG4gICAgdGhpcy5fY2hhbmdlRGV0ZWN0b3IgPSBjaGFuZ2VEZXRlY3RvcjtcclxuICAgIHRoaXMucGVyZm9ybVRyYW5zaXRpb24oKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBhbmltYXRlKHRyYW5zaXRpb246IFRyYW5zaXRpb24pOiB2b2lkIHtcclxuICAgIC8vIFRlc3QgaWYgdHJhbnNpdGlvbiBpcyBvbmUgb2YgdGhlIGxpc3QgdGhhdCBkb2Vzbid0IGNoYW5nZSB0aGUgdmlzaWJsZSBzdGF0ZS5cclxuICAgIC8vIFNob3VsZCB0aGVzZSBldmVudHVhbGx5IGJlY29tZSBjbGFzc2VzP1xyXG4gICAgY29uc3QgaXNEaXJlY3Rpb25sZXNzID0gWydqaWdnbGUnLCAnZmxhc2gnLCAnc2hha2UnLCAncHVsc2UnLCAndGFkYScsICdib3VuY2UnXS5pbmRleE9mKHRyYW5zaXRpb24udHlwZSkgIT09IC0xO1xyXG4gICAgaWYgKGlzRGlyZWN0aW9ubGVzcykge1xyXG4gICAgICB0cmFuc2l0aW9uLmRpcmVjdGlvbiA9IFRyYW5zaXRpb25EaXJlY3Rpb24uU3RhdGljO1xyXG4gICAgfSBlbHNlIGlmICh0cmFuc2l0aW9uLmRpcmVjdGlvbiA9PSB1bmRlZmluZWQgfHwgdHJhbnNpdGlvbi5kaXJlY3Rpb24gPT09IFRyYW5zaXRpb25EaXJlY3Rpb24uRWl0aGVyKSB7XHJcbiAgICAgIC8vIFNldCB0aGUgZGlyZWN0aW9uIHRvIHRoZSBvcHBvc2l0ZSBvZiB0aGUgY3VycmVudCB2aXNpYmxlIHN0YXRlIGF1dG9tYXRpY2FsbHkgaWYgbm90IHNldCwgb3Igc2V0IHRvIGVpdGhlciBkaXJlY3Rpb24uXHJcbiAgICAgIHRyYW5zaXRpb24uZGlyZWN0aW9uID0gdGhpcy5faXNWaXNpYmxlID8gVHJhbnNpdGlvbkRpcmVjdGlvbi5PdXQgOiBUcmFuc2l0aW9uRGlyZWN0aW9uLkluO1xyXG4gICAgICBpZiAodGhpcy5fcXVldWVMYXN0KSB7XHJcbiAgICAgICAgLy8gSWYgdGhlcmUgaXMgYW4gdHJhbnNpdGlvbiBpbiB0aGUgcXVldWUgYWxyZWFkeSwgc2V0IHRoZSBkaXJlY3Rpb24gdG8gdGhlIG9wcG9zaXRlIG9mIHRoZSBkaXJlY3Rpb24gb2YgdGhhdCB0cmFuc2l0aW9uLlxyXG4gICAgICAgIGlmICh0aGlzLl9xdWV1ZUxhc3QuZGlyZWN0aW9uID09PSBUcmFuc2l0aW9uRGlyZWN0aW9uLkluKSB7XHJcbiAgICAgICAgICB0cmFuc2l0aW9uLmRpcmVjdGlvbiA9IFRyYW5zaXRpb25EaXJlY3Rpb24uT3V0O1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5fcXVldWVMYXN0LmRpcmVjdGlvbiA9PT0gVHJhbnNpdGlvbkRpcmVjdGlvbi5PdXQpIHtcclxuICAgICAgICAgIHRyYW5zaXRpb24uZGlyZWN0aW9uID0gVHJhbnNpdGlvbkRpcmVjdGlvbi5JbjtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBTdG9yZSB0aGUgdHJhbnNpdGlvbiBpbiB0aGUgcXVldWUgYmVmb3JlIGF0dGVtcHRpbmcgdG8gcGVyZm9ybSBpdC5cclxuICAgIHRoaXMuX3F1ZXVlLnB1c2godHJhbnNpdGlvbik7XHJcblxyXG4gICAgdGhpcy5wZXJmb3JtVHJhbnNpdGlvbigpO1xyXG4gIH1cclxuXHJcbiAgLy8gU3RvcHMgdGhlIGN1cnJlbnQgdHJhbnNpdGlvbiwgbGVhdmVzIHRoZSByZXN0IG9mIHRoZSBxdWV1ZSBpbnRhY3QuXHJcbiAgcHVibGljIHN0b3AodHJhbnNpdGlvbjogVHJhbnNpdGlvbiA9IHRoaXMuX3F1ZXVlRmlyc3QpOiB2b2lkIHtcclxuICAgIGlmICghdHJhbnNpdGlvbiB8fCAhdGhpcy5faXNBbmltYXRpbmcpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZmluYWxpemVUcmFuc2l0aW9uKHRyYW5zaXRpb24pO1xyXG4gIH1cclxuXHJcbiAgLy8gQ2FuY2VscyB0aGUgY3VycmVudCB0cmFuc2l0aW9uLCBsZWF2ZXMgdGhlIHJlc3Qgb2YgdGhlIHF1ZXVlIGludGFjdC5cclxuICBwdWJsaWMgY2FuY2VsKHRyYW5zaXRpb246IFRyYW5zaXRpb24gPSB0aGlzLl9xdWV1ZUZpcnN0KTogdm9pZCB7XHJcbiAgICBpZiAoIXRyYW5zaXRpb24gfHwgIXRoaXMuX2lzQW5pbWF0aW5nKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmNvbXBsZXRlVHJhbnNpdGlvbih0cmFuc2l0aW9uKTtcclxuXHJcbiAgICBpZiAodHJhbnNpdGlvbi5kaXJlY3Rpb24gPT09IFRyYW5zaXRpb25EaXJlY3Rpb24uSW4pIHtcclxuICAgICAgLy8gUmV0dXJuIGhpZGRlbiBjbGFzcyBpZiB3ZSB3ZXJlIG9yaWdpbmFsbHkgdHJhbnNpdGlvbmluZyBpbi5cclxuICAgICAgdGhpcy5faXNIaWRkZW4gPSB0cnVlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gU3RvcHMgdGhlIGN1cnJlbnQgdHJhbnNpdGlvbiwgYW5kIGVtcHRpZXMgdGhlIHF1ZXVlLlxyXG4gIHB1YmxpYyBzdG9wQWxsKCk6IHZvaWQge1xyXG4gICAgdGhpcy5jbGVhclF1ZXVlKCk7XHJcbiAgICB0aGlzLnN0b3AoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBjYW5jZWxBbGwoKTogdm9pZCB7XHJcbiAgICB0aGlzLmNsZWFyUXVldWUoKTtcclxuICAgIHRoaXMuY2FuY2VsKCk7XHJcbiAgfVxyXG5cclxuICAvLyBFbXB0aWVzIHRoZSB0cmFuc2l0aW9uIHF1ZXVlIGJ1dCBjYXJyaWVzIG9uIHdpdGggdGhlIGN1cnJlbnQgdHJhbnNpdGlvbi5cclxuICBwdWJsaWMgY2xlYXJRdWV1ZSgpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLmlzQW5pbWF0aW5nKSB7XHJcbiAgICAgIHRoaXMuX3F1ZXVlID0gW3RoaXMuX3F1ZXVlRmlyc3RdO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLl9xdWV1ZSA9IFtdO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwZXJmb3JtVHJhbnNpdGlvbigpOiB2b2lkIHtcclxuICAgIGlmICghdGhpcy5faXNSZWFkeSB8fCB0aGlzLl9pc0FuaW1hdGluZyB8fCAhdGhpcy5fcXVldWVGaXJzdCkge1xyXG4gICAgICAvLyBEb24ndCB0cmFuc2l0aW9uIHVudGlsIHdlIGFyZSByZWFkeSwgb3IgaWYgd2UgYXJlIGFuaW1hdGluZywgb3IgaWYgdGhlcmUgYXJlbid0IGFueSB0cmFuc2l0aW9ucyBpbiB0aGUgcXVldWUuXHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLl9pc0FuaW1hdGluZyA9IHRydWU7XHJcblxyXG4gICAgY29uc3QgdHJhbnNpdGlvbiA9IHRoaXMuX3F1ZXVlRmlyc3Q7XHJcblxyXG4gICAgLy8gU2V0IHRoZSBGb21hbnRpYyBVSSBjbGFzc2VzIGZvciB0cmFuc2l0aW9uaW5nLlxyXG4gICAgdHJhbnNpdGlvbi5jbGFzc2VzLmZvckVhY2goYyA9PiB0aGlzLl9yZW5kZXJlci5hZGRDbGFzcyh0aGlzLl9lbGVtZW50LCBjKSk7XHJcbiAgICB0aGlzLl9yZW5kZXJlci5hZGRDbGFzcyh0aGlzLl9lbGVtZW50LCBgYW5pbWF0aW5nYCk7XHJcbiAgICB0aGlzLl9yZW5kZXJlci5hZGRDbGFzcyh0aGlzLl9lbGVtZW50LCB0cmFuc2l0aW9uLmRpcmVjdGlvbkNsYXNzKTtcclxuXHJcbiAgICAvLyBTZXQgdGhlIEZvbWFudGljIFVJIHN0eWxlcyBmb3IgdHJhbnNpdGlvbmluZy5cclxuICAgIHRoaXMuX3JlbmRlcmVyLnNldFN0eWxlKHRoaXMuX2VsZW1lbnQsIGBhbmltYXRpb25EdXJhdGlvbmAsIGAke3RyYW5zaXRpb24uZHVyYXRpb259bXNgKTtcclxuICAgIHRoaXMuX3JlbmRlcmVyLnNldFN0eWxlKHRoaXMuX2VsZW1lbnQsIGBkaXNwbGF5YCwgdGhpcy5fZGlzcGxheSk7XHJcblxyXG4gICAgaWYgKHRyYW5zaXRpb24uZGlyZWN0aW9uID09PSBUcmFuc2l0aW9uRGlyZWN0aW9uLkluKSB7XHJcbiAgICAgIC8vIFVuc2V0IGhpZGRlbiBpZiB3ZSBhcmUgdHJhbnNpdGlvbmluZyBpbi5cclxuICAgICAgdGhpcy5faXNIaWRkZW4gPSBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBXYWl0IHRoZSBsZW5ndGggb2YgdGhlIGFuaW1hdGlvbiBiZWZvcmUgY2FsbGluZyB0aGUgY29tcGxldGUgY2FsbGJhY2suXHJcbiAgICB0aGlzLl9hbmltYXRpb25UaW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4gdGhpcy5maW5hbGl6ZVRyYW5zaXRpb24odHJhbnNpdGlvbiksIHRyYW5zaXRpb24uZHVyYXRpb24pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjb21wbGV0ZVRyYW5zaXRpb24odHJhbnNpdGlvbjogVHJhbnNpdGlvbik6IHZvaWQge1xyXG4gICAgdHJhbnNpdGlvbi5jbGFzc2VzLmZvckVhY2goYyA9PiB0aGlzLl9yZW5kZXJlci5yZW1vdmVDbGFzcyh0aGlzLl9lbGVtZW50LCBjKSk7XHJcbiAgICB0aGlzLl9yZW5kZXJlci5yZW1vdmVDbGFzcyh0aGlzLl9lbGVtZW50LCBgYW5pbWF0aW5nYCk7XHJcbiAgICB0aGlzLl9yZW5kZXJlci5yZW1vdmVDbGFzcyh0aGlzLl9lbGVtZW50LCB0cmFuc2l0aW9uLmRpcmVjdGlvbkNsYXNzKTtcclxuXHJcbiAgICB0aGlzLl9yZW5kZXJlci5yZW1vdmVTdHlsZSh0aGlzLl9lbGVtZW50LCBgYW5pbWF0aW9uRHVyYXRpb25gKTtcclxuICAgIHRoaXMuX3JlbmRlcmVyLnJlbW92ZVN0eWxlKHRoaXMuX2VsZW1lbnQsIGBkaXNwbGF5YCk7XHJcblxyXG4gICAgLy8gRGVsZXRlIHRoZSB0cmFuc2l0aW9uIGZyb20gdGhlIHF1ZXVlLlxyXG4gICAgdGhpcy5fcXVldWUuc2hpZnQoKTtcclxuICAgIHRoaXMuX2lzQW5pbWF0aW5nID0gZmFsc2U7XHJcblxyXG4gICAgdGhpcy5fY2hhbmdlRGV0ZWN0b3IubWFya0ZvckNoZWNrKCk7XHJcblxyXG4gICAgY2xlYXJUaW1lb3V0KHRoaXMuX2FuaW1hdGlvblRpbWVvdXQpO1xyXG4gIH1cclxuXHJcbiAgLy8gQ2FsbGVkIHdoZW4gYSB0cmFuc2l0aW9uIGhhcyBjb21wbGV0ZWQuXHJcbiAgcHJpdmF0ZSBmaW5hbGl6ZVRyYW5zaXRpb24odHJhbnNpdGlvbjogVHJhbnNpdGlvbik6IHZvaWQge1xyXG4gICAgdGhpcy5jb21wbGV0ZVRyYW5zaXRpb24odHJhbnNpdGlvbik7XHJcblxyXG4gICAgaWYgKHRyYW5zaXRpb24uZGlyZWN0aW9uID09PSBUcmFuc2l0aW9uRGlyZWN0aW9uLkluKSB7XHJcbiAgICAgIC8vIElmIHdlIGhhdmUganVzdCBhbmltYXRlZCBpbiwgd2UgYXJlIG5vdyB2aXNpYmxlLlxyXG4gICAgICB0aGlzLl9pc1Zpc2libGUgPSB0cnVlO1xyXG4gICAgfSBlbHNlIGlmICh0cmFuc2l0aW9uLmRpcmVjdGlvbiA9PT0gVHJhbnNpdGlvbkRpcmVjdGlvbi5PdXQpIHtcclxuICAgICAgLy8gSWYgd2UgaGF2ZSB0cmFuc2l0aW9uZWQgb3V0LCB3ZSBzaG91bGQgYmUgaW52aXNpYmxlIGFuZCBoaWRkZW4uXHJcbiAgICAgIHRoaXMuX2lzVmlzaWJsZSA9IGZhbHNlO1xyXG4gICAgICB0aGlzLl9pc0hpZGRlbiA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRyYW5zaXRpb24ub25Db21wbGV0ZSkge1xyXG4gICAgICAvLyBDYWxsIHRoZSB1c2VyLWRlZmluZWQgdHJhbnNpdGlvbiBjYWxsYmFjay5cclxuICAgICAgdHJhbnNpdGlvbi5vbkNvbXBsZXRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSW1tZWRpYXRlbHkgYXR0ZW1wdCB0byBwZXJmb3JtIGFub3RoZXIgdHJhbnNpdGlvbi5cclxuICAgIHRoaXMucGVyZm9ybVRyYW5zaXRpb24oKTtcclxuICB9XHJcbn1cclxuIl19