/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { DateUtil, Util } from '../../../misc/util/internal';
import { CalendarItem } from '../directives/calendar-item';
import { DateComparer } from '../classes/date-comparer';
export class CalendarRange {
    /**
     * @param {?} start
     * @param {?} dates
     * @param {?} items
     * @param {?} grouped
     * @param {?} comparer
     */
    constructor(start, dates, items, grouped, comparer) {
        this.start = start;
        this.dates = dates;
        this.items = items;
        this.groupedItems = grouped;
        this._comparer = comparer;
    }
    /**
     * @return {?}
     */
    get inRange() {
        return this.items.filter((/**
         * @param {?} i
         * @return {?}
         */
        i => !i.isOutsideRange));
    }
    /**
     * @param {?} item
     * @return {?}
     */
    find(item) {
        return this.items.find((/**
         * @param {?} i
         * @return {?}
         */
        i => this._comparer.equal(i.date, item.date)));
    }
    /**
     * @param {?} item
     * @return {?}
     */
    findIndex(item) {
        if (!item) {
            return -1;
        }
        return this.items.findIndex((/**
         * @param {?} i
         * @return {?}
         */
        i => this._comparer.equal(i.date, item.date)));
    }
    /**
     * @param {?} date
     * @return {?}
     */
    containsDate(date) {
        return !!this.inRange.find((/**
         * @param {?} i
         * @return {?}
         */
        i => this._comparer.equal(i.date, date)));
    }
}
if (false) {
    /** @type {?} */
    CalendarRange.prototype.start;
    /** @type {?} */
    CalendarRange.prototype.dates;
    /** @type {?} */
    CalendarRange.prototype.items;
    /** @type {?} */
    CalendarRange.prototype.groupedItems;
    /**
     * @type {?}
     * @private
     */
    CalendarRange.prototype._comparer;
}
/**
 * @abstract
 */
export class CalendarRangeService {
    /**
     * @param {?} interval
     * @param {?} rows
     * @param {?} columns
     */
    constructor(interval, rows, columns) {
        this.interval = interval;
        this.marginal = (/** @type {?} */ (interval)) + 1;
        this.rows = rows;
        this.columns = columns;
    }
    /**
     * @return {?}
     */
    get dateComparer() {
        return new DateComparer(this.marginal, this.service.inFinalView);
    }
    /**
     * @return {?}
     */
    get length() {
        return this.rows * this.columns;
    }
    /**
     * @return {?}
     */
    get canMoveNext() {
        /** @type {?} */
        const firstItem = this.next.inRange[0];
        if (firstItem && this.service.maxDate) {
            return firstItem.date <= this.service.maxDate;
        }
        return true;
    }
    /**
     * @return {?}
     */
    get canMovePrevious() {
        /** @type {?} */
        const lastItem = this.previous.inRange.slice(-1).pop();
        if (lastItem && this.service.minDate) {
            return lastItem.date >= this.service.minDate;
        }
        return true;
    }
    /**
     * @param {?} service
     * @return {?}
     */
    loadService(service) {
        this.service = service;
        this.refresh();
    }
    /**
     * @return {?}
     */
    refresh() {
        this.current = this.calcRange(this.service.currentDate);
        this.next = this.calcRange(DateUtil.next(this.interval, DateUtil.clone(this.service.currentDate)));
        this.previous = this.calcRange(DateUtil.previous(this.interval, DateUtil.clone(this.service.currentDate)));
    }
    /**
     * @param {?} forwards
     * @return {?}
     */
    move(forwards) {
        if (forwards) {
            return this.moveNext();
        }
        return this.movePrevious();
    }
    /**
     * @return {?}
     */
    moveNext() {
        DateUtil.next(this.interval, this.service.currentDate);
        this.previous = this.current;
        this.current = this.next;
        this.next = this.calcRange(DateUtil.next(this.interval, DateUtil.clone(this.service.currentDate)));
    }
    /**
     * @return {?}
     */
    movePrevious() {
        DateUtil.previous(this.interval, this.service.currentDate);
        this.next = this.current;
        this.current = this.previous;
        this.previous = this.calcRange(DateUtil.previous(this.interval, DateUtil.clone(this.service.currentDate)));
    }
    /**
     * @param {?} forwards
     * @return {?}
     */
    calc(forwards) {
        if (forwards) {
            return this.next;
        }
        return this.previous;
    }
    /**
     * @protected
     * @param {?} date
     * @return {?}
     */
    calcStart(date) {
        return DateUtil.startOf(this.interval, DateUtil.clone(date));
    }
    /**
     * @protected
     * @param {?} rangeStart
     * @return {?}
     */
    calcDates(rangeStart) {
        return Util.Array
            .range(this.length)
            .map((/**
         * @param {?} i
         * @return {?}
         */
        i => DateUtil.add(this.marginal, DateUtil.clone(rangeStart), i)));
    }
    /**
     * @protected
     * @param {?} dateRange
     * @param {?} baseDate
     * @return {?}
     */
    calcItems(dateRange, baseDate) {
        return dateRange.map((/**
         * @param {?} date
         * @return {?}
         */
        date => {
            /** @type {?} */
            const item = new CalendarItem(date);
            item.isDisabled = !this.dateComparer.between(item.date, this.service.minDate, this.service.maxDate);
            item.isActive = this.dateComparer.equal(item.date, this.service.selectedDate);
            item.isToday = this.dateComparer.equal(item.date, new Date());
            item.isSelectable = item.isDisabled;
            this.configureItem(item, baseDate);
            return item;
        }));
    }
    /**
     * @private
     * @param {?} startDate
     * @return {?}
     */
    calcRange(startDate) {
        /** @type {?} */
        const start = this.calcStart(startDate);
        if (this.service.inFinalView) {
            DateUtil.startOf(this.marginal, start, true);
        }
        /** @type {?} */
        const dates = this.calcDates(start);
        /** @type {?} */
        const items = this.calcItems(dates, startDate);
        return new CalendarRange(start, dates, items, Util.Array.group(items, this.columns), this.dateComparer);
    }
}
if (false) {
    /** @type {?} */
    CalendarRangeService.prototype.previous;
    /** @type {?} */
    CalendarRangeService.prototype.current;
    /** @type {?} */
    CalendarRangeService.prototype.next;
    /** @type {?} */
    CalendarRangeService.prototype.service;
    /** @type {?} */
    CalendarRangeService.prototype.interval;
    /** @type {?} */
    CalendarRangeService.prototype.marginal;
    /** @type {?} */
    CalendarRangeService.prototype.rows;
    /** @type {?} */
    CalendarRangeService.prototype.columns;
    /**
     * @abstract
     * @protected
     * @param {?} item
     * @param {?} baseDate
     * @return {?}
     */
    CalendarRangeService.prototype.configureItem = function (item, baseDate) { };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXItcmFuZ2Uuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1mb21hbnRpYy11aS8iLCJzb3VyY2VzIjpbIm1vZHVsZXMvZGF0ZXBpY2tlci9zZXJ2aWNlcy9jYWxlbmRhci1yYW5nZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQWdCLFFBQVEsRUFBRSxJQUFJLEVBQUMsTUFBTSw2QkFBNkIsQ0FBQztBQUMxRSxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sNkJBQTZCLENBQUM7QUFFekQsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFNLDBCQUEwQixDQUFDO0FBRXRELE1BQU0sT0FBTyxhQUFhOzs7Ozs7OztJQU94QixZQUFZLEtBQVcsRUFBRSxLQUFhLEVBQUUsS0FBcUIsRUFBRSxPQUF5QixFQUFFLFFBQXNCO1FBQzlHLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ25CLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ25CLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ25CLElBQUksQ0FBQyxZQUFZLEdBQUcsT0FBTyxDQUFDO1FBQzVCLElBQUksQ0FBQyxTQUFTLEdBQUcsUUFBUSxDQUFDO0lBQzVCLENBQUM7Ozs7SUFFRCxJQUFXLE9BQU87UUFDaEIsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU07Ozs7UUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLGNBQWMsRUFBQyxDQUFDO0lBQ25ELENBQUM7Ozs7O0lBRU0sSUFBSSxDQUFDLElBQWtCO1FBQzVCLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJOzs7O1FBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBQyxDQUFDO0lBQ3ZFLENBQUM7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VXRpbH0gZnJvbSAnLi4vLi4vLi4vbWlzYy91dGlsL2ludGVybmFsJztcclxuaW1wb3J0IHtDYWxlbmRhckl0ZW19IGZyb20gJy4uL2RpcmVjdGl2ZXMvY2FsZW5kYXItaXRlbSc7XHJcbmltcG9ydCB7Q2FsZW5kYXJTZXJ2aWNlfSBmcm9tICcuL2NhbGVuZGFyLnNlcnZpY2UnO1xyXG5pbXBvcnQge0RhdGVDb21wYXJlcn0gZnJvbSAnLi4vY2xhc3Nlcy9kYXRlLWNvbXBhcmVyJztcclxuXHJcbmV4cG9ydCBjbGFzcyBDYWxlbmRhclJhbmdlIHtcclxuICBwdWJsaWMgc3RhcnQ6IERhdGU7XHJcbiAgcHVibGljIGRhdGVzOiBEYXRlW107XHJcbiAgcHVibGljIGl0ZW1zOiBDYWxlbmRhckl0ZW1bXTtcclxuICBwdWJsaWMgZ3JvdXBlZEl0ZW1zOiBDYWxlbmRhckl0ZW1bXVtdO1xyXG4gIHByaXZhdGUgX2NvbXBhcmVyOiBEYXRlQ29tcGFyZXI7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHN0YXJ0OiBEYXRlLCBkYXRlczogRGF0ZVtdLCBpdGVtczogQ2FsZW5kYXJJdGVtW10sIGdyb3VwZWQ6IENhbGVuZGFySXRlbVtdW10sIGNvbXBhcmVyOiBEYXRlQ29tcGFyZXIpIHtcclxuICAgIHRoaXMuc3RhcnQgPSBzdGFydDtcclxuICAgIHRoaXMuZGF0ZXMgPSBkYXRlcztcclxuICAgIHRoaXMuaXRlbXMgPSBpdGVtcztcclxuICAgIHRoaXMuZ3JvdXBlZEl0ZW1zID0gZ3JvdXBlZDtcclxuICAgIHRoaXMuX2NvbXBhcmVyID0gY29tcGFyZXI7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IGluUmFuZ2UoKTogQ2FsZW5kYXJJdGVtW10ge1xyXG4gICAgcmV0dXJuIHRoaXMuaXRlbXMuZmlsdGVyKGkgPT4gIWkuaXNPdXRzaWRlUmFuZ2UpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGZpbmQoaXRlbTogQ2FsZW5kYXJJdGVtKTogQ2FsZW5kYXJJdGVtIHwgdW5kZWZpbmVkIHtcclxuICAgIHJldHVybiB0aGlzLml0ZW1zLmZpbmQoaSA9PiB0aGlzLl9jb21wYXJlci5lcXVhbChpLmRhdGUsIGl0ZW0uZGF0ZSkpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGZpbmRJbmRleChpdGVtOiBDYWxlbmRhckl0ZW0gfCB1bmRlZmluZWQpOiBudW1iZXIge1xyXG4gICAgaWYgKCFpdGVtKSB7XHJcbiAgICAgIHJldHVybiAtMTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLml0ZW1zLmZpbmRJbmRleChpID0+IHRoaXMuX2NvbXBhcmVyLmVxdWFsKGkuZGF0ZSwgaXRlbS5kYXRlKSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgY29udGFpbnNEYXRlKGRhdGU6IERhdGUpOiBib29sZWFuIHtcclxuICAgIHJldHVybiAhIXRoaXMuaW5SYW5nZS5maW5kKGkgPT4gdGhpcy5fY29tcGFyZXIuZXF1YWwoaS5kYXRlLCBkYXRlKSk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQ2FsZW5kYXJSYW5nZVNlcnZpY2Uge1xyXG4gIHB1YmxpYyBwcmV2aW91czogQ2FsZW5kYXJSYW5nZTtcclxuICBwdWJsaWMgY3VycmVudDogQ2FsZW5kYXJSYW5nZTtcclxuICBwdWJsaWMgbmV4dDogQ2FsZW5kYXJSYW5nZTtcclxuXHJcbiAgcHVibGljIHNlcnZpY2U6IENhbGVuZGFyU2VydmljZTtcclxuXHJcbiAgcHVibGljIGludGVydmFsOiBEYXRlUHJlY2lzaW9uO1xyXG4gIHB1YmxpYyBtYXJnaW5hbDogRGF0ZVByZWNpc2lvbjtcclxuICBwdWJsaWMgcm93czogbnVtYmVyO1xyXG4gIHB1YmxpYyBjb2x1bW5zOiBudW1iZXI7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGludGVydmFsOiBEYXRlUHJlY2lzaW9uLCByb3dzOiBudW1iZXIsIGNvbHVtbnM6IG51bWJlcikge1xyXG4gICAgdGhpcy5pbnRlcnZhbCA9IGludGVydmFsO1xyXG4gICAgdGhpcy5tYXJnaW5hbCA9IGludGVydmFsIGFzIG51bWJlciArIDE7XHJcbiAgICB0aGlzLnJvd3MgPSByb3dzO1xyXG4gICAgdGhpcy5jb2x1bW5zID0gY29sdW1ucztcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgZGF0ZUNvbXBhcmVyKCk6IERhdGVDb21wYXJlciB7XHJcbiAgICByZXR1cm4gbmV3IERhdGVDb21wYXJlcih0aGlzLm1hcmdpbmFsLCB0aGlzLnNlcnZpY2UuaW5GaW5hbFZpZXcpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBsZW5ndGgoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLnJvd3MgKiB0aGlzLmNvbHVtbnM7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IGNhbk1vdmVOZXh0KCk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3QgZmlyc3RJdGVtID0gdGhpcy5uZXh0LmluUmFuZ2VbMF07XHJcbiAgICBpZiAoZmlyc3RJdGVtICYmIHRoaXMuc2VydmljZS5tYXhEYXRlKSB7XHJcbiAgICAgIHJldHVybiBmaXJzdEl0ZW0uZGF0ZSA8PSB0aGlzLnNlcnZpY2UubWF4RGF0ZTtcclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBjYW5Nb3ZlUHJldmlvdXMoKTogYm9vbGVhbiB7XHJcbiAgICBjb25zdCBsYXN0SXRlbSA9IHRoaXMucHJldmlvdXMuaW5SYW5nZS5zbGljZSgtMSkucG9wKCk7XHJcbiAgICBpZiAobGFzdEl0ZW0gJiYgdGhpcy5zZXJ2aWNlLm1pbkRhdGUpIHtcclxuICAgICAgcmV0dXJuIGxhc3RJdGVtLmRhdGUgPj0gdGhpcy5zZXJ2aWNlLm1pbkRhdGU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBsb2FkU2VydmljZShzZXJ2aWNlOiBDYWxlbmRhclNlcnZpY2UpOiB2b2lkIHtcclxuICAgIHRoaXMuc2VydmljZSA9IHNlcnZpY2U7XHJcblxyXG4gICAgdGhpcy5yZWZyZXNoKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcmVmcmVzaCgpOiB2b2lkIHtcclxuICAgIHRoaXMuY3VycmVudCA9IHRoaXMuY2FsY1JhbmdlKHRoaXMuc2VydmljZS5jdXJyZW50RGF0ZSk7XHJcblxyXG4gICAgdGhpcy5uZXh0ID0gdGhpcy5jYWxjUmFuZ2UoRGF0ZVV0aWwubmV4dCh0aGlzLmludGVydmFsLCBEYXRlVXRpbC5jbG9uZSh0aGlzLnNlcnZpY2UuY3VycmVudERhdGUpKSk7XHJcbiAgICB0aGlzLnByZXZpb3VzID0gdGhpcy5jYWxjUmFuZ2UoRGF0ZVV0aWwucHJldmlvdXModGhpcy5pbnRlcnZhbCwgRGF0ZVV0aWwuY2xvbmUodGhpcy5zZXJ2aWNlLmN1cnJlbnREYXRlKSkpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG1vdmUoZm9yd2FyZHM6IGJvb2xlYW4pOiB2b2lkIHtcclxuICAgIGlmIChmb3J3YXJkcykge1xyXG4gICAgICByZXR1cm4gdGhpcy5tb3ZlTmV4dCgpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMubW92ZVByZXZpb3VzKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgbW92ZU5leHQoKTogdm9pZCB7XHJcbiAgICBEYXRlVXRpbC5uZXh0KHRoaXMuaW50ZXJ2YWwsIHRoaXMuc2VydmljZS5jdXJyZW50RGF0ZSk7XHJcbiAgICB0aGlzLnByZXZpb3VzID0gdGhpcy5jdXJyZW50O1xyXG4gICAgdGhpcy5jdXJyZW50ID0gdGhpcy5uZXh0O1xyXG4gICAgdGhpcy5uZXh0ID0gdGhpcy5jYWxjUmFuZ2UoRGF0ZVV0aWwubmV4dCh0aGlzLmludGVydmFsLCBEYXRlVXRpbC5jbG9uZSh0aGlzLnNlcnZpY2UuY3VycmVudERhdGUpKSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgbW92ZVByZXZpb3VzKCk6IHZvaWQge1xyXG4gICAgRGF0ZVV0aWwucHJldmlvdXModGhpcy5pbnRlcnZhbCwgdGhpcy5zZXJ2aWNlLmN1cnJlbnREYXRlKTtcclxuICAgIHRoaXMubmV4dCA9IHRoaXMuY3VycmVudDtcclxuICAgIHRoaXMuY3VycmVudCA9IHRoaXMucHJldmlvdXM7XHJcbiAgICB0aGlzLnByZXZpb3VzID0gdGhpcy5jYWxjUmFuZ2UoRGF0ZVV0aWwucHJldmlvdXModGhpcy5pbnRlcnZhbCwgRGF0ZVV0aWwuY2xvbmUodGhpcy5zZXJ2aWNlLmN1cnJlbnREYXRlKSkpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGNhbGMoZm9yd2FyZHM6IGJvb2xlYW4pOiBDYWxlbmRhclJhbmdlIHtcclxuICAgIGlmIChmb3J3YXJkcykge1xyXG4gICAgICByZXR1cm4gdGhpcy5uZXh0O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMucHJldmlvdXM7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgY2FsY1N0YXJ0KGRhdGU6IERhdGUpOiBEYXRlIHtcclxuICAgIHJldHVybiBEYXRlVXRpbC5zdGFydE9mKHRoaXMuaW50ZXJ2YWwsIERhdGVVdGlsLmNsb25lKGRhdGUpKTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBjYWxjRGF0ZXMocmFuZ2VTdGFydDogRGF0ZSk6IERhdGVbXSB7XHJcbiAgICByZXR1cm4gVXRpbC5BcnJheVxyXG4gICAgICAucmFuZ2UodGhpcy5sZW5ndGgpXHJcbiAgICAgIC5tYXAoaSA9PiBEYXRlVXRpbC5hZGQodGhpcy5tYXJnaW5hbCwgRGF0ZVV0aWwuY2xvbmUocmFuZ2VTdGFydCksIGkpKTtcclxuXHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgY2FsY0l0ZW1zKGRhdGVSYW5nZTogRGF0ZVtdLCBiYXNlRGF0ZTogRGF0ZSk6IENhbGVuZGFySXRlbVtdIHtcclxuICAgIHJldHVybiBkYXRlUmFuZ2UubWFwKGRhdGUgPT4ge1xyXG4gICAgICBjb25zdCBpdGVtID0gbmV3IENhbGVuZGFySXRlbShkYXRlKTtcclxuXHJcbiAgICAgIGl0ZW0uaXNEaXNhYmxlZCA9ICF0aGlzLmRhdGVDb21wYXJlci5iZXR3ZWVuKGl0ZW0uZGF0ZSwgdGhpcy5zZXJ2aWNlLm1pbkRhdGUsIHRoaXMuc2VydmljZS5tYXhEYXRlKTtcclxuICAgICAgaXRlbS5pc0FjdGl2ZSA9IHRoaXMuZGF0ZUNvbXBhcmVyLmVxdWFsKGl0ZW0uZGF0ZSwgdGhpcy5zZXJ2aWNlLnNlbGVjdGVkRGF0ZSk7XHJcbiAgICAgIGl0ZW0uaXNUb2RheSA9IHRoaXMuZGF0ZUNvbXBhcmVyLmVxdWFsKGl0ZW0uZGF0ZSwgbmV3IERhdGUoKSk7XHJcbiAgICAgIGl0ZW0uaXNTZWxlY3RhYmxlID0gaXRlbS5pc0Rpc2FibGVkO1xyXG5cclxuICAgICAgdGhpcy5jb25maWd1cmVJdGVtKGl0ZW0sIGJhc2VEYXRlKTtcclxuXHJcbiAgICAgIHJldHVybiBpdGVtO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgYWJzdHJhY3QgY29uZmlndXJlSXRlbShpdGVtOiBDYWxlbmRhckl0ZW0sIGJhc2VEYXRlOiBEYXRlKTogdm9pZDtcclxuXHJcbiAgcHJpdmF0ZSBjYWxjUmFuZ2Uoc3RhcnREYXRlOiBEYXRlKTogQ2FsZW5kYXJSYW5nZSB7XHJcbiAgICBjb25zdCBzdGFydCA9IHRoaXMuY2FsY1N0YXJ0KHN0YXJ0RGF0ZSk7XHJcbiAgICBpZiAodGhpcy5zZXJ2aWNlLmluRmluYWxWaWV3KSB7XHJcbiAgICAgIERhdGVVdGlsLnN0YXJ0T2YodGhpcy5tYXJnaW5hbCwgc3RhcnQsIHRydWUpO1xyXG4gICAgfVxyXG4gICAgY29uc3QgZGF0ZXMgPSB0aGlzLmNhbGNEYXRlcyhzdGFydCk7XHJcbiAgICBjb25zdCBpdGVtcyA9IHRoaXMuY2FsY0l0ZW1zKGRhdGVzLCBzdGFydERhdGUpO1xyXG5cclxuICAgIHJldHVybiBuZXcgQ2FsZW5kYXJSYW5nZShzdGFydCwgZGF0ZXMsIGl0ZW1zLCBVdGlsLkFycmF5Lmdyb3VwKGl0ZW1zLCB0aGlzLmNvbHVtbnMpLCB0aGlzLmRhdGVDb21wYXJlcik7XHJcbiAgfVxyXG59XHJcbiJdfQ==