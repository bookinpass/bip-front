/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import Popper from 'popper.js';
/** @type {?} */
export var PositioningPlacement = {
    Auto: (/** @type {?} */ ('auto')),
    TopLeft: (/** @type {?} */ ('top left')),
    Top: (/** @type {?} */ ('top')),
    TopRight: (/** @type {?} */ ('top right')),
    LeftTop: (/** @type {?} */ ('left top')),
    Left: (/** @type {?} */ ('left')),
    LeftBottom: (/** @type {?} */ ('left bottom')),
    BottomLeft: (/** @type {?} */ ('bottom left')),
    Bottom: (/** @type {?} */ ('bottom')),
    BottomRight: (/** @type {?} */ ('bottom right')),
    RightTop: (/** @type {?} */ ('right top')),
    Right: (/** @type {?} */ ('right')),
    RightBottom: (/** @type {?} */ ('right bottom'))
};
/**
 * @record
 */
export function IPositionBoundingBox() { }
if (false) {
    /** @type {?} */
    IPositionBoundingBox.prototype.width;
    /** @type {?} */
    IPositionBoundingBox.prototype.height;
    /** @type {?} */
    IPositionBoundingBox.prototype.top;
    /** @type {?} */
    IPositionBoundingBox.prototype.left;
    /** @type {?} */
    IPositionBoundingBox.prototype.bottom;
    /** @type {?} */
    IPositionBoundingBox.prototype.right;
}
/**
 * @param {?} placement
 * @return {?}
 */
function placementToPopper(placement) {
    if (!placement || placement === PositioningPlacement.Auto) {
        return 'auto';
    }
    // All placements of the format: `direction alignment`, e.g. `top left`.
    var _a = tslib_1.__read(placement.split(' '), 2), direction = _a[0], alignment = _a[1];
    // Direction alone covers case of just `top`, `left`, `bottom`, `right`.
    /** @type {?} */
    var chosenPlacement = [direction];
    // Add `start` / `end` to placement, depending on alignment direction.
    switch (alignment) {
        case 'top':
        case 'left':
            chosenPlacement.push('start');
            break;
        case 'bottom':
        case 'right':
            chosenPlacement.push('end');
            break;
    }
    // Join with hyphen to create Popper compatible placement.
    return (/** @type {?} */ (chosenPlacement.join('-')));
}
/**
 * @param {?} popper
 * @return {?}
 */
function popperToPlacement(popper) {
    if (!popper || popper === 'auto') {
        return 'auto';
    }
    var _a = tslib_1.__read(popper.split('-'), 2), direction = _a[0], alignment = _a[1];
    /** @type {?} */
    var chosenPlacement = [direction];
    switch (direction) {
        case 'top':
        case 'bottom':
            switch (alignment) {
                case 'start':
                    chosenPlacement.push('left');
                    break;
                case 'end':
                    chosenPlacement.push('right');
                    break;
            }
            break;
        case 'left':
        case 'right':
            switch (alignment) {
                case 'start':
                    chosenPlacement.push('top');
                    break;
                case 'end':
                    chosenPlacement.push('bottom');
                    break;
            }
            break;
    }
    return (/** @type {?} */ (chosenPlacement.join(' ')));
}
var PositioningService = /** @class */ (function () {
    function PositioningService(anchor, subject, placement, arrowSelector) {
        this.anchor = anchor;
        this.subject = subject;
        this._placement = placement;
        this._arrowSelector = arrowSelector;
        this.init();
    }
    Object.defineProperty(PositioningService.prototype, "actualPlacement", {
        get: /**
         * @return {?}
         */
        function () {
            if (!this._popperState) {
                return PositioningPlacement.Auto;
            }
            return popperToPlacement(this._popperState.placement);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PositioningService.prototype, "state", {
        get: /**
         * @return {?}
         */
        function () {
            return this._popperState;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PositioningService.prototype, "placement", {
        get: /**
         * @return {?}
         */
        function () {
            return this._placement;
        },
        set: /**
         * @param {?} placement
         * @return {?}
         */
        function (placement) {
            this._placement = placement;
            if (this._popper) {
                this._popper.options.placement = placementToPopper(placement);
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PositioningService.prototype, "hasArrow", {
        set: /**
         * @param {?} hasArrow
         * @return {?}
         */
        function (hasArrow) {
            this._hasArrow = hasArrow;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    PositioningService.prototype.init = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var modifiers = {
            computeStyle: {
                gpuAcceleration: false
            },
            preventOverflow: {
                escapeWithReference: true,
                boundariesElement: document.body
            },
            arrow: {
                element: this._arrowSelector
            },
            offset: {
                fn: (/**
                 * @param {?} data
                 * @return {?}
                 */
                function (data) {
                    if (_this._hasArrow) {
                        /** @type {?} */
                        var offsets = _this.calculateOffsets();
                        data.offsets.popper.left += offsets.left;
                        data.offsets.popper.top += offsets.top;
                    }
                    return data;
                })
            }
        };
        if (!this._arrowSelector) {
            delete modifiers.arrow;
        }
        this._popper = (/** @type {?} */ (new Popper(this.anchor.nativeElement, this.subject.nativeElement, {
            placement: placementToPopper(this._placement),
            modifiers: modifiers,
            onCreate: (/**
             * @param {?} initial
             * @return {?}
             */
            function (initial) { return _this._popperState = initial; }),
            onUpdate: (/**
             * @param {?} update
             * @return {?}
             */
            function (update) { return _this._popperState = update; })
        })));
    };
    /**
     * @return {?}
     */
    PositioningService.prototype.update = /**
     * @return {?}
     */
    function () {
        this._popper.update();
    };
    /**
     * @return {?}
     */
    PositioningService.prototype.destroy = /**
     * @return {?}
     */
    function () {
        this._popper.destroy();
    };
    /**
     * @private
     * @return {?}
     */
    PositioningService.prototype.calculateOffsets = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var left = 0;
        /** @type {?} */
        var top = 0;
        // To support correct positioning for all popup sizes we should calculate offset using em
        /** @type {?} */
        var fontSize = parseFloat(window.getComputedStyle(this.subject.nativeElement).getPropertyValue('font-size'));
        // The Fomantic UI popup arrow width and height are 0.71428571em and the margin from the popup edge is 1em
        /** @type {?} */
        var arrowCenter = (0.71428571 / 2 + 1) * fontSize;
        if (this.anchor.nativeElement.offsetWidth <= arrowCenter * 2) {
            /** @type {?} */
            var anchorCenterWidth = this.anchor.nativeElement.offsetWidth / 2;
            if (this._placement === PositioningPlacement.TopLeft || this._placement === PositioningPlacement.BottomLeft) {
                left = anchorCenterWidth - arrowCenter;
            }
            if (this._placement === PositioningPlacement.TopRight || this._placement === PositioningPlacement.BottomRight) {
                left = arrowCenter - anchorCenterWidth;
            }
        }
        if (this.anchor.nativeElement.offsetHeight <= arrowCenter * 2) {
            /** @type {?} */
            var anchorCenterHeight = this.anchor.nativeElement.offsetHeight / 2;
            if (this._placement === PositioningPlacement.LeftTop || this._placement === PositioningPlacement.RightTop) {
                top = anchorCenterHeight - arrowCenter;
            }
            if (this._placement === PositioningPlacement.LeftBottom || this._placement === PositioningPlacement.RightBottom) {
                top = arrowCenter - anchorCenterHeight;
            }
        }
        return { top: top, left: left, width: 0, height: 0 };
    };
    return PositioningService;
}());
export { PositioningService };
if (false) {
    /** @type {?} */
    PositioningService.prototype.anchor;
    /** @type {?} */
    PositioningService.prototype.subject;
    /**
     * @type {?}
     * @private
     */
    PositioningService.prototype._popper;
    /**
     * @type {?}
     * @private
     */
    PositioningService.prototype._popperState;
    /**
     * @type {?}
     * @private
     */
    PositioningService.prototype._arrowSelector;
    /**
     * @type {?}
     * @private
     */
    PositioningService.prototype._placement;
    /**
     * @type {?}
     * @private
     */
    PositioningService.prototype._hasArrow;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9zaXRpb25pbmcuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1mb21hbnRpYy11aS8iLCJzb3VyY2VzIjpbIm1pc2MvdXRpbC9zZXJ2aWNlcy9wb3NpdGlvbmluZy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EsT0FBTyxNQUFtRCxNQUFNLFdBQVcsQ0FBQzs7QUFtQjVFLE1BQU0sS0FBTyxvQkFBb0IsR0FBRztJQUNsQyxJQUFJLEVBQUUsbUJBQUEsTUFBTSxFQUF3QjtJQUNwQyxPQUFPLEVBQUUsbUJBQUEsVUFBVSxFQUF3QjtJQUMzQyxHQUFHLEVBQUUsbUJBQUEsS0FBSyxFQUF3QjtJQUNsQyxRQUFRLEVBQUUsbUJBQUEsV0FBVyxFQUF3QjtJQUM3QyxPQUFPLEVBQUUsbUJBQUEsVUFBVSxFQUF3QjtJQUMzQyxJQUFJLEVBQUUsbUJBQUEsTUFBTSxFQUF3QjtJQUNwQyxVQUFVLEVBQUUsbUJBQUEsYUFBYSxFQUF3QjtJQUNqRCxVQUFVLEVBQUUsbUJBQUEsYUFBYSxFQUF3QjtJQUNqRCxNQUFNLEVBQUUsbUJBQUEsUUFBUSxFQUF3QjtJQUN4QyxXQUFXLEVBQUUsbUJBQUEsY0FBYyxFQUF3QjtJQUNuRCxRQUFRLEVBQUUsbUJBQUEsV0FBVyxFQUF3QjtJQUM3QyxLQUFLLEVBQUUsbUJBQUEsT0FBTyxFQUF3QjtJQUN0QyxXQUFXLEVBQUUsbUJBQUEsY0FBYyxFQUF3QjtDQUNwRDs7OztBQUVELDBDQU9DOzs7SUFOQyxxQ0FBYzs7SUFDZCxzQ0FBZTs7SUFDZixtQ0FBWTs7SUFDWixvQ0FBYTs7SUFDYixzQ0FBZTs7SUFDZixxQ0FBYzs7Ozs7O0FBR2hCLFNBQVMsaUJBQWlCLENBQUMsU0FBK0I7SUFDeEQsSUFBSSxDQUFDLFNBQVMsSUFBSSxTQUFTLEtBQUssb0JBQW9CLENBQUMsSUFBSSxFQUFFO1FBQ3pELE9BQU8sTUFBTSxDQUFDO0tBQ2Y7O0lBR0ssSUFBQSw0Q0FBNkMsRUFBNUMsaUJBQVMsRUFB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VyxHQUFHLGlCQUFpQixDQUFDO2FBQ3hDO1NBQ0Y7UUFFRCxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLFlBQVksSUFBSSxXQUFXLEdBQUcsQ0FBQyxFQUFFOztnQkFDdkQsa0JBQWtCLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsWUFBWSxHQUFHLENBQUM7WUFDckUsSUFBSSxJQUFJLENBQUMsVUFBVSxLQUFLLG9CQUFvQixDQUFDLE9BQU8sSUFBSSxJQUFJLENBQUMsVUFBVSxLQUFLLG9CQUFvQixDQUFDLFFBQVEsRUFBRTtnQkFDekcsR0FBRyxHQUFHLGtCQUFrQixHQUFHLFdBQVcsQ0FBQzthQUN4QztZQUNELElBQUksSUFBSSxDQUFDLFVBQVUsS0FBSyxvQkFBb0IsQ0FBQyxVQUFVLElBQUksSUFBSSxDQUFDLFVBQVUsS0FBSyxvQkFBb0IsQ0FBQyxXQUFXLEVBQUU7Z0JBQy9HLEdBQUcsR0FBRyxXQUFXLEdBQUcsa0JBQWtCLENBQUM7YUFDeEM7U0FDRjtRQUNELE9BQU8sRUFBQyxHQUFHLEtBQUEsRUFBRSxJQUFJLE1BQUEsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUMsQ0FBQztJQUMxQyxDQUFDO0lBRUgseUJBQUM7QUFBRCxDQUFDLEFBN0hELElBNkhDOzs7O0lBM0hDLG9DQUFtQzs7SUFDbkMscUNBQW9DOzs7OztJQUNwQyxxQ0FBZ0M7Ozs7O0lBQ2hDLDBDQUEyQjs7Ozs7SUFDM0IsNENBQTJDOzs7OztJQXNCM0Msd0NBQXlDOzs7OztJQWF6Qyx1Q0FBMkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0VsZW1lbnRSZWZ9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgUG9wcGVyLCB7RGF0YSwgTW9kaWZpZXJzLCBQbGFjZW1lbnQsIFBvcHBlck9wdGlvbnN9IGZyb20gJ3BvcHBlci5qcyc7XHJcblxyXG50eXBlIFBvcHBlck1vZGlmaWVycyA9IE1vZGlmaWVycyAmIHtcclxuICBjb21wdXRlU3R5bGU/OiB7XHJcbiAgICBncHVBY2NlbGVyYXRpb246IGJvb2xlYW47XHJcbiAgfTtcclxufTtcclxudHlwZSBQb3BwZXJJbnN0YW5jZSA9IFBvcHBlciAmIHtcclxuICBvcHRpb25zOiBQb3BwZXJPcHRpb25zICYge1xyXG4gICAgbW9kaWZpZXJzOiBQb3BwZXJNb2RpZmllcnM7XHJcbiAgfTtcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIFBvc2l0aW9uaW5nUGxhY2VtZW50ID0gJ2F1dG8nIHxcclxuICAndG9wIGxlZnQnIHwgJ3RvcCcgfCAndG9wIHJpZ2h0JyB8XHJcbiAgJ2JvdHRvbSBsZWZ0JyB8ICdib3R0b20nIHwgJ2JvdHRvbSByaWdodCcgfFxyXG4gICdsZWZ0IHRvcCcgfCAnbGVmdCcgfCAnbGVmdCBib3R0b20nIHxcclxuICAncmlnaHQgdG9wJyB8ICdyaWdodCcgfCAncmlnaHQgYm90dG9tJztcclxuXHJcbmV4cG9ydCBjb25zdCBQb3NpdGlvbmluZ1BsYWNlbWVudCA9IHtcclxuICBBdXRvOiAnYXV0bycgYXMgUG9zaXRpb25pbmdQbGFjZW1lbnQsXHJcbiAgVG9wTGVmdDogJ3RvcCBsZWZ0JyBhcyBQb3NpdGlvbmluZ1BsYWNlbWVudCxcclxuICBUb3A6ICd0b3AnIGFzIFBvc2l0aW9uaW5nUGxhY2VtZW50LFxyXG4gIFRvcFJpZ2h0OiAndG9wIHJpZ2h0JyBhcyBQb3NpdGlvbmluZ1BsYWNlbWVudCxcclxuICBMZWZ0VG9wOiAnbGVmdCB0b3AnIGFzIFBvc2l0aW9uaW5nUGxhY2VtZW50LFxyXG4gIExlZnQ6ICdsZWZ0JyBhcyBQb3NpdGlvbmluZ1BsYWNlbWVudCxcclxuICBMZWZ0Qm90dG9tOiAnbGVmdCBib3R0b20nIGFzIFBvc2l0aW9uaW5nUGxhY2VtZW50LFxyXG4gIEJvdHRvbUxlZnQ6ICdib3R0b20gbGVmdCcgYXMgUG9zaXRpb25pbmdQbGFjZW1lbnQsXHJcbiAgQm90dG9tOiAnYm90dG9tJyBhcyBQb3NpdGlvbmluZ1BsYWNlbWVudCxcclxuICBCb3R0b21SaWdodDogJ2JvdHRvbSByaWdodCcgYXMgUG9zaXRpb25pbmdQbGFjZW1lbnQsXHJcbiAgUmlnaHRUb3A6ICdyaWdodCB0b3AnIGFzIFBvc2l0aW9uaW5nUGxhY2VtZW50LFxyXG4gIFJpZ2h0OiAncmlnaHQnIGFzIFBvc2l0aW9uaW5nUGxhY2VtZW50LFxyXG4gIFJpZ2h0Qm90dG9tOiAncmlnaHQgYm90dG9tJyBhcyBQb3NpdGlvbmluZ1BsYWNlbWVudFxyXG59O1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBJUG9zaXRpb25Cb3VuZGluZ0JveCB7XHJcbiAgd2lkdGg6IG51bWJlcjtcclxuICBoZWlnaHQ6IG51bWJlcjtcclxuICB0b3A6IG51bWJlcjtcclxuICBsZWZ0OiBudW1iZXI7XHJcbiAgYm90dG9tOiBudW1iZXI7XHJcbiAgcmlnaHQ6IG51bWJlcjtcclxufVxyXG5cclxuZnVuY3Rpb24gcGxhY2VtZW50VG9Qb3BwZXIocGxhY2VtZW50OiBQb3NpdGlvbmluZ1BsYWNlbWVudCk6IFBsYWNlbWVudCB7XHJcbiAgaWYgKCFwbGFjZW1lbnQgfHwgcGxhY2VtZW50ID09PSBQb3NpdGlvbmluZ1BsYWNlbWVudC5BdXRvKSB7XHJcbiAgICByZXR1cm4gJ2F1dG8nO1xyXG4gIH1cclxuXHJcbiAgLy8gQWxsIHBsYWNlbWVudHMgb2YgdGhlIGZvcm1hdDogYGRpcmVjdGlvbiBhbGlnbm1lbnRgLCBlLmcuIGB0b3AgbGVmdGAuXHJcbiAgY29uc3QgW2RpcmVjdGlvbiwgYWxpZ25tZW50XSA9IHBsYWNlbWVudC5zcGxpdCgnICcpO1xyXG5cclxuICAvLyBEaXJlY3Rpb24gYWxvbmUgY292ZXJzIGNhc2Ugb2YganVzdCBgdG9wYCwgYGxlZnRgLCBgYm90dG9tYCwgYHJpZ2h0YC5cclxuICBjb25zdCBjaG9zZW5QbGFjZW1lbnQgPSBbZGlyZWN0aW9uXTtcclxuXHJcbiAgLy8gQWRkIGBzdGFydGAgLyBgZW5kYCB0byBwbGFjZW1lbnQsIGRlcGVuZGluZyBvbiBhbGlnbm1lbnQgZGlyZWN0aW9uLlxyXG4gIHN3aXRjaCAoYWxpZ25tZW50KSB7XHJcbiAgICBjYXNlICd0b3AnOlxyXG4gICAgY2FzZSAnbGVmdCc6XHJcbiAgICAgIGNob3NlblBsYWNlbWVudC5wdXNoKCdzdGFydCcpO1xyXG4gICAgICBicmVhaztcclxuICAgIGNhc2UgJ2JvdHRvbSc6XHJcbiAgICBjYXNlICdyaWdodCc6XHJcbiAgICAgIGNob3NlblBsYWNlbWVudC5wdXNoKCdlbmQnKTtcclxuICAgICAgYnJlYWs7XHJcbiAgfVxyXG5cclxuICAvLyBKb2luIHdpdGggaHlwaGVuIHRvIGNyZWF0ZSBQb3BwZXIgY29tcGF0aWJsZSBwbGFjZW1lbnQuXHJcbiAgcmV0dXJuIGNob3NlblBsYWNlbWVudC5qb2luKCctJykgYXMgUGxhY2VtZW50O1xyXG59XHJcblxyXG5mdW5jdGlvbiBwb3BwZXJUb1BsYWNlbWVudChwb3BwZXI6IHN0cmluZyk6IFBvc2l0aW9uaW5nUGxhY2VtZW50IHtcclxuICBpZiAoIXBvcHBlciB8fCBwb3BwZXIgPT09ICdhdXRvJykge1xyXG4gICAgcmV0dXJuICdhdXRvJztcclxuICB9XHJcblxyXG4gIGNvbnN0IFtkaXJlY3Rpb24sIGFsaWdubWVudF0gPSBwb3BwZXIuc3BsaXQoJy0nKTtcclxuXHJcbiAgY29uc3QgY2hvc2VuUGxhY2VtZW50ID0gW2RpcmVjdGlvbl07XHJcblxyXG4gIHN3aXRjaCAoZGlyZWN0aW9uKSB7XHJcbiAgICBjYXNlICd0b3AnOlxyXG4gICAgY2FzZSAnYm90dG9tJzpcclxuICAgICAgc3dpdGNoIChhbGlnbm1lbnQpIHtcclxuICAgICAgICBjYXNlICdzdGFydCc6XHJcbiAgICAgICAgICBjaG9zZW5QbGFjZW1lbnQucHVzaCgnbGVmdCcpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnZW5kJzpcclxuICAgICAgICAgIGNob3NlblBsYWNlbWVudC5wdXNoKCdyaWdodCcpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlICdsZWZ0JzpcclxuICAgIGNhc2UgJ3JpZ2h0JzpcclxuICAgICAgc3dpdGNoIChhbGlnbm1lbnQpIHtcclxuICAgICAgICBjYXNlICdzdGFydCc6XHJcbiAgICAgICAgICBjaG9zZW5QbGFjZW1lbnQucHVzaCgndG9wJyk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdlbmQnOlxyXG4gICAgICAgICAgY2hvc2VuUGxhY2VtZW50LnB1c2goJ2JvdHRvbScpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgICAgYnJlYWs7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gY2hvc2VuUGxhY2VtZW50LmpvaW4oJyAnKSBhcyBQb3NpdGlvbmluZ1BsYWNlbWVudDtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFBvc2l0aW9uaW5nU2VydmljZSB7XHJcblxyXG4gIHB1YmxpYyByZWFkb25seSBhbmNob3I6IEVsZW1lbnRSZWY7XHJcbiAgcHVibGljIHJlYWRvbmx5IHN1YmplY3Q6IEVsZW1lbnRSZWY7XHJcbiAgcHJpdmF0ZSBfcG9wcGVyOiBQb3BwZXJJbnN0YW5jZTtcclxuICBwcml2YXRlIF9wb3BwZXJTdGF0ZTogRGF0YTtcclxuICBwcml2YXRlIF9hcnJvd1NlbGVjdG9yOiBzdHJpbmcgfCB1bmRlZmluZWQ7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGFuY2hvcjogRWxlbWVudFJlZiwgc3ViamVjdDogRWxlbWVudFJlZiwgcGxhY2VtZW50OiBQb3NpdGlvbmluZ1BsYWNlbWVudCwgYXJyb3dTZWxlY3Rvcj86IHN0cmluZykge1xyXG4gICAgdGhpcy5hbmNob3IgPSBhbmNob3I7XHJcbiAgICB0aGlzLnN1YmplY3QgPSBzdWJqZWN0O1xyXG4gICAgdGhpcy5fcGxhY2VtZW50ID0gcGxhY2VtZW50O1xyXG4gICAgdGhpcy5fYXJyb3dTZWxlY3RvciA9IGFycm93U2VsZWN0b3I7XHJcbiAgICB0aGlzLmluaXQoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgYWN0dWFsUGxhY2VtZW50KCk6IFBvc2l0aW9uaW5nUGxhY2VtZW50IHtcclxuICAgIGlmICghdGhpcy5fcG9wcGVyU3RhdGUpIHtcclxuICAgICAgcmV0dXJuIFBvc2l0aW9uaW5nUGxhY2VtZW50LkF1dG87XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHBvcHBlclRvUGxhY2VtZW50KHRoaXMuX3BvcHBlclN0YXRlLnBsYWNlbWVudCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IHN0YXRlKCk6IERhdGEge1xyXG4gICAgcmV0dXJuIHRoaXMuX3BvcHBlclN0YXRlO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfcGxhY2VtZW50OiBQb3NpdGlvbmluZ1BsYWNlbWVudDtcclxuXHJcbiAgcHVibGljIGdldCBwbGFjZW1lbnQoKTogUG9zaXRpb25pbmdQbGFjZW1lbnQge1xyXG4gICAgcmV0dXJuIHRoaXMuX3BsYWNlbWVudDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXQgcGxhY2VtZW50KHBsYWNlbWVudDogUG9zaXRpb25pbmdQbGFjZW1lbnQpIHtcclxuICAgIHRoaXMuX3BsYWNlbWVudCA9IHBsYWNlbWVudDtcclxuICAgIGlmICh0aGlzLl9wb3BwZXIpIHtcclxuICAgICAgdGhpcy5fcG9wcGVyLm9wdGlvbnMucGxhY2VtZW50ID0gcGxhY2VtZW50VG9Qb3BwZXIocGxhY2VtZW50KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgX2hhc0Fycm93OiBib29sZWFuO1xyXG5cclxuICBwdWJsaWMgc2V0IGhhc0Fycm93KGhhc0Fycm93OiBib29sZWFuKSB7XHJcbiAgICB0aGlzLl9oYXNBcnJvdyA9IGhhc0Fycm93O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGluaXQoKTogdm9pZCB7XHJcbiAgICBjb25zdCBtb2RpZmllcnM6IFBvcHBlck1vZGlmaWVycyA9IHtcclxuICAgICAgY29tcHV0ZVN0eWxlOiB7XHJcbiAgICAgICAgZ3B1QWNjZWxlcmF0aW9uOiBmYWxzZVxyXG4gICAgICB9LFxyXG4gICAgICBwcmV2ZW50T3ZlcmZsb3c6IHtcclxuICAgICAgICBlc2NhcGVXaXRoUmVmZXJlbmNlOiB0cnVlLFxyXG4gICAgICAgIGJvdW5kYXJpZXNFbGVtZW50OiBkb2N1bWVudC5ib2R5XHJcbiAgICAgIH0sXHJcbiAgICAgIGFycm93OiB7XHJcbiAgICAgICAgZWxlbWVudDogdGhpcy5fYXJyb3dTZWxlY3RvclxyXG4gICAgICB9LFxyXG4gICAgICBvZmZzZXQ6IHtcclxuICAgICAgICBmbjogKGRhdGE6IFBvcHBlci5EYXRhKSA9PiB7XHJcbiAgICAgICAgICBpZiAodGhpcy5faGFzQXJyb3cpIHtcclxuICAgICAgICAgICAgY29uc3Qgb2Zmc2V0cyA9IHRoaXMuY2FsY3VsYXRlT2Zmc2V0cygpO1xyXG4gICAgICAgICAgICBkYXRhLm9mZnNldHMucG9wcGVyLmxlZnQgKz0gb2Zmc2V0cy5sZWZ0O1xyXG4gICAgICAgICAgICBkYXRhLm9mZnNldHMucG9wcGVyLnRvcCArPSBvZmZzZXRzLnRvcDtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoIXRoaXMuX2Fycm93U2VsZWN0b3IpIHtcclxuICAgICAgZGVsZXRlIG1vZGlmaWVycy5hcnJvdztcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLl9wb3BwZXIgPSBuZXcgUG9wcGVyKFxyXG4gICAgICB0aGlzLmFuY2hvci5uYXRpdmVFbGVtZW50LFxyXG4gICAgICB0aGlzLnN1YmplY3QubmF0aXZlRWxlbWVudCxcclxuICAgICAge1xyXG4gICAgICAgIHBsYWNlbWVudDogcGxhY2VtZW50VG9Qb3BwZXIodGhpcy5fcGxhY2VtZW50KSxcclxuICAgICAgICBtb2RpZmllcnMsXHJcbiAgICAgICAgb25DcmVhdGU6IGluaXRpYWwgPT4gdGhpcy5fcG9wcGVyU3RhdGUgPSBpbml0aWFsLFxyXG4gICAgICAgIG9uVXBkYXRlOiB1cGRhdGUgPT4gdGhpcy5fcG9wcGVyU3RhdGUgPSB1cGRhdGVcclxuICAgICAgfSkgYXMgUG9wcGVySW5zdGFuY2U7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgdXBkYXRlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5fcG9wcGVyLnVwZGF0ZSgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICB0aGlzLl9wb3BwZXIuZGVzdHJveSgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjYWxjdWxhdGVPZmZzZXRzKCk6IFBvcHBlci5PZmZzZXQge1xyXG4gICAgbGV0IGxlZnQgPSAwO1xyXG4gICAgbGV0IHRvcCA9IDA7XHJcblxyXG4gICAgLy8gVG8gc3VwcG9ydCBjb3JyZWN0IHBvc2l0aW9uaW5nIGZvciBhbGwgcG9wdXAgc2l6ZXMgd2Ugc2hvdWxkIGNhbGN1bGF0ZSBvZmZzZXQgdXNpbmcgZW1cclxuICAgIGNvbnN0IGZvbnRTaXplID0gcGFyc2VGbG9hdCh3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLnN1YmplY3QubmF0aXZlRWxlbWVudCkuZ2V0UHJvcGVydHlWYWx1ZSgnZm9udC1zaXplJykpO1xyXG4gICAgLy8gVGhlIEZvbWFudGljIFVJIHBvcHVwIGFycm93IHdpZHRoIGFuZCBoZWlnaHQgYXJlIDAuNzE0Mjg1NzFlbSBhbmQgdGhlIG1hcmdpbiBmcm9tIHRoZSBwb3B1cCBlZGdlIGlzIDFlbVxyXG4gICAgY29uc3QgYXJyb3dDZW50ZXIgPSAoMC43MTQyODU3MSAvIDIgKyAxKSAqIGZvbnRTaXplO1xyXG5cclxuICAgIGlmICh0aGlzLmFuY2hvci5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoIDw9IGFycm93Q2VudGVyICogMikge1xyXG4gICAgICBjb25zdCBhbmNob3JDZW50ZXJXaWR0aCA9IHRoaXMuYW5jaG9yLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGggLyAyO1xyXG4gICAgICBpZiAodGhpcy5fcGxhY2VtZW50ID09PSBQb3NpdGlvbmluZ1BsYWNlbWVudC5Ub3BMZWZ0IHx8IHRoaXMuX3BsYWNlbWVudCA9PT0gUG9zaXRpb25pbmdQbGFjZW1lbnQuQm90dG9tTGVmdCkge1xyXG4gICAgICAgIGxlZnQgPSBhbmNob3JDZW50ZXJXaWR0aCAtIGFycm93Q2VudGVyO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh0aGlzLl9wbGFjZW1lbnQgPT09IFBvc2l0aW9uaW5nUGxhY2VtZW50LlRvcFJpZ2h0IHx8IHRoaXMuX3BsYWNlbWVudCA9PT0gUG9zaXRpb25pbmdQbGFjZW1lbnQuQm90dG9tUmlnaHQpIHtcclxuICAgICAgICBsZWZ0ID0gYXJyb3dDZW50ZXIgLSBhbmNob3JDZW50ZXJXaWR0aDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmFuY2hvci5uYXRpdmVFbGVtZW50Lm9mZnNldEhlaWdodCA8PSBhcnJvd0NlbnRlciAqIDIpIHtcclxuICAgICAgY29uc3QgYW5jaG9yQ2VudGVySGVpZ2h0ID0gdGhpcy5hbmNob3IubmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQgLyAyO1xyXG4gICAgICBpZiAodGhpcy5fcGxhY2VtZW50ID09PSBQb3NpdGlvbmluZ1BsYWNlbWVudC5MZWZ0VG9wIHx8IHRoaXMuX3BsYWNlbWVudCA9PT0gUG9zaXRpb25pbmdQbGFjZW1lbnQuUmlnaHRUb3ApIHtcclxuICAgICAgICB0b3AgPSBhbmNob3JDZW50ZXJIZWlnaHQgLSBhcnJvd0NlbnRlcjtcclxuICAgICAgfVxyXG4gICAgICBpZiAodGhpcy5fcGxhY2VtZW50ID09PSBQb3NpdGlvbmluZ1BsYWNlbWVudC5MZWZ0Qm90dG9tIHx8IHRoaXMuX3BsYWNlbWVudCA9PT0gUG9zaXRpb25pbmdQbGFjZW1lbnQuUmlnaHRCb3R0b20pIHtcclxuICAgICAgICB0b3AgPSBhcnJvd0NlbnRlciAtIGFuY2hvckNlbnRlckhlaWdodDtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHt0b3AsIGxlZnQsIHdpZHRoOiAwLCBoZWlnaHQ6IDB9O1xyXG4gIH1cclxuXHJcbn1cclxuIl19