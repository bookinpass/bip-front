/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Directive, ElementRef, EventEmitter, Input, Output, ViewChild, ViewContainerRef } from '@angular/core';
import { CustomValueAccessor, customValueAccessorFactory } from '../../../misc/util/internal';
import { FuiLocalizationService } from '../../../behaviors/localization/internal';
import { FuiSelectBase } from '../classes/select-base';
/**
 * @template T, U
 */
var FuiSelect = /** @class */ (function (_super) {
    tslib_1.__extends(FuiSelect, _super);
    function FuiSelect(element, localizationService) {
        var _this = _super.call(this, element, localizationService) || this;
        _this.selectedOptionChange = new EventEmitter();
        return _this;
    }
    Object.defineProperty(FuiSelect.prototype, "placeholder", {
        get: /**
         * @return {?}
         */
        function () {
            return this._placeholder || this.localeValues.single.placeholder;
        },
        set: /**
         * @param {?} placeholder
         * @return {?}
         */
        function (placeholder) {
            this._placeholder = placeholder;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} option
     * @return {?}
     */
    FuiSelect.prototype.selectOption = /**
     * @param {?} option
     * @return {?}
     */
    function (option) {
        // Choose and emit the selected option.
        this.selectedOption = option;
        this.selectedOptionChange.emit(this.valueGetter(option));
        this.dropdownService.setOpenState(false);
        this.resetQuery();
        this.drawSelectedOption();
        // Automatically refocus the search input for better keyboard accessibility.
        this.focus();
    };
    /**
     * @param {?} value
     * @return {?}
     */
    FuiSelect.prototype.writeValue = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        var _this = this;
        if (value != undefined) {
            if (this.searchService.options.length > 0) {
                // If the options have already been loaded, we can immediately match the ngModel value to an option.
                this.selectedOption = this.findOption(this.searchService.options, value);
                this.drawSelectedOption();
            }
            if (this.selectedOption == undefined) {
                if (this.valueField && this.searchService.hasItemLookup) {
                    // If the search service has a selected lookup function, make use of that to load the initial value.
                    this.searchService
                        .initialLookup(value)
                        .then((/**
                     * @param {?} i
                     * @return {?}
                     */
                    function (i) {
                        _this.selectedOption = i;
                        _this.drawSelectedOption();
                    }));
                }
                else {
                    // Otherwise, cache the written value for when options are set.
                    this._writtenOption = value;
                }
            }
        }
        else {
            this.selectedOption = undefined;
            this.drawSelectedOption();
        }
    };
    /**
     * @param {?} e
     * @return {?}
     */
    FuiSelect.prototype.onRemoveClick = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        if (!e.eventHandled) {
            e.eventHandled = true;
            this.selectedOption = undefined;
            this.selectedOptionChange.emit(undefined);
            this._renderedOptions.forEach((/**
             * @param {?} o
             * @return {?}
             */
            function (o) { return o.isActive = false; }));
        }
    };
    /**
     * @protected
     * @return {?}
     */
    FuiSelect.prototype.optionsUpdateHook = /**
     * @protected
     * @return {?}
     */
    function () {
        if (!this._writtenOption && this.selectedOption) {
            // We need to check the option still exists.
            this.writeValue(this.valueGetter(this.selectedOption));
        }
        if (this._writtenOption && this.searchService.options.length > 0) {
            // If there was an value written by ngModel before the options had been loaded, this runs to fix it.
            this.selectedOption = this.findOption(this.searchService.options, this._writtenOption);
            if (this.selectedOption) {
                this._writtenOption = undefined;
                this.drawSelectedOption();
            }
        }
    };
    /**
     * @protected
     * @return {?}
     */
    FuiSelect.prototype.queryUpdateHook = /**
     * @protected
     * @return {?}
     */
    function () {
        // When the query is updated, we just abandon the current selection.
        this.selectedOption = undefined;
    };
    /**
     * @protected
     * @param {?} option
     * @return {?}
     */
    FuiSelect.prototype.initialiseRenderedOption = /**
     * @protected
     * @param {?} option
     * @return {?}
     */
    function (option) {
        _super.prototype.initialiseRenderedOption.call(this, option);
        // Boldens the item so it appears selected in the dropdown.
        option.isActive = option.value === this.selectedOption;
    };
    /**
     * @private
     * @return {?}
     */
    FuiSelect.prototype.drawSelectedOption = /**
     * @private
     * @return {?}
     */
    function () {
        // Updates the active class on the newly selected option.
        if (this._renderedOptions) {
            this.onAvailableOptionsRendered();
        }
        if (this.selectedOption != undefined && this.optionTemplate) {
            this.drawTemplate(this._optionTemplateSibling, this.selectedOption);
        }
    };
    FuiSelect.decorators = [
        { type: Component, args: [{
                    selector: 'fui-select',
                    template: "\n                   <!-- Query input -->\n                   <input fuiSelectSearch\n                          type=\"text\"\n                          [hidden]=\"!isSearchable || isSearchExternal\">\n\n                   <!-- Placeholder text -->\n                   <div *ngIf=\"selectedOption == undefined\" class=\"default text\" [class.filtered]=\"query\">{{ placeholder }}</div>\n                   <!-- Selected item -->\n                   <div class=\"text\" [class.filtered]=\"query || selectedOption == undefined\">\n                       <span #optionTemplateSibling></span>\n                       <span *ngIf=\"!optionTemplate && selectedOption != undefined\"\n                             [innerHTML]=\"configuredFormatter(selectedOption)\"></span>\n                   </div>\n                   <!-- Dropdown icon -->\n                   <i *ngIf=\"selectedOption && !isSearching && isClearable\" class=\"times icon\"\n                      (click)=\"onRemoveClick($event)\"></i>\n                   <i *ngIf=\"!selectedOption || !isClearable\" class=\"{{ icon }} icon\" (click)=\"onCaretClick($event)\"></i>\n                   <!-- Select dropdown menu -->\n                   <div class=\"menu\"\n                        fuiDropdownMenu\n                        [menuTransition]=\"transition\"\n                        [menuTransitionDuration]=\"transitionDuration\"\n                        [menuAutoSelectFirst]=\"isSearchable\">\n\n                       <ng-content></ng-content>\n                       <div *ngIf=\"isSearchable && availableOptions.length === 0\" class=\"message\">\n                           {{ localeValues.noResultsMessage }}\n                       </div>\n                   </div>\n               ",
                    styles: ["\n                   :host .times.icon {\n                       position: absolute;\n                       width: auto;\n                       height: auto;\n                       line-height: 1.21428571em;\n                       top: .78571429em;\n                       right: 1em;\n                       margin: -.78571429em;\n                       opacity: .6;\n                       font-size: 1.07142857em;\n                       padding: .6em;\n                       -webkit-transition: opacity .1s ease;\n                       transition: opacity .1s ease;\n                       z-index: 3;\n                   }\n\n                   :host .times.icon.larger {\n                       padding: .91666667em;\n                       font-size: .85714286em;\n                   }\n\n                   :host .times.icon:hover {\n                       opacity: 1;\n                   }\n               "]
                }] }
    ];
    /** @nocollapse */
    FuiSelect.ctorParameters = function () { return [
        { type: ElementRef },
        { type: FuiLocalizationService }
    ]; };
    FuiSelect.propDecorators = {
        selectedOptionChange: [{ type: Output }],
        _optionTemplateSibling: [{ type: ViewChild, args: ['optionTemplateSibling', { read: ViewContainerRef, static: false },] }],
        placeholder: [{ type: Input }]
    };
    return FuiSelect;
}(FuiSelectBase));
export { FuiSelect };
if (false) {
    /** @type {?} */
    FuiSelect.prototype.selectedOption;
    /** @type {?} */
    FuiSelect.prototype.selectedOptionChange;
    /**
     * @type {?}
     * @private
     */
    FuiSelect.prototype._writtenOption;
    /**
     * @type {?}
     * @private
     */
    FuiSelect.prototype._optionTemplateSibling;
    /**
     * @type {?}
     * @private
     */
    FuiSelect.prototype._placeholder;
}
// Value accessor directive for the select to support ngModel.
/**
 * @template T, U
 */
var FuiSelectValueAccessor = /** @class */ (function (_super) {
    tslib_1.__extends(FuiSelectValueAccessor, _super);
    function FuiSelectValueAccessor(host) {
        return _super.call(this, host) || this;
    }
    FuiSelectValueAccessor.decorators = [
        { type: Directive, args: [{
                    selector: 'fui-select',
                    host: {
                        '(selectedOptionChange)': 'onChange($event)',
                        '(touched)': 'onTouched()'
                    },
                    providers: [customValueAccessorFactory(FuiSelectValueAccessor)]
                },] }
    ];
    /** @nocollapse */
    FuiSelectValueAccessor.ctorParameters = function () { return [
        { type: FuiSelect }
    ]; };
    return FuiSelectValueAccessor;
}(CustomValueAccessor));
export { FuiSelectValueAccessor };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LWZvbWFudGljLXVpLyIsInNvdXJjZXMiOlsibW9kdWxlcy9zZWxlY3QvY29tcG9uZW50cy9zZWxlY3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUMsU0FBUyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLGdCQUFnQixFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQ3pILE9BQU8sRUFBQyxtQkFBbUIsRUFBRSwwQkFBMEIsRUFBeUMsTUFBTSw2QkFBNkIsQ0FBQztBQUNwSSxPQUFPLEVBQUMsc0JBQXNCLEVBQUMsTUFBTSwwQ0FBMEMsQ0FBQztBQUNoRixPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sd0JBQXdCLENBQUM7Ozs7QUFHckQ7SUE0RHFDLHFDQUFtQjtJQVV0RCxtQkFBWSxPQUFtQixFQUFFLG1CQUEyQztRQUE1RSxZQUNFLGtCQUFNLE9BQU8sRUFBRSxtQkFBbUIsQ0FBQyxTQUdwQztRQURDLEtBQUksQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLFlBQVksRUFBSyxDQUFDOztJQUNwRCxDQUFDO0lBSUQsc0JBQ1csa0NBQVc7Ozs7UUFEdEI7WUFFRSxPQUFPLElBQUksQ0FBQyxZQUFZLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDO1FBQ25FLENBQUM7Ozs7O1FBRUQsVUFBdUIsV0FBbUI7WUFDeEMsSUFBSSxDQUFDLFlBQVksR0FBRyxXQUFXLENBQUM7UUFDbEMsQ0FBQzs7O09BSkE7Ozs7O0lBTU0sZ0NBQVk7Ozs7SUFBbkIsVUFBb0IsTUFBUztRQUMzQix1Q0FBdUM7UUFDdkMsSUFBSSxDQUFDLGNBQWMsR0FBRyxNQUFNLENBQUM7UUFDN0IsSUFBSSxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFD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b0JBQ3RCLElBQUksRUFBRTt3QkFDSix3QkFBd0IsRUFBRSxrQkFBa0I7d0JBQzVDLFdBQVcsRUFBRSxhQUFhO3FCQUMzQjtvQkFDRCxTQUFTLEVBQUUsQ0FBQywwQkFBMEIsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO2lCQUNoRTs7OztnQkFFbUIsU0FBUzs7SUFHN0IsNkJBQUM7Q0FBQSxBQVpELENBUWtELG1CQUFtQixHQUlwRTtTQUpZLHNCQUFzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29tcG9uZW50LCBEaXJlY3RpdmUsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE91dHB1dCwgVmlld0NoaWxkLCBWaWV3Q29udGFpbmVyUmVmfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHtDdXN0b21WYWx1ZUFjY2Vzc29yLCBjdXN0b21WYWx1ZUFjY2Vzc29yRmFjdG9yeSwgSGFuZGxlZEV2ZW50LCBJQ3VzdG9tVmFsdWVBY2Nlc3Nvckhvc3R9IGZyb20gJy4uLy4uLy4uL21pc2MvdXRpbC9pbnRlcm5hbCc7XHJcbmltcG9ydCB7RnVpTG9jYWxpemF0aW9uU2VydmljZX0gZnJvbSAnLi4vLi4vLi4vYmVoYXZpb3JzL2xvY2FsaXphdGlvbi9pbnRlcm5hbCc7XHJcbmltcG9ydCB7RnVpU2VsZWN0QmFzZX0gZnJvbSAnLi4vY2xhc3Nlcy9zZWxlY3QtYmFzZSc7XHJcbmltcG9ydCB7RnVpU2VsZWN0T3B0aW9ufSBmcm9tICcuL3NlbGVjdC1vcHRpb24nO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdmdWktc2VsZWN0JyxcclxuICB0ZW1wbGF0ZTogYFxyXG4gICAgICAgICAgICAgICAgICAgPCEtLSBRdWVyeSBpbnB1dCAtLT5cclxuICAgICAgICAgICAgICAgICAgIDxpbnB1dCBmdWlTZWxlY3RTZWFyY2hcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPVwidGV4dFwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgW2hpZGRlbl09XCIhaXNTZWFyY2hhYmxlIHx8IGlzU2VhcmNoRXh0ZXJuYWxcIj5cclxuXHJcbiAgICAgICAgICAgICAgICAgICA8IS0tIFBsYWNlaG9sZGVyIHRleHQgLS0+XHJcbiAgICAgICAgICAgICAgICAgICA8ZGl2ICpuZ0lmPVwic2VsZWN0ZWRPcHRpb24gPT0gdW5kZWZpbmVkXCIgY2xhc3M9XCJkZWZhdWx0IHRleHRcIiBbY2xhc3MuZmlsdGVyZWRdPVwicXVlcnlcIj57eyBwbGFjZWhvbGRlciB9fTwvZGl2PlxyXG4gICAgICAgICAgICAgICAgICAgPCEtLSBTZWxlY3RlZCBpdGVtIC0tPlxyXG4gICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInRleHRcIiBbY2xhc3MuZmlsdGVyZWRdPVwicXVlcnkgfHwgc2VsZWN0ZWRPcHRpb24gPT0gdW5kZWZpbmVkXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gI29wdGlvblRlbXBsYXRlU2libGluZz48L3NwYW4+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gKm5nSWY9XCIhb3B0aW9uVGVtcGxhdGUgJiYgc2VsZWN0ZWRPcHRpb24gIT0gdW5kZWZpbmVkXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbaW5uZXJIVE1MXT1cImNvbmZpZ3VyZWRGb3JtYXR0ZXIoc2VsZWN0ZWRPcHRpb24pXCI+PC9zcGFuPlxyXG4gICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICA8IS0tIERyb3Bkb3duIGljb24gLS0+XHJcbiAgICAgICAgICAgICAgICAgICA8aSAqbmdJZj1cInNlbGVjdGVkT3B0aW9uICYmICFpc1NlYXJjaGluZyAmJiBpc0NsZWFyYWJsZVwiIGNsYXNzPVwidGltZXMgaWNvblwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAoY2xpY2spPVwib25SZW1vdmVDbGljaygkZXZlbnQpXCI+PC9pPlxyXG4gICAgICAgICAgICAgICAgICAgPGkgKm5nSWY9XCIhc2VsZWN0ZWRPcHRpb24gfHwgIWlzQ2xlYXJhYmxlXCIgY2xhc3M9XCJ7eyBpY29uIH19IGljb25cIiAoY2xpY2spPVwib25DYXJldENsaWNrKCRldmVudClcIj48L2k+XHJcbiAgICAgICAgICAgICAgICAgICA8IS0tIFNlbGVjdCBkcm9wZG93biBtZW51IC0tPlxyXG4gICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1lbnVcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmdWlEcm9wZG93bk1lbnVcclxuICAgICAgICAgICAgICAgICAgICAgICAgW21lbnVUcmFuc2l0aW9uXT1cInRyYW5zaXRpb25cIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBbbWVudVRyYW5zaXRpb25EdXJhdGlvbl09XCJ0cmFuc2l0aW9uRHVyYXRpb25cIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBbbWVudUF1dG9TZWxlY3RGaXJzdF09XCJpc1NlYXJjaGFibGVcIj5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxyXG4gICAgICAgICAgICAgICAgICAgICAgIDxkaXYgKm5nSWY9XCJpc1NlYXJjaGFibGUgJiYgYXZhaWxhYmxlT3B0aW9ucy5sZW5ndGggPT09IDBcIiBjbGFzcz1cIm1lc3NhZ2VcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAge3sgbG9jYWxlVmFsdWVzLm5vUmVzdWx0c01lc3NhZ2UgfX1cclxuICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgICBgLFxyXG4gIHN0eWxlczogW2BcclxuICAgICAgICAgICAgICAgICAgIDpob3N0IC50aW1lcy5pY29uIHtcclxuICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGF1dG87XHJcbiAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBhdXRvO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIGxpbmUtaGVpZ2h0OiAxLjIxNDI4NTcxZW07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgdG9wOiAuNzg1NzE0MjllbTtcclxuICAgICAgICAgICAgICAgICAgICAgICByaWdodDogMWVtO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIG1hcmdpbjogLS43ODU3MTQyOWVtO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IC42O1xyXG4gICAgICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMS4wNzE0Mjg1N2VtO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHBhZGRpbmc6IC42ZW07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgLXdlYmtpdC10cmFuc2l0aW9uOiBvcGFjaXR5IC4xcyBlYXNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb246IG9wYWNpdHkgLjFzIGVhc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgei1pbmRleDogMztcclxuICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICA6aG9zdCAudGltZXMuaWNvbi5sYXJnZXIge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHBhZGRpbmc6IC45MTY2NjY2N2VtO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogLjg1NzE0Mjg2ZW07XHJcbiAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgOmhvc3QgLnRpbWVzLmljb246aG92ZXIge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDE7XHJcbiAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgIGBdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBGdWlTZWxlY3Q8VCwgVT4gZXh0ZW5kcyBGdWlTZWxlY3RCYXNlPFQsIFU+IGltcGxlbWVudHMgSUN1c3RvbVZhbHVlQWNjZXNzb3JIb3N0PFU+IHtcclxuXHJcbiAgcHVibGljIHNlbGVjdGVkT3B0aW9uPzogVDtcclxuICBAT3V0cHV0KClcclxuICBwdWJsaWMgc2VsZWN0ZWRPcHRpb25DaGFuZ2U6IEV2ZW50RW1pdHRlcjxVPjtcclxuICAvLyBTdG9yZXMgdGhlIHZhbHVlIHdyaXR0ZW4gYnkgbmdNb2RlbCBiZWZvcmUgaXQgY2FuIGJlIG1hdGNoZWQgdG8gYW4gb3B0aW9uIGZyb20gYG9wdGlvbnNgLlxyXG4gIHByaXZhdGUgX3dyaXR0ZW5PcHRpb24/OiBVO1xyXG4gIEBWaWV3Q2hpbGQoJ29wdGlvblRlbXBsYXRlU2libGluZycsIHtyZWFkOiBWaWV3Q29udGFpbmVyUmVmLCBzdGF0aWM6IGZhbHNlfSlcclxuICBwcml2YXRlIF9vcHRpb25UZW1wbGF0ZVNpYmxpbmc6IFZpZXdDb250YWluZXJSZWY7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGVsZW1lbnQ6IEVsZW1lbnRSZWYsIGxvY2FsaXphdGlvblNlcnZpY2U6IEZ1aUxvY2FsaXphdGlvblNlcnZpY2UpIHtcclxuICAgIHN1cGVyKGVsZW1lbnQsIGxvY2FsaXphdGlvblNlcnZpY2UpO1xyXG5cclxuICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25DaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPFU+KCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9wbGFjZWhvbGRlcjogc3RyaW5nO1xyXG5cclxuICBASW5wdXQoKVxyXG4gIHB1YmxpYyBnZXQgcGxhY2Vob2xkZXIoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLl9wbGFjZWhvbGRlciB8fCB0aGlzLmxvY2FsZVZhbHVlcy5zaW5nbGUucGxhY2Vob2xkZXI7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0IHBsYWNlaG9sZGVyKHBsYWNlaG9sZGVyOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuX3BsYWNlaG9sZGVyID0gcGxhY2Vob2xkZXI7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2VsZWN0T3B0aW9uKG9wdGlvbjogVCk6IHZvaWQge1xyXG4gICAgLy8gQ2hvb3NlIGFuZCBlbWl0IHRoZSBzZWxlY3RlZCBvcHRpb24uXHJcbiAgICB0aGlzLnNlbGVjdGVkT3B0aW9uID0gb3B0aW9uO1xyXG4gICAgdGhpcy5zZWxlY3RlZE9wdGlvbkNoYW5nZS5lbWl0KHRoaXMudmFsdWVHZXR0ZXIob3B0aW9uKSk7XHJcblxyXG4gICAgdGhpcy5kcm9wZG93blNlcnZpY2Uuc2V0T3BlblN0YXRlKGZhbHNlKTtcclxuXHJcbiAgICB0aGlzLnJlc2V0UXVlcnkoKTtcclxuXHJcbiAgICB0aGlzLmRyYXdTZWxlY3RlZE9wdGlvbigpO1xyXG5cclxuICAgIC8vIEF1dG9tYXRpY2FsbHkgcmVmb2N1cyB0aGUgc2VhcmNoIGlucHV0IGZvciBiZXR0ZXIga2V5Ym9hcmQgYWNjZXNzaWJpbGl0eS5cclxuICAgIHRoaXMuZm9jdXMoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyB3cml0ZVZhbHVlKHZhbHVlOiBVKTogdm9pZCB7XHJcbiAgICBpZiAodmFsdWUgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIGlmICh0aGlzLnNlYXJjaFNlcnZpY2Uub3B0aW9ucy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgLy8gSWYgdGhlIG9wdGlvbnMgaGF2ZSBhbHJlYWR5IGJlZW4gbG9hZGVkLCB3ZSBjYW4gaW1tZWRpYXRlbHkgbWF0Y2ggdGhlIG5nTW9kZWwgdmFsdWUgdG8gYW4gb3B0aW9uLlxyXG4gICAgICAgIHRoaXMuc2VsZWN0ZWRPcHRpb24gPSB0aGlzLmZpbmRPcHRpb24odGhpcy5zZWFyY2hTZXJ2aWNlLm9wdGlvbnMsIHZhbHVlKTtcclxuXHJcbiAgICAgICAgdGhpcy5kcmF3U2VsZWN0ZWRPcHRpb24oKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAodGhpcy5zZWxlY3RlZE9wdGlvbiA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBpZiAodGhpcy52YWx1ZUZpZWxkICYmIHRoaXMuc2VhcmNoU2VydmljZS5oYXNJdGVtTG9va3VwKSB7XHJcbiAgICAgICAgICAvLyBJZiB0aGUgc2VhcmNoIHNlcnZpY2UgaGFzIGEgc2VsZWN0ZWQgbG9va3VwIGZ1bmN0aW9uLCBtYWtlIHVzZSBvZiB0aGF0IHRvIGxvYWQgdGhlIGluaXRpYWwgdmFsdWUuXHJcbiAgICAgICAgICB0aGlzLnNlYXJjaFNlcnZpY2VcclxuICAgICAgICAgICAgLmluaXRpYWxMb29rdXAodmFsdWUpXHJcbiAgICAgICAgICAgIC50aGVuKGkgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRPcHRpb24gPSBpO1xyXG4gICAgICAgICAgICAgIHRoaXMuZHJhd1NlbGVjdGVkT3B0aW9uKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvLyBPdGhlcndpc2UsIGNhY2hlIHRoZSB3cml0dGVuIHZhbHVlIGZvciB3aGVuIG9wdGlvbnMgYXJlIHNldC5cclxuICAgICAgICAgIHRoaXMuX3dyaXR0ZW5PcHRpb24gPSB2YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuc2VsZWN0ZWRPcHRpb24gPSB1bmRlZmluZWQ7XHJcbiAgICAgIHRoaXMuZHJhd1NlbGVjdGVkT3B0aW9uKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb25SZW1vdmVDbGljayhlOiBIYW5kbGVkRXZlbnQpOiB2b2lkIHtcclxuICAgIGlmICghZS5ldmVudEhhbmRsZWQpIHtcclxuICAgICAgZS5ldmVudEhhbmRsZWQgPSB0cnVlO1xyXG4gICAgICB0aGlzLnNlbGVjdGVkT3B0aW9uID0gdW5kZWZpbmVkO1xyXG4gICAgICB0aGlzLnNlbGVjdGVkT3B0aW9uQ2hhbmdlLmVtaXQodW5kZWZpbmVkKTtcclxuICAgICAgdGhpcy5fcmVuZGVyZWRPcHRpb25zLmZvckVhY2gobyA9PiBvLmlzQWN0aXZlID0gZmFsc2UpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIG9wdGlvbnNVcGRhdGVIb29rKCk6IHZvaWQge1xyXG4gICAgaWYgKCF0aGlzLl93cml0dGVuT3B0aW9uICYmIHRoaXMuc2VsZWN0ZWRPcHRpb24pIHtcclxuICAgICAgLy8gV2UgbmVlZCB0byBjaGVjayB0aGUgb3B0aW9uIHN0aWxsIGV4aXN0cy5cclxuICAgICAgdGhpcy53cml0ZVZhbHVlKHRoaXMudmFsdWVHZXR0ZXIodGhpcy5zZWxlY3RlZE9wdGlvbikpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLl93cml0dGVuT3B0aW9uICYmIHRoaXMuc2VhcmNoU2VydmljZS5vcHRpb25zLmxlbmd0aCA+IDApIHtcclxuICAgICAgLy8gSWYgdGhlcmUgd2FzIGFuIHZhbHVlIHdyaXR0ZW4gYnkgbmdNb2RlbCBiZWZvcmUgdGhlIG9wdGlvbnMgaGFkIGJlZW4gbG9hZGVkLCB0aGlzIHJ1bnMgdG8gZml4IGl0LlxyXG4gICAgICB0aGlzLnNlbGVjdGVkT3B0aW9uID0gdGhpcy5maW5kT3B0aW9uKHRoaXMuc2VhcmNoU2VydmljZS5vcHRpb25zLCB0aGlzLl93cml0dGVuT3B0aW9uKTtcclxuICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRPcHRpb24pIHtcclxuICAgICAgICB0aGlzLl93cml0dGVuT3B0aW9uID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHRoaXMuZHJhd1NlbGVjdGVkT3B0aW9uKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBxdWVyeVVwZGF0ZUhvb2soKTogdm9pZCB7XHJcbiAgICAvLyBXaGVuIHRoZSBxdWVyeSBpcyB1cGRhdGVkLCB3ZSBqdXN0IGFiYW5kb24gdGhlIGN1cnJlbnQgc2VsZWN0aW9uLlxyXG4gICAgdGhpcy5zZWxlY3RlZE9wdGlvbiA9IHVuZGVmaW5lZDtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBpbml0aWFsaXNlUmVuZGVyZWRPcHRpb24ob3B0aW9uOiBGdWlTZWxlY3RPcHRpb248VD4pOiB2b2lkIHtcclxuICAgIHN1cGVyLmluaXRpYWxpc2VSZW5kZXJlZE9wdGlvbihvcHRpb24pO1xyXG5cclxuICAgIC8vIEJvbGRlbnMgdGhlIGl0ZW0gc28gaXQgYXBwZWFycyBzZWxlY3RlZCBpbiB0aGUgZHJvcGRvd24uXHJcbiAgICBvcHRpb24uaXNBY3RpdmUgPSBvcHRpb24udmFsdWUgPT09IHRoaXMuc2VsZWN0ZWRPcHRpb247XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGRyYXdTZWxlY3RlZE9wdGlvbigpOiB2b2lkIHtcclxuICAgIC8vIFVwZGF0ZXMgdGhlIGFjdGl2ZSBjbGFzcyBvbiB0aGUgbmV3bHkgc2VsZWN0ZWQgb3B0aW9uLlxyXG4gICAgaWYgKHRoaXMuX3JlbmRlcmVkT3B0aW9ucykge1xyXG4gICAgICB0aGlzLm9uQXZhaWxhYmxlT3B0aW9uc1JlbmRlcmVkKCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuc2VsZWN0ZWRPcHRpb24gIT0gdW5kZWZpbmVkICYmIHRoaXMub3B0aW9uVGVtcGxhdGUpIHtcclxuICAgICAgdGhpcy5kcmF3VGVtcGxhdGUodGhpcy5fb3B0aW9uVGVtcGxhdGVTaWJsaW5nLCB0aGlzLnNlbGVjdGVkT3B0aW9uKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbi8vIFZhbHVlIGFjY2Vzc29yIGRpcmVjdGl2ZSBmb3IgdGhlIHNlbGVjdCB0byBzdXBwb3J0IG5nTW9kZWwuXHJcbkBEaXJlY3RpdmUoe1xyXG4gIHNlbGVjdG9yOiAnZnVpLXNlbGVjdCcsXHJcbiAgaG9zdDoge1xyXG4gICAgJyhzZWxlY3RlZE9wdGlvbkNoYW5nZSknOiAnb25DaGFuZ2UoJGV2ZW50KScsXHJcbiAgICAnKHRvdWNoZWQpJzogJ29uVG91Y2hlZCgpJ1xyXG4gIH0sXHJcbiAgcHJvdmlkZXJzOiBbY3VzdG9tVmFsdWVBY2Nlc3NvckZhY3RvcnkoRnVpU2VsZWN0VmFsdWVBY2Nlc3NvcildXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBGdWlTZWxlY3RWYWx1ZUFjY2Vzc29yPFQsIFU+IGV4dGVuZHMgQ3VzdG9tVmFsdWVBY2Nlc3NvcjxVLCBGdWlTZWxlY3Q8VCwgVT4+IHtcclxuICBjb25zdHJ1Y3Rvcihob3N0OiBGdWlTZWxlY3Q8VCwgVT4pIHtcclxuICAgIHN1cGVyKGhvc3QpO1xyXG4gIH1cclxufVxyXG4iXX0=