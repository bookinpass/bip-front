/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ElementRef, EventEmitter, HostBinding, HostListener, Input, Output, Renderer2, TemplateRef, ViewChild } from '@angular/core';
import { Util } from '../../../misc/util/internal';
import { DropdownService, FuiDropdownMenu } from '../../dropdown/internal';
import { FuiLocalizationService } from '../../../behaviors/localization/internal';
import { SearchService } from '../services/search.service';
/**
 * @record
 * @template T
 */
export function IResultContext() { }
if (false) {
    /** @type {?} */
    IResultContext.prototype.query;
}
/**
 * @template T
 */
var FuiSearch = /** @class */ (function () {
    function FuiSearch(_element, renderer, _localizationService) {
        var _this = this;
        this._element = _element;
        this._localizationService = _localizationService;
        this.dropdownService = new DropdownService();
        this.searchService = new SearchService();
        this.onLocaleUpdate();
        this._localizationService.onLanguageUpdate.subscribe((/**
         * @return {?}
         */
        function () { return _this.onLocaleUpdate(); }));
        this.hasClasses = true;
        this.tabindex = 0;
        this.hasIcon = true;
        this.retainSelectedResult = true;
        this.searchDelay = 200;
        this.maxResults = 7;
        this.onResultSelected = new EventEmitter();
        this.transition = 'scale';
        this.transitionDuration = 200;
    }
    Object.defineProperty(FuiSearch.prototype, "isActive", {
        get: /**
         * @return {?}
         */
        function () {
            return this.dropdownService.isOpen;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FuiSearch.prototype, "query", {
        get: /**
         * @return {?}
         */
        function () {
            return this.searchService.query;
        },
        set: /**
         * @param {?} query
         * @return {?}
         */
        function (query) {
            var _this = this;
            this.selectedResult = undefined;
            // Initialise a delayed search.
            this.searchService.updateQueryDelayed(query, (/**
             * @return {?}
             */
            function () {
                // Set the results open state depending on whether a query has been entered.
                return _this.dropdownService.setOpenState(_this.searchService.query.length > 0);
            }));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FuiSearch.prototype, "options", {
        set: /**
         * @param {?} options
         * @return {?}
         */
        function (options) {
            if (options) {
                this.searchService.options = options;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FuiSearch.prototype, "optionsFilter", {
        set: /**
         * @param {?} filter
         * @return {?}
         */
        function (filter) {
            if (filter) {
                this.searchService.optionsFilter = filter;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FuiSearch.prototype, "optionsLookup", {
        set: /**
         * @param {?} lookupFn
         * @return {?}
         */
        function (lookupFn) {
            this.searchService.optionsLookup = lookupFn;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FuiSearch.prototype, "optionsField", {
        set: /**
         * @param {?} field
         * @return {?}
         */
        function (field) {
            this.searchService.optionsField = field;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FuiSearch.prototype, "searchDelay", {
        set: /**
         * @param {?} delay
         * @return {?}
         */
        function (delay) {
            this.searchService.searchDelay = delay;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FuiSearch.prototype, "isSearching", {
        get: /**
         * @return {?}
         */
        function () {
            return this.searchService.isSearching;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FuiSearch.prototype, "results", {
        get: /**
         * @return {?}
         */
        function () {
            return this.searchService.results.slice(0, this.maxResults);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FuiSearch.prototype, "placeholder", {
        // Gets & sets the placeholder text displayed inside the text input.
        get: 
        // Gets & sets the placeholder text displayed inside the text input.
        /**
         * @return {?}
         */
        function () {
            return this._placeholder || this.localeValues.placeholder;
        },
        set: /**
         * @param {?} placeholder
         * @return {?}
         */
        function (placeholder) {
            this._placeholder = placeholder;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FuiSearch.prototype, "localeValues", {
        get: /**
         * @return {?}
         */
        function () {
            return this._localizationService.override(this._localeValues, this.localeOverrides);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FuiSearch.prototype, "resultFormatter", {
        get: /**
         * @return {?}
         */
        function () {
            var _this = this;
            if (this._resultFormatter) {
                return this._resultFormatter;
            }
            else if (this.searchService.optionsLookup) {
                return (/**
                 * @param {?} r
                 * @return {?}
                 */
                function (r) { return _this.readValue(r); });
            }
            else {
                return (/**
                 * @param {?} r
                 * @param {?} q
                 * @return {?}
                 */
                function (r, q) { return _this.searchService.highlightMatches(_this.readValue(r), q); });
            }
        },
        set: /**
         * @param {?} formatter
         * @return {?}
         */
        function (formatter) {
            this._resultFormatter = formatter;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    FuiSearch.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this._menu.service = this.dropdownService;
    };
    // Selects a result.
    // Selects a result.
    /**
     * @param {?} result
     * @return {?}
     */
    FuiSearch.prototype.select = 
    // Selects a result.
    /**
     * @param {?} result
     * @return {?}
     */
    function (result) {
        this.onResultSelected.emit(result);
        this.dropdownService.setOpenState(false);
        if (this.retainSelectedResult) {
            this.selectedResult = result;
            this.searchService.updateQuery(this.readValue(result));
        }
        else {
            this.searchService.updateQuery('');
        }
    };
    /**
     * @param {?} e
     * @return {?}
     */
    FuiSearch.prototype.onClick = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        this.open();
    };
    /**
     * @return {?}
     */
    FuiSearch.prototype.onFocusIn = /**
     * @return {?}
     */
    function () {
        if (!this.dropdownService.isAnimating) {
            this.open();
        }
    };
    /**
     * @param {?} e
     * @return {?}
     */
    FuiSearch.prototype.onFocusOut = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        console.log(e);
        if (!this._element.nativeElement.contains(e.relatedTarget)) {
            this.dropdownService.setOpenState(false);
        }
    };
    // Reads the specified field from an item.
    // Reads the specified field from an item.
    /**
     * @param {?} object
     * @return {?}
     */
    FuiSearch.prototype.readValue = 
    // Reads the specified field from an item.
    /**
     * @param {?} object
     * @return {?}
     */
    function (object) {
        return Util.Object.readValue(object, this.searchService.optionsField);
    };
    /**
     * @private
     * @return {?}
     */
    FuiSearch.prototype.onLocaleUpdate = /**
     * @private
     * @return {?}
     */
    function () {
        this._localeValues = this._localizationService.get().search;
    };
    /**
     * @private
     * @return {?}
     */
    FuiSearch.prototype.open = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.searchService.query.length > 0) {
            // Only open on click when there is a query entered.
            this.dropdownService.setOpenState(true);
        }
    };
    FuiSearch.decorators = [
        { type: Component, args: [{
                    selector: 'fui-search',
                    template: "\n<div class=\"ui input\" [class.icon]=\"hasIcon\" (click)=\"onClick($event)\">\n    <input class=\"prompt\" type=\"text\" [attr.placeholder]=\"placeholder\" autocomplete=\"off\" [(ngModel)]=\"query\">\n    <i *ngIf=\"hasIcon\" class=\"search icon\"></i>\n</div>\n<div class=\"results\"\n     fuiDropdownMenu\n     [menuTransition]=\"transition\"\n     [menuTransitionDuration]=\"transitionDuration\"\n     menuSelectedItemClass=\"active\">\n\n    <fui-search-result *ngFor=\"let r of results\"\n                       class=\"item\"\n                       [value]=\"r\"\n                       [query]=\"query\"\n                       [formatter]=\"resultFormatter\"\n                       [template]=\"resultTemplate\"\n                       (click)=\"select(r)\"></fui-search-result>\n\n    <div *ngIf=\"results.length == 0\" class=\"message empty\">\n        <div class=\"header\">{{ localeValues.noResults.header }}</div>\n        <div class=\"description\">{{ localeValues.noResults.message }}</div>\n    </div>\n</div>\n",
                    styles: ["\n/* Ensures results div has margin. */\n:host {\n    display: inline-block;\n    outline: 0;\n}\n\n/* Fixes positioning when results are pushed above the search. */\n.results {\n    margin-bottom: .5em;\n}\n"]
                }] }
    ];
    /** @nocollapse */
    FuiSearch.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Renderer2 },
        { type: FuiLocalizationService }
    ]; };
    FuiSearch.propDecorators = {
        hasClasses: [{ type: HostBinding, args: ['class.ui',] }, { type: HostBinding, args: ['class.search',] }],
        tabindex: [{ type: HostBinding, args: ['attr.tabindex',] }],
        hasIcon: [{ type: Input }],
        resultTemplate: [{ type: Input }],
        retainSelectedResult: [{ type: Input }],
        maxResults: [{ type: Input }],
        onResultSelected: [{ type: Output, args: ['resultSelected',] }],
        transition: [{ type: Input }],
        transitionDuration: [{ type: Input }],
        _menu: [{ type: ViewChild, args: [FuiDropdownMenu, { static: false },] }],
        isActive: [{ type: HostBinding, args: ['class.active',] }],
        options: [{ type: Input }],
        optionsFilter: [{ type: Input }],
        optionsLookup: [{ type: Input }],
        optionsField: [{ type: Input }],
        searchDelay: [{ type: Input }],
        isSearching: [{ type: HostBinding, args: ['class.loading',] }],
        placeholder: [{ type: Input }],
        resultFormatter: [{ type: Input }],
        onFocusIn: [{ type: HostListener, args: ['focusin',] }],
        onFocusOut: [{ type: HostListener, args: ['focusout', ['$event'],] }]
    };
    return FuiSearch;
}());
export { FuiSearch };
if (false) {
    /** @type {?} */
    FuiSearch.prototype.dropdownService;
    /** @type {?} */
    FuiSearch.prototype.searchService;
    /** @type {?} */
    FuiSearch.prototype.hasClasses;
    /** @type {?} */
    FuiSearch.prototype.tabindex;
    /** @type {?} */
    FuiSearch.prototype.hasIcon;
    /** @type {?} */
    FuiSearch.prototype.localeOverrides;
    /** @type {?} */
    FuiSearch.prototype.resultTemplate;
    /** @type {?} */
    FuiSearch.prototype.retainSelectedResult;
    /** @type {?} */
    FuiSearch.prototype.maxResults;
    /** @type {?} */
    FuiSearch.prototype.selectedResult;
    /** @type {?} */
    FuiSearch.prototype.onResultSelected;
    /** @type {?} */
    FuiSearch.prototype.transition;
    /** @type {?} */
    FuiSearch.prototype.transitionDuration;
    /**
     * @type {?}
     * @private
     */
    FuiSearch.prototype._menu;
    /**
     * @type {?}
     * @private
     */
    FuiSearch.prototype._placeholder;
    /**
     * @type {?}
     * @private
     */
    FuiSearch.prototype._localeValues;
    /**
     * @type {?}
     * @private
     */
    FuiSearch.prototype._resultFormatter;
    /**
     * @type {?}
     * @private
     */
    FuiSearch.prototype._element;
    /**
     * @type {?}
     * @private
     */
    FuiSearch.prototype._localizationService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LWZvbWFudGljLXVpLyIsInNvdXJjZXMiOlsibW9kdWxlcy9zZWFyY2gvY29tcG9uZW50cy9zZWFyY2gudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFFTCxTQUFTLEVBQ1QsVUFBVSxFQUNWLFlBQVksRUFDWixXQUFXLEVBQ1gsWUFBWSxFQUNaLEtBQUssRUFDTCxNQUFNLEVBQ04sU0FBUyxFQUNULFdBQVcsRUFDWCxTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFtQyxJQUFJLEVBQUMsTUFBTSw2QkFBNkIsQ0FBQztBQUNuRixPQUFPLEVBQUMsZUFBZSxFQUFFLGVBQWUsRUFBQyxNQUFNLHlCQUF5QixDQUFDO0FBQ3pFLE9BQU8sRUFBd0Msc0JBQXNCLEVBQUMsTUFBTSwwQ0FBMEMsQ0FBQztBQUN2SCxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sNEJBQTRCLENBQUM7Ozs7O0FBR3pELG9DQUVDOzs7SUFEQywrQkFBYzs7Ozs7QUFHaEI7SUF5RUUsbUJBQW9CLFFBQW9CLEVBQUUsUUFBbUIsRUFBVSxvQkFBNEM7UUFBbkgsaUJBa0JDO1FBbEJtQixhQUFRLEdBQVIsUUFBUSxDQUFZO1FBQStCLHlCQUFvQixHQUFwQixvQkFBb0IsQ0FBd0I7UUFDakgsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLGVBQWUsRUFBRSxDQUFDO1FBQzdDLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxhQUFhLEVBQVEsQ0FBQztRQUUvQyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDdEIsSUFBSSxDQUFDLG9CQUFvQixDQUFDLGdCQUFnQixDQUFDLFNBQVM7OztRQUFDLGNBQU0sT0FBQSxLQUFJLENBQUMsY0FBYyxFQUFFLEVBQXJCLENBQXFCLEVBQUMsQ0FBQztRQUVsRixJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQztRQUN2QixJQUFJLENBQUMsUUFBUSxH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ICBDb21wb25lbnQsXHJcbiAgRWxlbWVudFJlZixcclxuICBFdmVudEVtaXR0ZXIsXHJcbiAgSG9zdEJpbmRpbmcsXHJcbiAgSG9zdExpc3RlbmVyLFxyXG4gIElucHV0LFxyXG4gIE91dHB1dCxcclxuICBSZW5kZXJlcjIsXHJcbiAgVGVtcGxhdGVSZWYsXHJcbiAgVmlld0NoaWxkXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7SUZvY3VzRXZlbnQsIElUZW1wbGF0ZVJlZkNvbnRleHQsIFV0aWx9IGZyb20gJy4uLy4uLy4uL21pc2MvdXRpbC9pbnRlcm5hbCc7XHJcbmltcG9ydCB7RHJvcGRvd25TZXJ2aWNlLCBGdWlEcm9wZG93bk1lbnV9IGZyb20gJy4uLy4uL2Ryb3Bkb3duL2ludGVybmFsJztcclxuaW1wb3J0IHtJU2VhcmNoTG9jYWxlVmFsdWVzLCBSZWN1cnNpdmVQYXJ0aWFsLCBGdWlMb2NhbGl6YXRpb25TZXJ2aWNlfSBmcm9tICcuLi8uLi8uLi9iZWhhdmlvcnMvbG9jYWxpemF0aW9uL2ludGVybmFsJztcclxuaW1wb3J0IHtTZWFyY2hTZXJ2aWNlfSBmcm9tICcuLi9zZXJ2aWNlcy9zZWFyY2guc2VydmljZSc7XHJcbmltcG9ydCB7RmlsdGVyRm4sIExvb2t1cEZufSBmcm9tICcuLi9oZWxwZXJzL2xvb2t1cC1mbic7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIElSZXN1bHRDb250ZXh0PFQ+IGV4dGVuZHMgSVRlbXBsYXRlUmVmQ29udGV4dDxUPiB7XHJcbiAgcXVlcnk6IHN0cmluZztcclxufVxyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdmdWktc2VhcmNoJyxcclxuICB0ZW1wbGF0ZTogYFxyXG48ZGl2IGNsYXNzPVwidWkgaW5wdXRcIiBbY2xhc3MuaWNvbl09XCJoYXNJY29uXCIgKGNsaWNrKT1cIm9uQ2xpY2soJGV2ZW50KVwiPlxyXG4gICAgPGlucHV0IGNsYXNzPVwicHJvbXB0XCIgdHlwZT1cInRleHRcIiBbYXR0ci5wbGFjZWhvbGRlcl09XCJwbGFjZWhvbGRlclwiIGF1dG9jb21wbGV0ZT1cIm9mZlwiIFsobmdNb2RlbCldPVwicXVlcnlcIj5cclxuICAgIDxpICpuZ0lmPVwiaGFzSWNvblwiIGNsYXNzPVwic2VhcmNoIGljb25cIj48L2k+XHJcbjwvZGl2PlxyXG48ZGl2IGNsYXNzPVwicmVzdWx0c1wiXHJcbiAgICAgZnVpRHJvcGRvd25NZW51XHJcbiAgICAgW21lbnVUcmFuc2l0aW9uXT1cInRyYW5zaXRpb25cIlxyXG4gICAgIFttZW51VHJhbnNpdGlvbkR1cmF0aW9uXT1cInRyYW5zaXRpb25EdXJhdGlvblwiXHJcbiAgICAgbWVudVNlbGVjdGVkSXRlbUNsYXNzPVwiYWN0aXZlXCI+XHJcblxyXG4gICAgPGZ1aS1zZWFyY2gtcmVzdWx0ICpuZ0Zvcj1cImxldCByIG9mIHJlc3VsdHNcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPVwiaXRlbVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgW3ZhbHVlXT1cInJcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgIFtxdWVyeV09XCJxdWVyeVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgW2Zvcm1hdHRlcl09XCJyZXN1bHRGb3JtYXR0ZXJcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgIFt0ZW1wbGF0ZV09XCJyZXN1bHRUZW1wbGF0ZVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgKGNsaWNrKT1cInNlbGVjdChyKVwiPjwvZnVpLXNlYXJjaC1yZXN1bHQ+XHJcblxyXG4gICAgPGRpdiAqbmdJZj1cInJlc3VsdHMubGVuZ3RoID09IDBcIiBjbGFzcz1cIm1lc3NhZ2UgZW1wdHlcIj5cclxuICAgICAgICA8ZGl2IGNsYXNzPVwiaGVhZGVyXCI+e3sgbG9jYWxlVmFsdWVzLm5vUmVzdWx0cy5oZWFkZXIgfX08L2Rpdj5cclxuICAgICAgICA8ZGl2IGNsYXNzPVwiZGVzY3JpcHRpb25cIj57eyBsb2NhbGVWYWx1ZXMubm9SZXN1bHRzLm1lc3NhZ2UgfX08L2Rpdj5cclxuICAgIDwvZGl2PlxyXG48L2Rpdj5cclxuYCxcclxuICBzdHlsZXM6IFtgXHJcbi8qIEVuc3VyZXMgcmVzdWx0cyBkaXYgaGFzIG1hcmdpbi4gKi9cclxuOmhvc3Qge1xyXG4gICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xyXG4gICAgb3V0bGluZTogMDtcclxufVxyXG5cclxuLyogRml4ZXMgcG9zaXRpb25pbmcgd2hlbiByZXN1bHRzIGFyZSBwdXNoZWQgYWJvdmUgdGhlIHNlYXJjaC4gKi9cclxuLnJlc3VsdHMge1xyXG4gICAgbWFyZ2luLWJvdHRvbTogLjVlbTtcclxufVxyXG5gXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgRnVpU2VhcmNoPFQ+IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCB7XHJcblxyXG4gIHB1YmxpYyBkcm9wZG93blNlcnZpY2U6IERyb3Bkb3duU2VydmljZTtcclxuICBwdWJsaWMgc2VhcmNoU2VydmljZTogU2VhcmNoU2VydmljZTxULCBUPjtcclxuICAvLyBEb2luZyBpdCBvbiB0aGUgaG9zdCBlbmFibGVzIHVzZSBpbiBtZW51cyBldGMuXHJcbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy51aScpXHJcbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5zZWFyY2gnKVxyXG4gIHB1YmxpYyByZWFkb25seSBoYXNDbGFzc2VzOiBib29sZWFuO1xyXG4gIC8vIFNldHMgdGhlIEZvbWFudGljIFVJIGNsYXNzZXMgb24gdGhlIGhvc3QgZWxlbWVudC5cclxuICBASG9zdEJpbmRpbmcoJ2F0dHIudGFiaW5kZXgnKVxyXG4gIHB1YmxpYyByZWFkb25seSB0YWJpbmRleDogbnVtYmVyO1xyXG4gIC8vIFNldHMgd2hldGhlciB0aGUgc2VhcmNoIGVsZW1lbnQgaGFzIGEgdmlzaWJsZSBzZWFyY2ggaWNvbi5cclxuICBASW5wdXQoKVxyXG4gIHB1YmxpYyBoYXNJY29uOiBib29sZWFuO1xyXG4gIHB1YmxpYyBsb2NhbGVPdmVycmlkZXM6IFJlY3Vyc2l2ZVBhcnRpYWw8SVNlYXJjaExvY2FsZVZhbHVlcz47XHJcbiAgQElucHV0KClcclxuICBwdWJsaWMgcmVzdWx0VGVtcGxhdGU6IFRlbXBsYXRlUmVmPElSZXN1bHRDb250ZXh0PFQ+PjtcclxuICBASW5wdXQoKVxyXG4gIHB1YmxpYyByZXRhaW5TZWxlY3RlZFJlc3VsdDogYm9vbGVhbjtcclxuICBASW5wdXQoKVxyXG4gIHB1YmxpYyBtYXhSZXN1bHRzOiBudW1iZXI7XHJcbiAgLy8gU3RvcmVzIHRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgcmVzdWx0LlxyXG4gIHB1YmxpYyBzZWxlY3RlZFJlc3VsdD86IFQ7XHJcbiAgLy8gRW1pdHMgd2hlbmV2ZXIgYSBuZXcgcmVzdWx0IGlzIHNlbGVjdGVkLlxyXG4gIEBPdXRwdXQoJ3Jlc3VsdFNlbGVjdGVkJylcclxuICBwdWJsaWMgb25SZXN1bHRTZWxlY3RlZDogRXZlbnRFbWl0dGVyPFQ+O1xyXG4gIEBJbnB1dCgpXHJcbiAgcHVibGljIHRyYW5zaXRpb246IHN0cmluZztcclxuICBASW5wdXQoKVxyXG4gIHB1YmxpYyB0cmFuc2l0aW9uRHVyYXRpb246IG51bWJlcjtcclxuICBAVmlld0NoaWxkKEZ1aURyb3Bkb3duTWVudSwge3N0YXRpYzogZmFsc2V9KVxyXG4gIHByaXZhdGUgX21lbnU6IEZ1aURyb3Bkb3duTWVudTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBfZWxlbWVudDogRWxlbWVudFJlZiwgcmVuZGVyZXI6IFJlbmRlcmVyMiwgcHJpdmF0ZSBfbG9jYWxpemF0aW9uU2VydmljZTogRnVpTG9jYWxpemF0aW9uU2VydmljZSkge1xyXG4gICAgdGhpcy5kcm9wZG93blNlcnZpY2UgPSBuZXcgRHJvcGRvd25TZXJ2aWNlKCk7XHJcbiAgICB0aGlzLnNlYXJjaFNlcnZpY2UgPSBuZXcgU2VhcmNoU2VydmljZTxULCBUPigpO1xyXG5cclxuICAgIHRoaXMub25Mb2NhbGVVcGRhdGUoKTtcclxuICAgIHRoaXMuX2xvY2FsaXphdGlvblNlcnZpY2Uub25MYW5ndWFnZVVwZGF0ZS5zdWJzY3JpYmUoKCkgPT4gdGhpcy5vbkxvY2FsZVVwZGF0ZSgpKTtcclxuXHJcbiAgICB0aGlzLmhhc0NsYXNzZXMgPSB0cnVlO1xyXG4gICAgdGhpcy50YWJpbmRleCA9IDA7XHJcbiAgICB0aGlzLmhhc0ljb24gPSB0cnVlO1xyXG4gICAgdGhpcy5yZXRhaW5TZWxlY3RlZFJlc3VsdCA9IHRydWU7XHJcbiAgICB0aGlzLnNlYXJjaERlbGF5ID0gMjAwO1xyXG4gICAgdGhpcy5tYXhSZXN1bHRzID0gNztcclxuXHJcbiAgICB0aGlzLm9uUmVzdWx0U2VsZWN0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPFQ+KCk7XHJcblxyXG4gICAgdGhpcy50cmFuc2l0aW9uID0gJ3NjYWxlJztcclxuICAgIHRoaXMudHJhbnNpdGlvbkR1cmF0aW9uID0gMjAwO1xyXG4gIH1cclxuXHJcbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5hY3RpdmUnKVxyXG4gIHB1YmxpYyBnZXQgaXNBY3RpdmUoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5kcm9wZG93blNlcnZpY2UuaXNPcGVuO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBxdWVyeSgpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMuc2VhcmNoU2VydmljZS5xdWVyeTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXQgcXVlcnkocXVlcnk6IHN0cmluZykge1xyXG4gICAgdGhpcy5zZWxlY3RlZFJlc3VsdCA9IHVuZGVmaW5lZDtcclxuICAgIC8vIEluaXRpYWxpc2UgYSBkZWxheWVkIHNlYXJjaC5cclxuICAgIHRoaXMuc2VhcmNoU2VydmljZS51cGRhdGVRdWVyeURlbGF5ZWQocXVlcnksICgpID0+IHtcclxuICAgICAgLy8gU2V0IHRoZSByZXN1bHRzIG9wZW4gc3RhdGUgZGVwZW5kaW5nIG9uIHdoZXRoZXIgYSBxdWVyeSBoYXMgYmVlbiBlbnRlcmVkLlxyXG4gICAgICByZXR1cm4gdGhpcy5kcm9wZG93blNlcnZpY2Uuc2V0T3BlblN0YXRlKHRoaXMuc2VhcmNoU2VydmljZS5xdWVyeS5sZW5ndGggPiAwKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgQElucHV0KClcclxuICBwdWJsaWMgc2V0IG9wdGlvbnMob3B0aW9uczogVFtdIHwgdW5kZWZpbmVkKSB7XHJcbiAgICBpZiAob3B0aW9ucykge1xyXG4gICAgICB0aGlzLnNlYXJjaFNlcnZpY2Uub3B0aW9ucyA9IG9wdGlvbnM7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBASW5wdXQoKVxyXG4gIHB1YmxpYyBzZXQgb3B0aW9uc0ZpbHRlcihmaWx0ZXI6IEZpbHRlckZuPFQ+IHwgdW5kZWZpbmVkKSB7XHJcbiAgICBpZiAoZmlsdGVyKSB7XHJcbiAgICAgIHRoaXMuc2VhcmNoU2VydmljZS5vcHRpb25zRmlsdGVyID0gZmlsdGVyO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgQElucHV0KClcclxuICBwdWJsaWMgc2V0IG9wdGlvbnNMb29rdXAobG9va3VwRm46IExvb2t1cEZuPFQ+IHwgdW5kZWZpbmVkKSB7XHJcbiAgICB0aGlzLnNlYXJjaFNlcnZpY2Uub3B0aW9uc0xvb2t1cCA9IGxvb2t1cEZuO1xyXG4gIH1cclxuXHJcbiAgQElucHV0KClcclxuICBwdWJsaWMgc2V0IG9wdGlvbnNGaWVsZChmaWVsZDogc3RyaW5nIHwgdW5kZWZpbmVkKSB7XHJcbiAgICB0aGlzLnNlYXJjaFNlcnZpY2Uub3B0aW9uc0ZpZWxkID0gZmllbGQ7XHJcbiAgfVxyXG5cclxuICBASW5wdXQoKVxyXG4gIHB1YmxpYyBzZXQgc2VhcmNoRGVsYXkoZGVsYXk6IG51bWJlcikge1xyXG4gICAgdGhpcy5zZWFyY2hTZXJ2aWNlLnNlYXJjaERlbGF5ID0gZGVsYXk7XHJcbiAgfVxyXG5cclxuICBASG9zdEJpbmRpbmcoJ2NsYXNzLmxvYWRpbmcnKVxyXG4gIHB1YmxpYyBnZXQgaXNTZWFyY2hpbmcoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5zZWFyY2hTZXJ2aWNlLmlzU2VhcmNoaW5nO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCByZXN1bHRzKCk6IFRbXSB7XHJcbiAgICByZXR1cm4gdGhpcy5zZWFyY2hTZXJ2aWNlLnJlc3VsdHMuc2xpY2UoMCwgdGhpcy5tYXhSZXN1bHRzKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgX3BsYWNlaG9sZGVyOiBzdHJpbmc7XHJcblxyXG4gIC8vIEdldHMgJiBzZXRzIHRoZSBwbGFjZWhvbGRlciB0ZXh0IGRpc3BsYXllZCBpbnNpZGUgdGhlIHRleHQgaW5wdXQuXHJcbiAgQElucHV0KClcclxuICBwdWJsaWMgZ2V0IHBsYWNlaG9sZGVyKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gdGhpcy5fcGxhY2Vob2xkZXIgfHwgdGhpcy5sb2NhbGVWYWx1ZXMucGxhY2Vob2xkZXI7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0IHBsYWNlaG9sZGVyKHBsYWNlaG9sZGVyOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuX3BsYWNlaG9sZGVyID0gcGxhY2Vob2xkZXI7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9sb2NhbGVWYWx1ZXM6IElTZWFyY2hMb2NhbGVWYWx1ZXM7XHJcblxyXG4gIHB1YmxpYyBnZXQgbG9jYWxlVmFsdWVzKCk6IElTZWFyY2hMb2NhbGVWYWx1ZXMge1xyXG4gICAgcmV0dXJuIHRoaXMuX2xvY2FsaXphdGlvblNlcnZpY2Uub3ZlcnJpZGU8J3NlYXJjaCc+KHRoaXMuX2xvY2FsZVZhbHVlcywgdGhpcy5sb2NhbGVPdmVycmlkZXMpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfcmVzdWx0Rm9ybWF0dGVyPzogKHI6IFQsIHE6IHN0cmluZykgPT4gc3RyaW5nO1xyXG5cclxuICBwdWJsaWMgZ2V0IHJlc3VsdEZvcm1hdHRlcigpOiAocmVzdWx0OiBULCBxdWVyeTogc3RyaW5nKSA9PiBzdHJpbmcge1xyXG4gICAgaWYgKHRoaXMuX3Jlc3VsdEZvcm1hdHRlcikge1xyXG4gICAgICByZXR1cm4gdGhpcy5fcmVzdWx0Rm9ybWF0dGVyO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLnNlYXJjaFNlcnZpY2Uub3B0aW9uc0xvb2t1cCkge1xyXG4gICAgICByZXR1cm4gciA9PiB0aGlzLnJlYWRWYWx1ZShyKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiAociwgcSkgPT4gdGhpcy5zZWFyY2hTZXJ2aWNlLmhpZ2hsaWdodE1hdGNoZXModGhpcy5yZWFkVmFsdWUociksIHEpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgQElucHV0KClcclxuICBwdWJsaWMgc2V0IHJlc3VsdEZvcm1hdHRlcihmb3JtYXR0ZXI6IChyZXN1bHQ6IFQsIHF1ZXJ5OiBzdHJpbmcpID0+IHN0cmluZykge1xyXG4gICAgdGhpcy5fcmVzdWx0Rm9ybWF0dGVyID0gZm9ybWF0dGVyO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG5nQWZ0ZXJWaWV3SW5pdCgpOiB2b2lkIHtcclxuICAgIHRoaXMuX21lbnUuc2VydmljZSA9IHRoaXMuZHJvcGRvd25TZXJ2aWNlO1xyXG4gIH1cclxuXHJcbiAgLy8gU2VsZWN0cyBhIHJlc3VsdC5cclxuICBwdWJsaWMgc2VsZWN0KHJlc3VsdDogVCk6IHZvaWQge1xyXG4gICAgdGhpcy5vblJlc3VsdFNlbGVjdGVkLmVtaXQocmVzdWx0KTtcclxuICAgIHRoaXMuZHJvcGRvd25TZXJ2aWNlLnNldE9wZW5TdGF0ZShmYWxzZSk7XHJcblxyXG4gICAgaWYgKHRoaXMucmV0YWluU2VsZWN0ZWRSZXN1bHQpIHtcclxuICAgICAgdGhpcy5zZWxlY3RlZFJlc3VsdCA9IHJlc3VsdDtcclxuICAgICAgdGhpcy5zZWFyY2hTZXJ2aWNlLnVwZGF0ZVF1ZXJ5KHRoaXMucmVhZFZhbHVlKHJlc3VsdCkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5zZWFyY2hTZXJ2aWNlLnVwZGF0ZVF1ZXJ5KCcnKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBvbkNsaWNrKGU6IE1vdXNlRXZlbnQpOiB2b2lkIHtcclxuICAgIHRoaXMub3BlbigpO1xyXG4gIH1cclxuXHJcbiAgQEhvc3RMaXN0ZW5lcignZm9jdXNpbicpXHJcbiAgcHVibGljIG9uRm9jdXNJbigpOiB2b2lkIHtcclxuICAgIGlmICghdGhpcy5kcm9wZG93blNlcnZpY2UuaXNBbmltYXRpbmcpIHtcclxuICAgICAgdGhpcy5vcGVuKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBASG9zdExpc3RlbmVyKCdmb2N1c291dCcsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIG9uRm9jdXNPdXQoZTogSUZvY3VzRXZlbnQpOiB2b2lkIHtcclxuICAgIGNvbnNvbGUubG9nKGUpO1xyXG4gICAgaWYgKCF0aGlzLl9lbGVtZW50Lm5hdGl2ZUVsZW1lbnQuY29udGFpbnMoZS5yZWxhdGVkVGFyZ2V0KSkge1xyXG4gICAgICB0aGlzLmRyb3Bkb3duU2VydmljZS5zZXRPcGVuU3RhdGUoZmFsc2UpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gUmVhZHMgdGhlIHNwZWNpZmllZCBmaWVsZCBmcm9tIGFuIGl0ZW0uXHJcbiAgcHVibGljIHJlYWRWYWx1ZShvYmplY3Q6IFQpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIFV0aWwuT2JqZWN0LnJlYWRWYWx1ZTxULCBzdHJpbmc+KG9iamVjdCwgdGhpcy5zZWFyY2hTZXJ2aWNlLm9wdGlvbnNGaWVsZCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG9uTG9jYWxlVXBkYXRlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5fbG9jYWxlVmFsdWVzID0gdGhpcy5fbG9jYWxpemF0aW9uU2VydmljZS5nZXQoKS5zZWFyY2g7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG9wZW4oKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5zZWFyY2hTZXJ2aWNlLnF1ZXJ5Lmxlbmd0aCA+IDApIHtcclxuICAgICAgLy8gT25seSBvcGVuIG9uIGNsaWNrIHdoZW4gdGhlcmUgaXMgYSBxdWVyeSBlbnRlcmVkLlxyXG4gICAgICB0aGlzLmRyb3Bkb3duU2VydmljZS5zZXRPcGVuU3RhdGUodHJ1ZSk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==