/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { DateUtil, Util } from '../../../misc/util/internal';
import { CalendarItem } from '../directives/calendar-item';
import { DateComparer } from '../classes/date-comparer';
var CalendarRange = /** @class */ (function () {
    function CalendarRange(start, dates, items, grouped, comparer) {
        this.start = start;
        this.dates = dates;
        this.items = items;
        this.groupedItems = grouped;
        this._comparer = comparer;
    }
    Object.defineProperty(CalendarRange.prototype, "inRange", {
        get: /**
         * @return {?}
         */
        function () {
            return this.items.filter((/**
             * @param {?} i
             * @return {?}
             */
            function (i) { return !i.isOutsideRange; }));
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} item
     * @return {?}
     */
    CalendarRange.prototype.find = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        var _this = this;
        return this.items.find((/**
         * @param {?} i
         * @return {?}
         */
        function (i) { return _this._comparer.equal(i.date, item.date); }));
    };
    /**
     * @param {?} item
     * @return {?}
     */
    CalendarRange.prototype.findIndex = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        var _this = this;
        if (!item) {
            return -1;
        }
        return this.items.findIndex((/**
         * @param {?} i
         * @return {?}
         */
        function (i) { return _this._comparer.equal(i.date, item.date); }));
    };
    /**
     * @param {?} date
     * @return {?}
     */
    CalendarRange.prototype.containsDate = /**
     * @param {?} date
     * @return {?}
     */
    function (date) {
        var _this = this;
        return !!this.inRange.find((/**
         * @param {?} i
         * @return {?}
         */
        function (i) { return _this._comparer.equal(i.date, date); }));
    };
    return CalendarRange;
}());
export { CalendarRange };
if (false) {
    /** @type {?} */
    CalendarRange.prototype.start;
    /** @type {?} */
    CalendarRange.prototype.dates;
    /** @type {?} */
    CalendarRange.prototype.items;
    /** @type {?} */
    CalendarRange.prototype.groupedItems;
    /**
     * @type {?}
     * @private
     */
    CalendarRange.prototype._comparer;
}
/**
 * @abstract
 */
var /**
 * @abstract
 */
CalendarRangeService = /** @class */ (function () {
    function CalendarRangeService(interval, rows, columns) {
        this.interval = interval;
        this.marginal = (/** @type {?} */ (interval)) + 1;
        this.rows = rows;
        this.columns = columns;
    }
    Object.defineProperty(CalendarRangeService.prototype, "dateComparer", {
        get: /**
         * @return {?}
         */
        function () {
            return new DateComparer(this.marginal, this.service.inFinalView);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CalendarRangeService.prototype, "length", {
        get: /**
         * @return {?}
         */
        function () {
            return this.rows * this.columns;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CalendarRangeService.prototype, "canMoveNext", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var firstItem = this.next.inRange[0];
            if (firstItem && this.service.maxDate) {
                return firstItem.date <= this.service.maxDate;
            }
            return true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CalendarRangeService.prototype, "canMovePrevious", {
        get: /**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var lastItem = this.previous.inRange.slice(-1).pop();
            if (lastItem && this.service.minDate) {
                return lastItem.date >= this.service.minDate;
            }
            return true;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} service
     * @return {?}
     */
    CalendarRangeService.prototype.loadService = /**
     * @param {?} service
     * @return {?}
     */
    function (service) {
        this.service = service;
        this.refresh();
    };
    /**
     * @return {?}
     */
    CalendarRangeService.prototype.refresh = /**
     * @return {?}
     */
    function () {
        this.current = this.calcRange(this.service.currentDate);
        this.next = this.calcRange(DateUtil.next(this.interval, DateUtil.clone(this.service.currentDate)));
        this.previous = this.calcRange(DateUtil.previous(this.interval, DateUtil.clone(this.service.currentDate)));
    };
    /**
     * @param {?} forwards
     * @return {?}
     */
    CalendarRangeService.prototype.move = /**
     * @param {?} forwards
     * @return {?}
     */
    function (forwards) {
        if (forwards) {
            return this.moveNext();
        }
        return this.movePrevious();
    };
    /**
     * @return {?}
     */
    CalendarRangeService.prototype.moveNext = /**
     * @return {?}
     */
    function () {
        DateUtil.next(this.interval, this.service.currentDate);
        this.previous = this.current;
        this.current = this.next;
        this.next = this.calcRange(DateUtil.next(this.interval, DateUtil.clone(this.service.currentDate)));
    };
    /**
     * @return {?}
     */
    CalendarRangeService.prototype.movePrevious = /**
     * @return {?}
     */
    function () {
        DateUtil.previous(this.interval, this.service.currentDate);
        this.next = this.current;
        this.current = this.previous;
        this.previous = this.calcRange(DateUtil.previous(this.interval, DateUtil.clone(this.service.currentDate)));
    };
    /**
     * @param {?} forwards
     * @return {?}
     */
    CalendarRangeService.prototype.calc = /**
     * @param {?} forwards
     * @return {?}
     */
    function (forwards) {
        if (forwards) {
            return this.next;
        }
        return this.previous;
    };
    /**
     * @protected
     * @param {?} date
     * @return {?}
     */
    CalendarRangeService.prototype.calcStart = /**
     * @protected
     * @param {?} date
     * @return {?}
     */
    function (date) {
        return DateUtil.startOf(this.interval, DateUtil.clone(date));
    };
    /**
     * @protected
     * @param {?} rangeStart
     * @return {?}
     */
    CalendarRangeService.prototype.calcDates = /**
     * @protected
     * @param {?} rangeStart
     * @return {?}
     */
    function (rangeStart) {
        var _this = this;
        return Util.Array
            .range(this.length)
            .map((/**
         * @param {?} i
         * @return {?}
         */
        function (i) { return DateUtil.add(_this.marginal, DateUtil.clone(rangeStart), i); }));
    };
    /**
     * @protected
     * @param {?} dateRange
     * @param {?} baseDate
     * @return {?}
     */
    CalendarRangeService.prototype.calcItems = /**
     * @protected
     * @param {?} dateRange
     * @param {?} baseDate
     * @return {?}
     */
    function (dateRange, baseDate) {
        var _this = this;
        return dateRange.map((/**
         * @param {?} date
         * @return {?}
         */
        function (date) {
            /** @type {?} */
            var item = new CalendarItem(date);
            item.isDisabled = !_this.dateComparer.between(item.date, _this.service.minDate, _this.service.maxDate);
            item.isActive = _this.dateComparer.equal(item.date, _this.service.selectedDate);
            item.isToday = _this.dateComparer.equal(item.date, new Date());
            item.isSelectable = item.isDisabled;
            _this.configureItem(item, baseDate);
            return item;
        }));
    };
    /**
     * @private
     * @param {?} startDate
     * @return {?}
     */
    CalendarRangeService.prototype.calcRange = /**
     * @private
     * @param {?} startDate
     * @return {?}
     */
    function (startDate) {
        /** @type {?} */
        var start = this.calcStart(startDate);
        if (this.service.inFinalView) {
            DateUtil.startOf(this.marginal, start, true);
        }
        /** @type {?} */
        var dates = this.calcDates(start);
        /** @type {?} */
        var items = this.calcItems(dates, startDate);
        return new CalendarRange(start, dates, items, Util.Array.group(items, this.columns), this.dateComparer);
    };
    return CalendarRangeService;
}());
/**
 * @abstract
 */
export { CalendarRangeService };
if (false) {
    /** @type {?} */
    CalendarRangeService.prototype.previous;
    /** @type {?} */
    CalendarRangeService.prototype.current;
    /** @type {?} */
    CalendarRangeService.prototype.next;
    /** @type {?} */
    CalendarRangeService.prototype.service;
    /** @type {?} */
    CalendarRangeService.prototype.interval;
    /** @type {?} */
    CalendarRangeService.prototype.marginal;
    /** @type {?} */
    CalendarRangeService.prototype.rows;
    /** @type {?} */
    CalendarRangeService.prototype.columns;
    /**
     * @abstract
     * @protected
     * @param {?} item
     * @param {?} baseDate
     * @return {?}
     */
    CalendarRangeService.prototype.configureItem = function (item, baseDate) { };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXItcmFuZ2Uuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1mb21hbnRpYy11aS8iLCJzb3VyY2VzIjpbIm1vZHVsZXMvZGF0ZXBpY2tlci9zZXJ2aWNlcy9jYWxlbmRhci1yYW5nZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQWdCLFFBQVEsRUFBRSxJQUFJLEVBQUMsTUFBTSw2QkFBNkIsQ0FBQztBQUMxRSxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sNkJBQTZCLENBQUM7QUFFekQsT0FBTyxFQUFDLFlBQVksRUFBQyxNQUFNLDBCQUEwQixDQUFDO0FBRXREO0lBT0UsdUJBQVksS0FBVyxFQUFFLEtBQWEsRUFBRSxLQUFxQixFQUFFLE9BQXlCLEVBQUUsUUFBc0I7UUFDOUcsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDbkIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDbkIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDbkIsSUFBSSxDQUFDLFlBQVksR0FBRyxPQUFPLENBQUM7UUFDNUIsSUFBSSxDQUFDLFNBQVMsR0FBRyxRQUFRLENBQUM7SUFDNUIsQ0FBQztJQUVELHNCQUFXLGtDQUFPOzs7O1FBQWxCO1lBQ0UsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU07Ozs7WUFBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxDQUFDLGNBQWMsRUFBakIsQ0FBaUIsRUFBQyxDQUFDO1FBQ25ELENBQUM7OztPQUFBOzs7OztJQUVNLDRCQUFJOzs7O0lBQVgsVUFBWSxJQUFrQjtRQUE5QixpQkFFQztRQURDLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJOzs7O1FBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxLQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLENB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QUUsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQzFHLENBQUM7SUFDSCwyQkFBQztBQUFELENBQUMsQUExSEQsSUEwSEM7Ozs7Ozs7SUF6SEMsd0NBQStCOztJQUMvQix1Q0FBOEI7O0lBQzlCLG9DQUEyQjs7SUFFM0IsdUNBQWdDOztJQUVoQyx3Q0FBK0I7O0lBQy9CLHdDQUErQjs7SUFDL0Isb0NBQW9COztJQUNwQix1Q0FBdUI7Ozs7Ozs7O0lBb0d2Qiw2RUFBMkUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0RhdGVQcmVjaXNpb24sIERhdGVVdGlsLCBVdGlsfSBmcm9tICcuLi8uLi8uLi9taXNjL3V0aWwvaW50ZXJuYWwnO1xyXG5pbXBvcnQge0NhbGVuZGFySXRlbX0gZnJvbSAnLi4vZGlyZWN0aXZlcy9jYWxlbmRhci1pdGVtJztcclxuaW1wb3J0IHtDYWxlbmRhclNlcnZpY2V9IGZyb20gJy4vY2FsZW5kYXIuc2VydmljZSc7XHJcbmltcG9ydCB7RGF0ZUNvbXBhcmVyfSBmcm9tICcuLi9jbGFzc2VzL2RhdGUtY29tcGFyZXInO1xyXG5cclxuZXhwb3J0IGNsYXNzIENhbGVuZGFyUmFuZ2Uge1xyXG4gIHB1YmxpYyBzdGFydDogRGF0ZTtcclxuICBwdWJsaWMgZGF0ZXM6IERhdGVbXTtcclxuICBwdWJsaWMgaXRlbXM6IENhbGVuZGFySXRlbVtdO1xyXG4gIHB1YmxpYyBncm91cGVkSXRlbXM6IENhbGVuZGFySXRlbVtdW107XHJcbiAgcHJpdmF0ZSBfY29tcGFyZXI6IERhdGVDb21wYXJlcjtcclxuXHJcbiAgY29uc3RydWN0b3Ioc3RhcnQ6IERhdGUsIGRhdGVzOiBEYXRlW10sIGl0ZW1zOiBDYWxlbmRhckl0ZW1bXSwgZ3JvdXBlZDogQ2FsZW5kYXJJdGVtW11bXSwgY29tcGFyZXI6IERhdGVDb21wYXJlcikge1xyXG4gICAgdGhpcy5zdGFydCA9IHN0YXJ0O1xyXG4gICAgdGhpcy5kYXRlcyA9IGRhdGVzO1xyXG4gICAgdGhpcy5pdGVtcyA9IGl0ZW1zO1xyXG4gICAgdGhpcy5ncm91cGVkSXRlbXMgPSBncm91cGVkO1xyXG4gICAgdGhpcy5fY29tcGFyZXIgPSBjb21wYXJlcjtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgaW5SYW5nZSgpOiBDYWxlbmRhckl0ZW1bXSB7XHJcbiAgICByZXR1cm4gdGhpcy5pdGVtcy5maWx0ZXIoaSA9PiAhaS5pc091dHNpZGVSYW5nZSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZmluZChpdGVtOiBDYWxlbmRhckl0ZW0pOiBDYWxlbmRhckl0ZW0gfCB1bmRlZmluZWQge1xyXG4gICAgcmV0dXJuIHRoaXMuaXRlbXMuZmluZChpID0+IHRoaXMuX2NvbXBhcmVyLmVxdWFsKGkuZGF0ZSwgaXRlbS5kYXRlKSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZmluZEluZGV4KGl0ZW06IENhbGVuZGFySXRlbSB8IHVuZGVmaW5lZCk6IG51bWJlciB7XHJcbiAgICBpZiAoIWl0ZW0pIHtcclxuICAgICAgcmV0dXJuIC0xO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuaXRlbXMuZmluZEluZGV4KGkgPT4gdGhpcy5fY29tcGFyZXIuZXF1YWwoaS5kYXRlLCBpdGVtLmRhdGUpKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBjb250YWluc0RhdGUoZGF0ZTogRGF0ZSk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuICEhdGhpcy5pblJhbmdlLmZpbmQoaSA9PiB0aGlzLl9jb21wYXJlci5lcXVhbChpLmRhdGUsIGRhdGUpKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBDYWxlbmRhclJhbmdlU2VydmljZSB7XHJcbiAgcHVibGljIHByZXZpb3VzOiBDYWxlbmRhclJhbmdlO1xyXG4gIHB1YmxpYyBjdXJyZW50OiBDYWxlbmRhclJhbmdlO1xyXG4gIHB1YmxpYyBuZXh0OiBDYWxlbmRhclJhbmdlO1xyXG5cclxuICBwdWJsaWMgc2VydmljZTogQ2FsZW5kYXJTZXJ2aWNlO1xyXG5cclxuICBwdWJsaWMgaW50ZXJ2YWw6IERhdGVQcmVjaXNpb247XHJcbiAgcHVibGljIG1hcmdpbmFsOiBEYXRlUHJlY2lzaW9uO1xyXG4gIHB1YmxpYyByb3dzOiBudW1iZXI7XHJcbiAgcHVibGljIGNvbHVtbnM6IG51bWJlcjtcclxuXHJcbiAgY29uc3RydWN0b3IoaW50ZXJ2YWw6IERhdGVQcmVjaXNpb24sIHJvd3M6IG51bWJlciwgY29sdW1uczogbnVtYmVyKSB7XHJcbiAgICB0aGlzLmludGVydmFsID0gaW50ZXJ2YWw7XHJcbiAgICB0aGlzLm1hcmdpbmFsID0gaW50ZXJ2YWwgYXMgbnVtYmVyICsgMTtcclxuICAgIHRoaXMucm93cyA9IHJvd3M7XHJcbiAgICB0aGlzLmNvbHVtbnMgPSBjb2x1bW5zO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBkYXRlQ29tcGFyZXIoKTogRGF0ZUNvbXBhcmVyIHtcclxuICAgIHJldHVybiBuZXcgRGF0ZUNvbXBhcmVyKHRoaXMubWFyZ2luYWwsIHRoaXMuc2VydmljZS5pbkZpbmFsVmlldyk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IGxlbmd0aCgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMucm93cyAqIHRoaXMuY29sdW1ucztcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgY2FuTW92ZU5leHQoKTogYm9vbGVhbiB7XHJcbiAgICBjb25zdCBmaXJzdEl0ZW0gPSB0aGlzLm5leHQuaW5SYW5nZVswXTtcclxuICAgIGlmIChmaXJzdEl0ZW0gJiYgdGhpcy5zZXJ2aWNlLm1heERhdGUpIHtcclxuICAgICAgcmV0dXJuIGZpcnN0SXRlbS5kYXRlIDw9IHRoaXMuc2VydmljZS5tYXhEYXRlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IGNhbk1vdmVQcmV2aW91cygpOiBib29sZWFuIHtcclxuICAgIGNvbnN0IGxhc3RJdGVtID0gdGhpcy5wcmV2aW91cy5pblJhbmdlLnNsaWNlKC0xKS5wb3AoKTtcclxuICAgIGlmIChsYXN0SXRlbSAmJiB0aGlzLnNlcnZpY2UubWluRGF0ZSkge1xyXG4gICAgICByZXR1cm4gbGFzdEl0ZW0uZGF0ZSA+PSB0aGlzLnNlcnZpY2UubWluRGF0ZTtcclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGxvYWRTZXJ2aWNlKHNlcnZpY2U6IENhbGVuZGFyU2VydmljZSk6IHZvaWQge1xyXG4gICAgdGhpcy5zZXJ2aWNlID0gc2VydmljZTtcclxuXHJcbiAgICB0aGlzLnJlZnJlc2goKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyByZWZyZXNoKCk6IHZvaWQge1xyXG4gICAgdGhpcy5jdXJyZW50ID0gdGhpcy5jYWxjUmFuZ2UodGhpcy5zZXJ2aWNlLmN1cnJlbnREYXRlKTtcclxuXHJcbiAgICB0aGlzLm5leHQgPSB0aGlzLmNhbGNSYW5nZShEYXRlVXRpbC5uZXh0KHRoaXMuaW50ZXJ2YWwsIERhdGVVdGlsLmNsb25lKHRoaXMuc2VydmljZS5jdXJyZW50RGF0ZSkpKTtcclxuICAgIHRoaXMucHJldmlvdXMgPSB0aGlzLmNhbGNSYW5nZShEYXRlVXRpbC5wcmV2aW91cyh0aGlzLmludGVydmFsLCBEYXRlVXRpbC5jbG9uZSh0aGlzLnNlcnZpY2UuY3VycmVudERhdGUpKSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgbW92ZShmb3J3YXJkczogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgaWYgKGZvcndhcmRzKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLm1vdmVOZXh0KCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5tb3ZlUHJldmlvdXMoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBtb3ZlTmV4dCgpOiB2b2lkIHtcclxuICAgIERhdGVVdGlsLm5leHQodGhpcy5pbnRlcnZhbCwgdGhpcy5zZXJ2aWNlLmN1cnJlbnREYXRlKTtcclxuICAgIHRoaXMucHJldmlvdXMgPSB0aGlzLmN1cnJlbnQ7XHJcbiAgICB0aGlzLmN1cnJlbnQgPSB0aGlzLm5leHQ7XHJcbiAgICB0aGlzLm5leHQgPSB0aGlzLmNhbGNSYW5nZShEYXRlVXRpbC5uZXh0KHRoaXMuaW50ZXJ2YWwsIERhdGVVdGlsLmNsb25lKHRoaXMuc2VydmljZS5jdXJyZW50RGF0ZSkpKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBtb3ZlUHJldmlvdXMoKTogdm9pZCB7XHJcbiAgICBEYXRlVXRpbC5wcmV2aW91cyh0aGlzLmludGVydmFsLCB0aGlzLnNlcnZpY2UuY3VycmVudERhdGUpO1xyXG4gICAgdGhpcy5uZXh0ID0gdGhpcy5jdXJyZW50O1xyXG4gICAgdGhpcy5jdXJyZW50ID0gdGhpcy5wcmV2aW91cztcclxuICAgIHRoaXMucHJldmlvdXMgPSB0aGlzLmNhbGNSYW5nZShEYXRlVXRpbC5wcmV2aW91cyh0aGlzLmludGVydmFsLCBEYXRlVXRpbC5jbG9uZSh0aGlzLnNlcnZpY2UuY3VycmVudERhdGUpKSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgY2FsYyhmb3J3YXJkczogYm9vbGVhbik6IENhbGVuZGFyUmFuZ2Uge1xyXG4gICAgaWYgKGZvcndhcmRzKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLm5leHQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5wcmV2aW91cztcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBjYWxjU3RhcnQoZGF0ZTogRGF0ZSk6IERhdGUge1xyXG4gICAgcmV0dXJuIERhdGVVdGlsLnN0YXJ0T2YodGhpcy5pbnRlcnZhbCwgRGF0ZVV0aWwuY2xvbmUoZGF0ZSkpO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIGNhbGNEYXRlcyhyYW5nZVN0YXJ0OiBEYXRlKTogRGF0ZVtdIHtcclxuICAgIHJldHVybiBVdGlsLkFycmF5XHJcbiAgICAgIC5yYW5nZSh0aGlzLmxlbmd0aClcclxuICAgICAgLm1hcChpID0+IERhdGVVdGlsLmFkZCh0aGlzLm1hcmdpbmFsLCBEYXRlVXRpbC5jbG9uZShyYW5nZVN0YXJ0KSwgaSkpO1xyXG5cclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBjYWxjSXRlbXMoZGF0ZVJhbmdlOiBEYXRlW10sIGJhc2VEYXRlOiBEYXRlKTogQ2FsZW5kYXJJdGVtW10ge1xyXG4gICAgcmV0dXJuIGRhdGVSYW5nZS5tYXAoZGF0ZSA9PiB7XHJcbiAgICAgIGNvbnN0IGl0ZW0gPSBuZXcgQ2FsZW5kYXJJdGVtKGRhdGUpO1xyXG5cclxuICAgICAgaXRlbS5pc0Rpc2FibGVkID0gIXRoaXMuZGF0ZUNvbXBhcmVyLmJldHdlZW4oaXRlbS5kYXRlLCB0aGlzLnNlcnZpY2UubWluRGF0ZSwgdGhpcy5zZXJ2aWNlLm1heERhdGUpO1xyXG4gICAgICBpdGVtLmlzQWN0aXZlID0gdGhpcy5kYXRlQ29tcGFyZXIuZXF1YWwoaXRlbS5kYXRlLCB0aGlzLnNlcnZpY2Uuc2VsZWN0ZWREYXRlKTtcclxuICAgICAgaXRlbS5pc1RvZGF5ID0gdGhpcy5kYXRlQ29tcGFyZXIuZXF1YWwoaXRlbS5kYXRlLCBuZXcgRGF0ZSgpKTtcclxuICAgICAgaXRlbS5pc1NlbGVjdGFibGUgPSBpdGVtLmlzRGlzYWJsZWQ7XHJcblxyXG4gICAgICB0aGlzLmNvbmZpZ3VyZUl0ZW0oaXRlbSwgYmFzZURhdGUpO1xyXG5cclxuICAgICAgcmV0dXJuIGl0ZW07XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBhYnN0cmFjdCBjb25maWd1cmVJdGVtKGl0ZW06IENhbGVuZGFySXRlbSwgYmFzZURhdGU6IERhdGUpOiB2b2lkO1xyXG5cclxuICBwcml2YXRlIGNhbGNSYW5nZShzdGFydERhdGU6IERhdGUpOiBDYWxlbmRhclJhbmdlIHtcclxuICAgIGNvbnN0IHN0YXJ0ID0gdGhpcy5jYWxjU3RhcnQoc3RhcnREYXRlKTtcclxuICAgIGlmICh0aGlzLnNlcnZpY2UuaW5GaW5hbFZpZXcpIHtcclxuICAgICAgRGF0ZVV0aWwuc3RhcnRPZih0aGlzLm1hcmdpbmFsLCBzdGFydCwgdHJ1ZSk7XHJcbiAgICB9XHJcbiAgICBjb25zdCBkYXRlcyA9IHRoaXMuY2FsY0RhdGVzKHN0YXJ0KTtcclxuICAgIGNvbnN0IGl0ZW1zID0gdGhpcy5jYWxjSXRlbXMoZGF0ZXMsIHN0YXJ0RGF0ZSk7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBDYWxlbmRhclJhbmdlKHN0YXJ0LCBkYXRlcywgaXRlbXMsIFV0aWwuQXJyYXkuZ3JvdXAoaXRlbXMsIHRoaXMuY29sdW1ucyksIHRoaXMuZGF0ZUNvbXBhcmVyKTtcclxuICB9XHJcbn1cclxuIl19