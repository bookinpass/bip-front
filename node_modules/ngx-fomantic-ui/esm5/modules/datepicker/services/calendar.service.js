/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { EventEmitter } from '@angular/core';
import { DateUtil } from '../../../misc/util/internal';
/** @enum {number} */
var CalendarMode = {
    DateOnly: 0,
    TimeOnly: 1,
    Both: 2,
};
export { CalendarMode };
CalendarMode[CalendarMode.DateOnly] = 'DateOnly';
CalendarMode[CalendarMode.TimeOnly] = 'TimeOnly';
CalendarMode[CalendarMode.Both] = 'Both';
var CalendarService = /** @class */ (function () {
    function CalendarService(config, localeValues) {
        this.localeValues = localeValues;
        this.onManualUpdate = (/**
         * @return {?}
         */
        function () {
        });
        this.config = config;
        this.currentDate = new Date();
        this.firstDayOfWeek = this.localeValues.firstDayOfWeek;
        this.onDateChange = new EventEmitter();
        this.reset();
    }
    Object.defineProperty(CalendarService.prototype, "inFinalView", {
        get: /**
         * @return {?}
         */
        function () {
            return this.currentView === this.config.mappings.finalView;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CalendarService.prototype, "config", {
        get: /**
         * @return {?}
         */
        function () {
            return this._config;
        },
        set: /**
         * @param {?} config
         * @return {?}
         */
        function (config) {
            this._config = config;
            config.updateBounds(this._selectedDate || this.currentDate);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CalendarService.prototype, "selectedDate", {
        get: /**
         * @return {?}
         */
        function () {
            return this._selectedDate;
        },
        set: /**
         * @param {?} date
         * @return {?}
         */
        function (date) {
            if (date) {
                this._selectedDate = DateUtil.clone(date);
                this.currentDate = DateUtil.clone(date);
            }
            else {
                this._selectedDate = undefined;
            }
            this.config.updateBounds(this._selectedDate || this.currentDate);
            this.onManualUpdate();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CalendarService.prototype, "minDate", {
        get: /**
         * @return {?}
         */
        function () {
            if (this._minDate && this.config.dateMinBound) {
                return this._minDate > this.config.dateMinBound ? this._minDate : this.config.dateMinBound;
            }
            return this._minDate || this.config.dateMinBound;
        },
        set: /**
         * @param {?} min
         * @return {?}
         */
        function (min) {
            this._minDate = min;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CalendarService.prototype, "maxDate", {
        get: /**
         * @return {?}
         */
        function () {
            if (this._maxDate && this.config.dateMaxBound) {
                return this._maxDate < this.config.dateMaxBound ? this._maxDate : this.config.dateMaxBound;
            }
            return this._maxDate || this.config.dateMaxBound;
        },
        set: /**
         * @param {?} max
         * @return {?}
         */
        function (max) {
            this._maxDate = max;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CalendarService.prototype, "firstDayOfWeek", {
        get: /**
         * @return {?}
         */
        function () {
            return this._firstDayOfWeek;
        },
        set: /**
         * @param {?} firstDayOfWeek
         * @return {?}
         */
        function (firstDayOfWeek) {
            if (firstDayOfWeek != undefined) {
                this._firstDayOfWeek = Math.max(0, Math.min(6, firstDayOfWeek));
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    CalendarService.prototype.reset = /**
     * @return {?}
     */
    function () {
        this.currentView = this.config.mappings.finalView;
        if (!this._selectedDate) {
            /** @type {?} */
            var current = this.currentDate.getTime();
            if (this._minDate) {
                current = Math.max(current, this._minDate.getTime());
            }
            if (this._maxDate) {
                current = Math.min(current, this._maxDate.getTime());
            }
            this.currentDate = new Date(current);
            this.config.updateBounds(this.currentDate);
            this.currentView = this.config.mappings.initialView;
        }
    };
    /**
     * @param {?} date
     * @param {?} fromView
     * @return {?}
     */
    CalendarService.prototype.changeDate = /**
     * @param {?} date
     * @param {?} fromView
     * @return {?}
     */
    function (date, fromView) {
        this.currentDate = date;
        if (fromView === this.config.mappings.finalView) {
            this.selectedDate = date;
            return this.onDateChange.emit(date);
        }
        this.updateView(this.config.mappings.changed, fromView);
    };
    /**
     * @param {?} fromView
     * @return {?}
     */
    CalendarService.prototype.zoomOut = /**
     * @param {?} fromView
     * @return {?}
     */
    function (fromView) {
        this.updateView(this.config.mappings.zoom, fromView);
    };
    /**
     * @private
     * @param {?} mappings
     * @param {?} fromView
     * @return {?}
     */
    CalendarService.prototype.updateView = /**
     * @private
     * @param {?} mappings
     * @param {?} fromView
     * @return {?}
     */
    function (mappings, fromView) {
        /** @type {?} */
        var mapping = mappings.get(fromView);
        if (mapping == undefined) {
            throw new Error('Unknown view type.');
        }
        this.currentView = mapping;
    };
    return CalendarService;
}());
export { CalendarService };
if (false) {
    /** @type {?} */
    CalendarService.prototype.currentView;
    /** @type {?} */
    CalendarService.prototype.currentDate;
    /** @type {?} */
    CalendarService.prototype.onDateChange;
    /**
     * @type {?}
     * @private
     */
    CalendarService.prototype._config;
    /**
     * @type {?}
     * @private
     */
    CalendarService.prototype._selectedDate;
    /**
     * @type {?}
     * @private
     */
    CalendarService.prototype._minDate;
    /**
     * @type {?}
     * @private
     */
    CalendarService.prototype._maxDate;
    /**
     * @type {?}
     * @private
     */
    CalendarService.prototype._firstDayOfWeek;
    /** @type {?} */
    CalendarService.prototype.onManualUpdate;
    /** @type {?} */
    CalendarService.prototype.localeValues;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXIuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1mb21hbnRpYy11aS8iLCJzb3VyY2VzIjpbIm1vZHVsZXMvZGF0ZXBpY2tlci9zZXJ2aWNlcy9jYWxlbmRhci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBRTNDLE9BQU8sRUFBQyxRQUFRLEVBQUMsTUFBTSw2QkFBNkIsQ0FBQzs7O0lBS25ELFdBQVk7SUFDWixXQUFZO0lBQ1osT0FBUTs7Ozs7O0FBR1Y7SUFFRSx5QkFBWSxNQUFzQixFQUFTLFlBQXFDO1FBQXJDLGlCQUFZLEdBQVosWUFBWSxDQUF5QjtRQXNGekUsbUJBQWM7OztRQUFlO1FBQ3BDLENBQUMsRUFBQTtRQXRGQyxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUVyQixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7UUFFOUIsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLGNBQWMsQ0FBQztRQUV2RCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksWUFBWSxFQUFRLENBQUM7UUFFN0MsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ2YsQ0FBQztJQUVELHNCQUFXLHdDQUFXOzs7O1FBQXRCO1lBQ0UsT0FBTyxJQUFJLENBQUMsV0FBVyxLQUFLLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQztRQUM3RCxDQUFDOzs7T0FBQTtJQUVELHNCQUFXLG1DQUFNOzs7O1FBQWpCO1lBQ0UsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDO1FBQ3RCLENBQUM7Ozs7O1FBRUQsVUFBa0IsTUFBc0I7WUFDdEMsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7WUFDdEIsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsYUFBYSxJQUFJLElBQUks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LElBQUksQ0FBQyxXQUFXLEdBQUcsT0FBTyxDQUFDO0lBQzdCLENBQUM7SUFDSCxzQkFBQztBQUFELENBQUMsQUFySUQsSUFxSUM7Ozs7SUExREMsc0NBQXFDOztJQUNyQyxzQ0FBeUI7O0lBQ3pCLHVDQUF3Qzs7Ozs7SUFFeEMsa0NBQWdDOzs7OztJQUVoQyx3Q0FBNkI7Ozs7O0lBRTdCLG1DQUF3Qjs7Ozs7SUFFeEIsbUNBQXdCOzs7OztJQUV4QiwwQ0FBZ0M7O0lBQ2hDLHlDQUNDOztJQXZGbUMsdUNBQTRDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtFdmVudEVtaXR0ZXJ9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge0lEYXRlcGlja2VyTG9jYWxlVmFsdWVzfSBmcm9tICcuLi8uLi8uLi9iZWhhdmlvcnMvbG9jYWxpemF0aW9uL2ludGVybmFsJztcclxuaW1wb3J0IHtEYXRlVXRpbH0gZnJvbSAnLi4vLi4vLi4vbWlzYy91dGlsL2ludGVybmFsJztcclxuaW1wb3J0IHtDYWxlbmRhclZpZXdUeXBlfSBmcm9tICcuLi92aWV3cy9jYWxlbmRhci12aWV3JztcclxuaW1wb3J0IHtDYWxlbmRhckNvbmZpZ30gZnJvbSAnLi4vY2xhc3Nlcy9jYWxlbmRhci1jb25maWcnO1xyXG5cclxuZXhwb3J0IGVudW0gQ2FsZW5kYXJNb2RlIHtcclxuICBEYXRlT25seSA9IDAsXHJcbiAgVGltZU9ubHkgPSAxLFxyXG4gIEJvdGggPSAyXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBDYWxlbmRhclNlcnZpY2Uge1xyXG5cclxuICBjb25zdHJ1Y3Rvcihjb25maWc6IENhbGVuZGFyQ29uZmlnLCBwdWJsaWMgbG9jYWxlVmFsdWVzOiBJRGF0ZXBpY2tlckxvY2FsZVZhbHVlcykge1xyXG4gICAgdGhpcy5jb25maWcgPSBjb25maWc7XHJcblxyXG4gICAgdGhpcy5jdXJyZW50RGF0ZSA9IG5ldyBEYXRlKCk7XHJcblxyXG4gICAgdGhpcy5maXJzdERheU9mV2VlayA9IHRoaXMubG9jYWxlVmFsdWVzLmZpcnN0RGF5T2ZXZWVrO1xyXG5cclxuICAgIHRoaXMub25EYXRlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxEYXRlPigpO1xyXG5cclxuICAgIHRoaXMucmVzZXQoKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgaW5GaW5hbFZpZXcoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50VmlldyA9PT0gdGhpcy5jb25maWcubWFwcGluZ3MuZmluYWxWaWV3O1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBjb25maWcoKTogQ2FsZW5kYXJDb25maWcge1xyXG4gICAgcmV0dXJuIHRoaXMuX2NvbmZpZztcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXQgY29uZmlnKGNvbmZpZzogQ2FsZW5kYXJDb25maWcpIHtcclxuICAgIHRoaXMuX2NvbmZpZyA9IGNvbmZpZztcclxuICAgIGNvbmZpZy51cGRhdGVCb3VuZHModGhpcy5fc2VsZWN0ZWREYXRlIHx8IHRoaXMuY3VycmVudERhdGUpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBzZWxlY3RlZERhdGUoKTogRGF0ZSB8IHVuZGVmaW5lZCB7XHJcbiAgICByZXR1cm4gdGhpcy5fc2VsZWN0ZWREYXRlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldCBzZWxlY3RlZERhdGUoZGF0ZTogRGF0ZSB8IHVuZGVmaW5lZCkge1xyXG4gICAgaWYgKGRhdGUpIHtcclxuICAgICAgdGhpcy5fc2VsZWN0ZWREYXRlID0gRGF0ZVV0aWwuY2xvbmUoZGF0ZSk7XHJcbiAgICAgIHRoaXMuY3VycmVudERhdGUgPSBEYXRlVXRpbC5jbG9uZShkYXRlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX3NlbGVjdGVkRGF0ZSA9IHVuZGVmaW5lZDtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmNvbmZpZy51cGRhdGVCb3VuZHModGhpcy5fc2VsZWN0ZWREYXRlIHx8IHRoaXMuY3VycmVudERhdGUpO1xyXG4gICAgdGhpcy5vbk1hbnVhbFVwZGF0ZSgpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBtaW5EYXRlKCk6IERhdGUgfCB1bmRlZmluZWQge1xyXG4gICAgaWYgKHRoaXMuX21pbkRhdGUgJiYgdGhpcy5jb25maWcuZGF0ZU1pbkJvdW5kKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9taW5EYXRlID4gdGhpcy5jb25maWcuZGF0ZU1pbkJvdW5kID8gdGhpcy5fbWluRGF0ZSA6IHRoaXMuY29uZmlnLmRhdGVNaW5Cb3VuZDtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLl9taW5EYXRlIHx8IHRoaXMuY29uZmlnLmRhdGVNaW5Cb3VuZDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXQgbWluRGF0ZShtaW46IERhdGUgfCB1bmRlZmluZWQpIHtcclxuICAgIHRoaXMuX21pbkRhdGUgPSBtaW47XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IG1heERhdGUoKTogRGF0ZSB8IHVuZGVmaW5lZCB7XHJcbiAgICBpZiAodGhpcy5fbWF4RGF0ZSAmJiB0aGlzLmNvbmZpZy5kYXRlTWF4Qm91bmQpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuX21heERhdGUgPCB0aGlzLmNvbmZpZy5kYXRlTWF4Qm91bmQgPyB0aGlzLl9tYXhEYXRlIDogdGhpcy5jb25maWcuZGF0ZU1heEJvdW5kO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuX21heERhdGUgfHwgdGhpcy5jb25maWcuZGF0ZU1heEJvdW5kO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldCBtYXhEYXRlKG1heDogRGF0ZSB8IHVuZGVmaW5lZCkge1xyXG4gICAgdGhpcy5fbWF4RGF0ZSA9IG1heDtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgZmlyc3REYXlPZldlZWsoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLl9maXJzdERheU9mV2VlaztcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXQgZmlyc3REYXlPZldlZWsoZmlyc3REYXlPZldlZWs6IG51bWJlcikge1xyXG4gICAgaWYgKGZpcnN0RGF5T2ZXZWVrICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICB0aGlzLl9maXJzdERheU9mV2VlayA9IE1hdGgubWF4KDAsIE1hdGgubWluKDYsIGZpcnN0RGF5T2ZXZWVrKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgY3VycmVudFZpZXc6IENhbGVuZGFyVmlld1R5cGU7XHJcbiAgcHVibGljIGN1cnJlbnREYXRlOiBEYXRlO1xyXG4gIHB1YmxpYyBvbkRhdGVDaGFuZ2U6IEV2ZW50RW1pdHRlcjxEYXRlPjtcclxuXHJcbiAgcHJpdmF0ZSBfY29uZmlnOiBDYWxlbmRhckNvbmZpZztcclxuXHJcbiAgcHJpdmF0ZSBfc2VsZWN0ZWREYXRlPzogRGF0ZTtcclxuXHJcbiAgcHJpdmF0ZSBfbWluRGF0ZT86IERhdGU7XHJcblxyXG4gIHByaXZhdGUgX21heERhdGU/OiBEYXRlO1xyXG5cclxuICBwcml2YXRlIF9maXJzdERheU9mV2VlazogbnVtYmVyO1xyXG4gIHB1YmxpYyBvbk1hbnVhbFVwZGF0ZTogKCkgPT4gdm9pZCA9ICgpID0+IHtcclxuICB9XHJcblxyXG4gIHB1YmxpYyByZXNldCgpOiB2b2lkIHtcclxuICAgIHRoaXMuY3VycmVudFZpZXcgPSB0aGlzLmNvbmZpZy5tYXBwaW5ncy5maW5hbFZpZXc7XHJcblxyXG4gICAgaWYgKCF0aGlzLl9zZWxlY3RlZERhdGUpIHtcclxuICAgICAgbGV0IGN1cnJlbnQgPSB0aGlzLmN1cnJlbnREYXRlLmdldFRpbWUoKTtcclxuICAgICAgaWYgKHRoaXMuX21pbkRhdGUpIHtcclxuICAgICAgICBjdXJyZW50ID0gTWF0aC5tYXgoY3VycmVudCwgdGhpcy5fbWluRGF0ZS5nZXRUaW1lKCkpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh0aGlzLl9tYXhEYXRlKSB7XHJcbiAgICAgICAgY3VycmVudCA9IE1hdGgubWluKGN1cnJlbnQsIHRoaXMuX21heERhdGUuZ2V0VGltZSgpKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy5jdXJyZW50RGF0ZSA9IG5ldyBEYXRlKGN1cnJlbnQpO1xyXG4gICAgICB0aGlzLmNvbmZpZy51cGRhdGVCb3VuZHModGhpcy5jdXJyZW50RGF0ZSk7XHJcblxyXG4gICAgICB0aGlzLmN1cnJlbnRWaWV3ID0gdGhpcy5jb25maWcubWFwcGluZ3MuaW5pdGlhbFZpZXc7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgY2hhbmdlRGF0ZShkYXRlOiBEYXRlLCBmcm9tVmlldzogQ2FsZW5kYXJWaWV3VHlwZSk6IHZvaWQge1xyXG4gICAgdGhpcy5jdXJyZW50RGF0ZSA9IGRhdGU7XHJcblxyXG4gICAgaWYgKGZyb21WaWV3ID09PSB0aGlzLmNvbmZpZy5tYXBwaW5ncy5maW5hbFZpZXcpIHtcclxuICAgICAgdGhpcy5zZWxlY3RlZERhdGUgPSBkYXRlO1xyXG5cclxuICAgICAgcmV0dXJuIHRoaXMub25EYXRlQ2hhbmdlLmVtaXQoZGF0ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy51cGRhdGVWaWV3KHRoaXMuY29uZmlnLm1hcHBpbmdzLmNoYW5nZWQsIGZyb21WaWV3KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyB6b29tT3V0KGZyb21WaWV3OiBDYWxlbmRhclZpZXdUeXBlKTogdm9pZCB7XHJcbiAgICB0aGlzLnVwZGF0ZVZpZXcodGhpcy5jb25maWcubWFwcGluZ3Muem9vbSwgZnJvbVZpZXcpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB1cGRhdGVWaWV3KG1hcHBpbmdzOiBNYXA8Q2FsZW5kYXJWaWV3VHlwZSwgQ2FsZW5kYXJWaWV3VHlwZT4sIGZyb21WaWV3OiBDYWxlbmRhclZpZXdUeXBlKTogdm9pZCB7XHJcbiAgICBjb25zdCBtYXBwaW5nID0gbWFwcGluZ3MuZ2V0KGZyb21WaWV3KTtcclxuICAgIGlmIChtYXBwaW5nID09IHVuZGVmaW5lZCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gdmlldyB0eXBlLicpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5jdXJyZW50VmlldyA9IG1hcHBpbmc7XHJcbiAgfVxyXG59XHJcbiJdfQ==