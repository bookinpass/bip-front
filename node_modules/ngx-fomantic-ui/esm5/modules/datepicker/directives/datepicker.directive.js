/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Directive, ElementRef, EventEmitter, HostListener, Input, Output, Renderer2 } from '@angular/core';
import { CustomValidator, customValidatorFactory, CustomValueAccessor, customValueAccessorFactory, KeyCode, PositioningPlacement, FuiComponentFactory } from '../../../misc/util/internal';
import { FuiLocalizationService } from '../../../behaviors/localization/internal';
import { PopupConfig, PopupTrigger, FuiPopupComponentController } from '../../popup/internal';
import { DatepickerMode, FuiDatepicker } from '../components/datepicker';
import { DateConfig, DatetimeConfig, MonthConfig, TimeConfig, YearConfig } from '../classes/calendar-config';
var FuiDatepickerDirective = /** @class */ (function (_super) {
    tslib_1.__extends(FuiDatepickerDirective, _super);
    function FuiDatepickerDirective(renderer, element, componentFactory, localizationService) {
        var _this = _super.call(this, renderer, element, componentFactory, FuiDatepicker, new PopupConfig({
            trigger: PopupTrigger.Focus,
            placement: PositioningPlacement.BottomLeft,
            transition: 'scale',
            transitionDuration: 200
        })) || this;
        _this.localizationService = localizationService;
        // This ensures the popup is drawn correctly (i.e. no border).
        _this._renderer.addClass(_this.popup.elementRef.nativeElement, 'ui');
        _this._renderer.addClass(_this.popup.elementRef.nativeElement, 'calendar');
        _this.onLocaleUpdate();
        _this.localizationService.onLanguageUpdate.subscribe((/**
         * @return {?}
         */
        function () { return _this.onLocaleUpdate(); }));
        _this.onSelectedDateChange = new EventEmitter();
        _this.onValidatorChange = new EventEmitter();
        _this.mode = DatepickerMode.Datetime;
        return _this;
    }
    Object.defineProperty(FuiDatepickerDirective.prototype, "placement", {
        set: /**
         * @param {?} placement
         * @return {?}
         */
        function (placement) {
            this.popup.config.placement = placement;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FuiDatepickerDirective.prototype, "transition", {
        set: /**
         * @param {?} transition
         * @return {?}
         */
        function (transition) {
            this.popup.config.transition = transition;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FuiDatepickerDirective.prototype, "transitionDuration", {
        set: /**
         * @param {?} duration
         * @return {?}
         */
        function (duration) {
            this.popup.config.transitionDuration = duration;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FuiDatepickerDirective.prototype, "selectedDate", {
        get: /**
         * @return {?}
         */
        function () {
            return this._selectedDate;
        },
        set: /**
         * @param {?} date
         * @return {?}
         */
        function (date) {
            this._selectedDate = date;
            this.onSelectedDateChange.emit(date);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FuiDatepickerDirective.prototype, "mode", {
        get: /**
         * @return {?}
         */
        function () {
            return this._mode;
        },
        set: /**
         * @param {?} mode
         * @return {?}
         */
        function (mode) {
            this._mode = mode || DatepickerMode.Datetime;
            switch (this._mode) {
                case DatepickerMode.Year:
                    this.config = new YearConfig();
                    break;
                case DatepickerMode.Month:
                    this.config = new MonthConfig();
                    break;
                case DatepickerMode.Date:
                default:
                    this.config = new DateConfig();
                    break;
                case DatepickerMode.Datetime:
                    this.config = new DatetimeConfig();
                    break;
                case DatepickerMode.Time:
                    this.config = new TimeConfig();
                    break;
            }
            this.writeValue(this.selectedDate);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FuiDatepickerDirective.prototype, "localeValues", {
        get: /**
         * @return {?}
         */
        function () {
            return this.localizationService.override(this._localeValues, this.localeOverrides);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    FuiDatepickerDirective.prototype.popupOnOpen = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.componentInstance) {
            this.componentInstance.service.config = this.config;
            this.componentInstance.service.localeValues = this.localeValues;
            this.componentInstance.service.currentDate = this.initialDate || new Date();
            this.componentInstance.service.selectedDate = this.selectedDate;
            this.componentInstance.service.maxDate = this.maxDate;
            this.componentInstance.service.minDate = this.minDate;
            if (this.firstDayOfWeek != undefined) {
                this.componentInstance.service.firstDayOfWeek = this.firstDayOfWeek;
            }
            this.componentInstance.service.reset();
            this.componentInstance.service.onDateChange.subscribe((/**
             * @param {?} d
             * @return {?}
             */
            function (d) {
                _this.selectedDate = d;
                _this.close();
            }));
        }
    };
    /**
     * @param {?} __0
     * @return {?}
     */
    FuiDatepickerDirective.prototype.ngOnChanges = /**
     * @param {?} __0
     * @return {?}
     */
    function (_a) {
        var maxDate = _a.maxDate, minDate = _a.minDate, mode = _a.mode;
        if (maxDate || minDate || mode) {
            this.onValidatorChange.emit();
        }
    };
    /**
     * @param {?} c
     * @return {?}
     */
    FuiDatepickerDirective.prototype.validate = /**
     * @param {?} c
     * @return {?}
     */
    function (c) {
        /** @type {?} */
        var value = c.value;
        if (value != undefined) {
            // We post process the min & max date because sometimes this puts the date outside of the allowed range.
            if (this.minDate && value < this.minDate) {
                return { fuiMinDate: { required: this.minDate, actual: value } };
            }
            if (this.maxDate && value > this.maxDate) {
                return { fuiMaxDate: { required: this.maxDate, actual: value } };
            }
        }
        // Angular expects null
        // tslint:disable-next-line:no-null-keyword
        return null;
    };
    /**
     * @param {?} value
     * @return {?}
     */
    FuiDatepickerDirective.prototype.writeValue = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        this.selectedDate = value;
        if (this.componentInstance) {
            this.componentInstance.service.selectedDate = value;
        }
    };
    /**
     * @param {?} e
     * @return {?}
     */
    FuiDatepickerDirective.prototype.onKeyDown = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        if (e.keyCode === KeyCode.Escape) {
            this.close();
        }
    };
    /**
     * @private
     * @return {?}
     */
    FuiDatepickerDirective.prototype.onLocaleUpdate = /**
     * @private
     * @return {?}
     */
    function () {
        this._localeValues = this.localizationService.get().datepicker;
    };
    FuiDatepickerDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[fuiDatepicker]',
                    providers: [customValidatorFactory(FuiDatepickerDirective)]
                },] }
    ];
    /** @nocollapse */
    FuiDatepickerDirective.ctorParameters = function () { return [
        { type: Renderer2 },
        { type: ElementRef },
        { type: FuiComponentFactory },
        { type: FuiLocalizationService }
    ]; };
    FuiDatepickerDirective.propDecorators = {
        initialDate: [{ type: Input, args: ['pickerInitialDate',] }],
        maxDate: [{ type: Input, args: ['pickerMaxDate',] }],
        minDate: [{ type: Input, args: ['pickerMinDate',] }],
        firstDayOfWeek: [{ type: Input, args: ['pickerFirstDayOfWeek',] }],
        localeOverrides: [{ type: Input, args: ['pickerLocaleOverrides',] }],
        onSelectedDateChange: [{ type: Output, args: ['pickerSelectedDateChange',] }],
        onValidatorChange: [{ type: Output, args: ['pickerValidatorChange',] }],
        placement: [{ type: Input, args: ['pickerPlacement',] }],
        transition: [{ type: Input, args: ['pickerTransition',] }],
        transitionDuration: [{ type: Input, args: ['pickerTransitionDuration',] }],
        mode: [{ type: Input, args: ['pickerMode',] }],
        onKeyDown: [{ type: HostListener, args: ['keydown', ['$event'],] }]
    };
    return FuiDatepickerDirective;
}(FuiPopupComponentController));
export { FuiDatepickerDirective };
if (false) {
    /** @type {?} */
    FuiDatepickerDirective.prototype.config;
    /** @type {?} */
    FuiDatepickerDirective.prototype.initialDate;
    /** @type {?} */
    FuiDatepickerDirective.prototype.maxDate;
    /** @type {?} */
    FuiDatepickerDirective.prototype.minDate;
    /** @type {?} */
    FuiDatepickerDirective.prototype.firstDayOfWeek;
    /** @type {?} */
    FuiDatepickerDirective.prototype.localeOverrides;
    /** @type {?} */
    FuiDatepickerDirective.prototype.onSelectedDateChange;
    /** @type {?} */
    FuiDatepickerDirective.prototype.onValidatorChange;
    /**
     * @type {?}
     * @private
     */
    FuiDatepickerDirective.prototype._selectedDate;
    /**
     * @type {?}
     * @private
     */
    FuiDatepickerDirective.prototype._mode;
    /**
     * @type {?}
     * @private
     */
    FuiDatepickerDirective.prototype._localeValues;
    /** @type {?} */
    FuiDatepickerDirective.prototype.localizationService;
}
var FuiDatepickerDirectiveValueAccessor = /** @class */ (function (_super) {
    tslib_1.__extends(FuiDatepickerDirectiveValueAccessor, _super);
    function FuiDatepickerDirectiveValueAccessor(host) {
        var _this = _super.call(this, host) || this;
        _this.host = host;
        return _this;
    }
    FuiDatepickerDirectiveValueAccessor.decorators = [
        { type: Directive, args: [{
                    selector: '[fuiDatepicker]',
                    host: { '(pickerSelectedDateChange)': 'onChange($event)' },
                    providers: [customValueAccessorFactory(FuiDatepickerDirectiveValueAccessor)]
                },] }
    ];
    /** @nocollapse */
    FuiDatepickerDirectiveValueAccessor.ctorParameters = function () { return [
        { type: FuiDatepickerDirective }
    ]; };
    return FuiDatepickerDirectiveValueAccessor;
}(CustomValueAccessor));
export { FuiDatepickerDirectiveValueAccessor };
if (false) {
    /** @type {?} */
    FuiDatepickerDirectiveValueAccessor.prototype.host;
}
var FuiDatepickerDirectiveValidator = /** @class */ (function (_super) {
    tslib_1.__extends(FuiDatepickerDirectiveValidator, _super);
    function FuiDatepickerDirectiveValidator(host) {
        var _this = _super.call(this, host) || this;
        _this.host = host;
        return _this;
    }
    FuiDatepickerDirectiveValidator.decorators = [
        { type: Directive, args: [{
                    selector: '[fuiDatepicker]',
                    host: { '(pickerValidatorChange)': 'onValidatorChange()' },
                    providers: [customValidatorFactory(FuiDatepickerDirectiveValidator)]
                },] }
    ];
    /** @nocollapse */
    FuiDatepickerDirectiveValidator.ctorParameters = function () { return [
        { type: FuiDatepickerDirective }
    ]; };
    return FuiDatepickerDirectiveValidator;
}(CustomValidator));
export { FuiDatepickerDirectiveValidator };
if (false) {
    /** @type {?} */
    FuiDatepickerDirectiveValidator.prototype.host;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZXBpY2tlci5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtZm9tYW50aWMtdWkvIiwic291cmNlcyI6WyJtb2R1bGVzL2RhdGVwaWNrZXIvZGlyZWN0aXZlcy9kYXRlcGlja2VyLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBQyxTQUFTLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFhLE1BQU0sRUFBRSxTQUFTLEVBQWdCLE1BQU0sZUFBZSxDQUFDO0FBRXBJLE9BQU8sRUFDTCxlQUFlLEVBQ2Ysc0JBQXNCLEVBQ3RCLG1CQUFtQixFQUNuQiwwQkFBMEIsRUFHMUIsT0FBTyxFQUNQLG9CQUFvQixFQUNwQixtQkFBbUIsRUFDcEIsTUFBTSw2QkFBNkIsQ0FBQztBQUNyQyxPQUFPLEVBQTRDLHNCQUFzQixFQUFDLE1BQU0sMENBQTBDLENBQUM7QUFDM0gsT0FBTyxFQUFpQixXQUFXLEVBQUUsWUFBWSxFQUFFLDJCQUEyQixFQUFDLE1BQU0sc0JBQXNCLENBQUM7QUFDNUcsT0FBTyxFQUFDLGNBQWMsRUFBRSxhQUFhLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQztBQUN2RSxPQUFPLEVBQWlCLFVBQVUsRUFBRSxjQUFjLEVBQUUsV0FBVyxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUMsTUFBTSw0QkFBNEIsQ0FBQztBQUUzSDtJQUtVLGtEQUEwQztJQW1CbEQsZ0NBQVksUUFBbUIsRUFDbkIsT0FBbUIsRUFDbkIsZ0JBQXFDLEVBQzlCLG1CQUEyQztRQUg5RCxZQUtFLGtCQUFNLFFBQVEsRUFBRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsYUFBYSxFQUFFLElBQUksV0FBVyxDQUFDO1lBQ3hFLE9BQU8sRUFBRSxZQUFZLENBQUMsS0FBSztZQUMzQixTQUFTLEVBQUUsb0JBQW9CLENBQUMsVUFBVTtZQUMxQyxVQUFVLEVBQUUsT0FBTztZQUNuQixrQkFBa0IsRUFBRSxH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LHFEQUFrRDs7QUF1SmhFO0lBS3lELCtEQUFpRDtJQUN4Ryw2Q0FBbUIsSUFBNEI7UUFBL0MsWUFDRSxrQkFBTSxJQUFJLENBQUMsU0FDWjtRQUZrQixVQUFJLEdBQUosSUFBSSxDQUF3Qjs7SUFFL0MsQ0FBQzs7Z0JBUkYsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSxpQkFBaUI7b0JBQzNCLElBQUksRUFBRSxFQUFDLDRCQUE0QixFQUFFLGtCQUFrQixFQUFDO29CQUN4RCxTQUFTLEVBQUUsQ0FBQywwQkFBMEIsQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO2lCQUM3RTs7OztnQkFFMEIsc0JBQXNCOztJQUdqRCwwQ0FBQztDQUFBLEFBVEQsQ0FLeUQsbUJBQW1CLEdBSTNFO1NBSlksbUNBQW1DOzs7SUFDbEMsbURBQW1DOztBQUtqRDtJQUtxRCwyREFBdUM7SUFDMUYseUNBQW1CLElBQTRCO1FBQS9DLFlBQ0Usa0JBQU0sSUFBSSxDQUFDLFNBQ1o7UUFGa0IsVUFBSSxHQUFKLElBQUksQ0FBd0I7O0lBRS9DLENBQUM7O2dCQVJGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsaUJBQWlCO29CQUMzQixJQUFJLEVBQUUsRUFBQyx5QkFBeUIsRUFBRSxxQkFBcUIsRUFBQztvQkFDeEQsU0FBUyxFQUFFLENBQUMsc0JBQXNCLENBQUMsK0JBQStCLENBQUMsQ0FBQztpQkFDckU7Ozs7Z0JBRTBCLHNCQUFzQjs7SUFHakQsc0NBQUM7Q0FBQSxBQVRELENBS3FELGVBQWUsR0FJbkU7U0FKWSwrQkFBK0I7OztJQUM5QiwrQ0FBbUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0RpcmVjdGl2ZSwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBIb3N0TGlzdGVuZXIsIElucHV0LCBPbkNoYW5nZXMsIE91dHB1dCwgUmVuZGVyZXIyLCBTaW1wbGVDaGFuZ2VzfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHtBYnN0cmFjdENvbnRyb2wsIFZhbGlkYXRpb25FcnJvcnN9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHtcclxuICBDdXN0b21WYWxpZGF0b3IsXHJcbiAgY3VzdG9tVmFsaWRhdG9yRmFjdG9yeSxcclxuICBDdXN0b21WYWx1ZUFjY2Vzc29yLFxyXG4gIGN1c3RvbVZhbHVlQWNjZXNzb3JGYWN0b3J5LFxyXG4gIElDdXN0b21WYWxpZGF0b3JIb3N0LFxyXG4gIElDdXN0b21WYWx1ZUFjY2Vzc29ySG9zdCxcclxuICBLZXlDb2RlLFxyXG4gIFBvc2l0aW9uaW5nUGxhY2VtZW50LFxyXG4gIEZ1aUNvbXBvbmVudEZhY3RvcnlcclxufSBmcm9tICcuLi8uLi8uLi9taXNjL3V0aWwvaW50ZXJuYWwnO1xyXG5pbXBvcnQge0lEYXRlcGlja2VyTG9jYWxlVmFsdWVzLCBSZWN1cnNpdmVQYXJ0aWFsLCBGdWlMb2NhbGl6YXRpb25TZXJ2aWNlfSBmcm9tICcuLi8uLi8uLi9iZWhhdmlvcnMvbG9jYWxpemF0aW9uL2ludGVybmFsJztcclxuaW1wb3J0IHtQb3B1cEFmdGVyT3BlbiwgUG9wdXBDb25maWcsIFBvcHVwVHJpZ2dlciwgRnVpUG9wdXBDb21wb25lbnRDb250cm9sbGVyfSBmcm9tICcuLi8uLi9wb3B1cC9pbnRlcm5hbCc7XHJcbmltcG9ydCB7RGF0ZXBpY2tlck1vZGUsIEZ1aURhdGVwaWNrZXJ9IGZyb20gJy4uL2NvbXBvbmVudHMvZGF0ZXBpY2tlcic7XHJcbmltcG9ydCB7Q2FsZW5kYXJDb25maWcsIERhdGVDb25maWcsIERhdGV0aW1lQ29uZmlnLCBNb250aENvbmZpZywgVGltZUNvbmZpZywgWWVhckNvbmZpZ30gZnJvbSAnLi4vY2xhc3Nlcy9jYWxlbmRhci1jb25maWcnO1xyXG5cclxuQERpcmVjdGl2ZSh7XHJcbiAgc2VsZWN0b3I6ICdbZnVpRGF0ZXBpY2tlcl0nLFxyXG4gIHByb3ZpZGVyczogW2N1c3RvbVZhbGlkYXRvckZhY3RvcnkoRnVpRGF0ZXBpY2tlckRpcmVjdGl2ZSldXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBGdWlEYXRlcGlja2VyRGlyZWN0aXZlXHJcbiAgZXh0ZW5kcyBGdWlQb3B1cENvbXBvbmVudENvbnRyb2xsZXI8RnVpRGF0ZXBpY2tlcj5cclxuICBpbXBsZW1lbnRzIElDdXN0b21WYWx1ZUFjY2Vzc29ySG9zdDxEYXRlPiwgSUN1c3RvbVZhbGlkYXRvckhvc3QsIE9uQ2hhbmdlcywgUG9wdXBBZnRlck9wZW4ge1xyXG5cclxuICBwdWJsaWMgY29uZmlnOiBDYWxlbmRhckNvbmZpZztcclxuICBASW5wdXQoJ3BpY2tlckluaXRpYWxEYXRlJylcclxuICBwdWJsaWMgaW5pdGlhbERhdGU/OiBEYXRlO1xyXG4gIEBJbnB1dCgncGlja2VyTWF4RGF0ZScpXHJcbiAgcHVibGljIG1heERhdGU/OiBEYXRlO1xyXG4gIEBJbnB1dCgncGlja2VyTWluRGF0ZScpXHJcbiAgcHVibGljIG1pbkRhdGU/OiBEYXRlO1xyXG4gIEBJbnB1dCgncGlja2VyRmlyc3REYXlPZldlZWsnKVxyXG4gIHB1YmxpYyBmaXJzdERheU9mV2Vlaz86IG51bWJlcjtcclxuICBASW5wdXQoJ3BpY2tlckxvY2FsZU92ZXJyaWRlcycpXHJcbiAgcHVibGljIGxvY2FsZU92ZXJyaWRlczogUmVjdXJzaXZlUGFydGlhbDxJRGF0ZXBpY2tlckxvY2FsZVZhbHVlcz47XHJcbiAgQE91dHB1dCgncGlja2VyU2VsZWN0ZWREYXRlQ2hhbmdlJylcclxuICBwdWJsaWMgb25TZWxlY3RlZERhdGVDaGFuZ2U6IEV2ZW50RW1pdHRlcjxEYXRlPjtcclxuICBAT3V0cHV0KCdwaWNrZXJWYWxpZGF0b3JDaGFuZ2UnKVxyXG4gIHB1YmxpYyBvblZhbGlkYXRvckNoYW5nZTogRXZlbnRFbWl0dGVyPHZvaWQ+O1xyXG5cclxuICBjb25zdHJ1Y3RvcihyZW5kZXJlcjogUmVuZGVyZXIyLFxyXG4gICAgICAgICAgICAgIGVsZW1lbnQ6IEVsZW1lbnRSZWYsXHJcbiAgICAgICAgICAgICAgY29tcG9uZW50RmFjdG9yeTogRnVpQ29tcG9uZW50RmFjdG9yeSxcclxuICAgICAgICAgICAgICBwdWJsaWMgbG9jYWxpemF0aW9uU2VydmljZTogRnVpTG9jYWxpemF0aW9uU2VydmljZSkge1xyXG5cclxuICAgIHN1cGVyKHJlbmRlcmVyLCBlbGVtZW50LCBjb21wb25lbnRGYWN0b3J5LCBGdWlEYXRlcGlja2VyLCBuZXcgUG9wdXBDb25maWcoe1xyXG4gICAgICB0cmlnZ2VyOiBQb3B1cFRyaWdnZXIuRm9jdXMsXHJcbiAgICAgIHBsYWNlbWVudDogUG9zaXRpb25pbmdQbGFjZW1lbnQuQm90dG9tTGVmdCxcclxuICAgICAgdHJhbnNpdGlvbjogJ3NjYWxlJyxcclxuICAgICAgdHJhbnNpdGlvbkR1cmF0aW9uOiAyMDBcclxuICAgIH0pKTtcclxuXHJcbiAgICAvLyBUaGlzIGVuc3VyZXMgdGhlIHBvcHVwIGlzIGRyYXduIGNvcnJlY3RseSAoaS5lLiBubyBib3JkZXIpLlxyXG4gICAgdGhpcy5fcmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5wb3B1cC5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICd1aScpO1xyXG4gICAgdGhpcy5fcmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5wb3B1cC5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdjYWxlbmRhcicpO1xyXG5cclxuICAgIHRoaXMub25Mb2NhbGVVcGRhdGUoKTtcclxuICAgIHRoaXMubG9jYWxpemF0aW9uU2VydmljZS5vbkxhbmd1YWdlVXBkYXRlLnN1YnNjcmliZSgoKSA9PiB0aGlzLm9uTG9jYWxlVXBkYXRlKCkpO1xyXG5cclxuICAgIHRoaXMub25TZWxlY3RlZERhdGVDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPERhdGU+KCk7XHJcbiAgICB0aGlzLm9uVmFsaWRhdG9yQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xyXG5cclxuICAgIHRoaXMubW9kZSA9IERhdGVwaWNrZXJNb2RlLkRhdGV0aW1lO1xyXG4gIH1cclxuXHJcbiAgQElucHV0KCdwaWNrZXJQbGFjZW1lbnQnKVxyXG4gIHB1YmxpYyBzZXQgcGxhY2VtZW50KHBsYWNlbWVudDogUG9zaXRpb25pbmdQbGFjZW1lbnQpIHtcclxuICAgIHRoaXMucG9wdXAuY29uZmlnLnBsYWNlbWVudCA9IHBsYWNlbWVudDtcclxuICB9XHJcblxyXG4gIEBJbnB1dCgncGlja2VyVHJhbnNpdGlvbicpXHJcbiAgcHVibGljIHNldCB0cmFuc2l0aW9uKHRyYW5zaXRpb246IHN0cmluZykge1xyXG4gICAgdGhpcy5wb3B1cC5jb25maWcudHJhbnNpdGlvbiA9IHRyYW5zaXRpb247XHJcbiAgfVxyXG5cclxuICBASW5wdXQoJ3BpY2tlclRyYW5zaXRpb25EdXJhdGlvbicpXHJcbiAgcHVibGljIHNldCB0cmFuc2l0aW9uRHVyYXRpb24oZHVyYXRpb246IG51bWJlcikge1xyXG4gICAgdGhpcy5wb3B1cC5jb25maWcudHJhbnNpdGlvbkR1cmF0aW9uID0gZHVyYXRpb247XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9zZWxlY3RlZERhdGU/OiBEYXRlO1xyXG5cclxuICBwdWJsaWMgZ2V0IHNlbGVjdGVkRGF0ZSgpOiBEYXRlIHwgdW5kZWZpbmVkIHtcclxuICAgIHJldHVybiB0aGlzLl9zZWxlY3RlZERhdGU7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0IHNlbGVjdGVkRGF0ZShkYXRlOiBEYXRlIHwgdW5kZWZpbmVkKSB7XHJcbiAgICB0aGlzLl9zZWxlY3RlZERhdGUgPSBkYXRlO1xyXG4gICAgdGhpcy5vblNlbGVjdGVkRGF0ZUNoYW5nZS5lbWl0KGRhdGUpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfbW9kZTogRGF0ZXBpY2tlck1vZGU7XHJcblxyXG4gIEBJbnB1dCgncGlja2VyTW9kZScpXHJcbiAgcHVibGljIGdldCBtb2RlKCk6IERhdGVwaWNrZXJNb2RlIHtcclxuICAgIHJldHVybiB0aGlzLl9tb2RlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldCBtb2RlKG1vZGU6IERhdGVwaWNrZXJNb2RlKSB7XHJcbiAgICB0aGlzLl9tb2RlID0gbW9kZSB8fCBEYXRlcGlja2VyTW9kZS5EYXRldGltZTtcclxuICAgIHN3aXRjaCAodGhpcy5fbW9kZSkge1xyXG4gICAgICBjYXNlIERhdGVwaWNrZXJNb2RlLlllYXI6XHJcbiAgICAgICAgdGhpcy5jb25maWcgPSBuZXcgWWVhckNvbmZpZygpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIERhdGVwaWNrZXJNb2RlLk1vbnRoOlxyXG4gICAgICAgIHRoaXMuY29uZmlnID0gbmV3IE1vbnRoQ29uZmlnKCk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgRGF0ZXBpY2tlck1vZGUuRGF0ZTpcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICB0aGlzLmNvbmZpZyA9IG5ldyBEYXRlQ29uZmlnKCk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgRGF0ZXBpY2tlck1vZGUuRGF0ZXRpbWU6XHJcbiAgICAgICAgdGhpcy5jb25maWcgPSBuZXcgRGF0ZXRpbWVDb25maWcoKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSBEYXRlcGlja2VyTW9kZS5UaW1lOlxyXG4gICAgICAgIHRoaXMuY29uZmlnID0gbmV3IFRpbWVDb25maWcoKTtcclxuICAgICAgICBicmVhaztcclxuICAgIH1cclxuICAgIHRoaXMud3JpdGVWYWx1ZSh0aGlzLnNlbGVjdGVkRGF0ZSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9sb2NhbGVWYWx1ZXM6IElEYXRlcGlja2VyTG9jYWxlVmFsdWVzO1xyXG5cclxuICBwdWJsaWMgZ2V0IGxvY2FsZVZhbHVlcygpOiBJRGF0ZXBpY2tlckxvY2FsZVZhbHVlcyB7XHJcbiAgICByZXR1cm4gdGhpcy5sb2NhbGl6YXRpb25TZXJ2aWNlLm92ZXJyaWRlPCdkYXRlcGlja2VyJz4odGhpcy5fbG9jYWxlVmFsdWVzLCB0aGlzLmxvY2FsZU92ZXJyaWRlcyk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcG9wdXBPbk9wZW4oKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5jb21wb25lbnRJbnN0YW5jZSkge1xyXG4gICAgICB0aGlzLmNvbXBvbmVudEluc3RhbmNlLnNlcnZpY2UuY29uZmlnID0gdGhpcy5jb25maWc7XHJcbiAgICAgIHRoaXMuY29tcG9uZW50SW5zdGFuY2Uuc2VydmljZS5sb2NhbGVWYWx1ZXMgPSB0aGlzLmxvY2FsZVZhbHVlcztcclxuICAgICAgdGhpcy5jb21wb25lbnRJbnN0YW5jZS5zZXJ2aWNlLmN1cnJlbnREYXRlID0gdGhpcy5pbml0aWFsRGF0ZSB8fCBuZXcgRGF0ZSgpO1xyXG4gICAgICB0aGlzLmNvbXBvbmVudEluc3RhbmNlLnNlcnZpY2Uuc2VsZWN0ZWREYXRlID0gdGhpcy5zZWxlY3RlZERhdGU7XHJcbiAgICAgIHRoaXMuY29tcG9uZW50SW5zdGFuY2Uuc2VydmljZS5tYXhEYXRlID0gdGhpcy5tYXhEYXRlO1xyXG4gICAgICB0aGlzLmNvbXBvbmVudEluc3RhbmNlLnNlcnZpY2UubWluRGF0ZSA9IHRoaXMubWluRGF0ZTtcclxuXHJcbiAgICAgIGlmICh0aGlzLmZpcnN0RGF5T2ZXZWVrICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHRoaXMuY29tcG9uZW50SW5zdGFuY2Uuc2VydmljZS5maXJzdERheU9mV2VlayA9IHRoaXMuZmlyc3REYXlPZldlZWs7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMuY29tcG9uZW50SW5zdGFuY2Uuc2VydmljZS5yZXNldCgpO1xyXG5cclxuICAgICAgdGhpcy5jb21wb25lbnRJbnN0YW5jZS5zZXJ2aWNlLm9uRGF0ZUNoYW5nZS5zdWJzY3JpYmUoKGQ6IERhdGUpID0+IHtcclxuICAgICAgICB0aGlzLnNlbGVjdGVkRGF0ZSA9IGQ7XHJcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBuZ09uQ2hhbmdlcyh7bWF4RGF0ZSwgbWluRGF0ZSwgbW9kZX06IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcclxuICAgIGlmIChtYXhEYXRlIHx8IG1pbkRhdGUgfHwgbW9kZSkge1xyXG4gICAgICB0aGlzLm9uVmFsaWRhdG9yQ2hhbmdlLmVtaXQoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyB2YWxpZGF0ZShjOiBBYnN0cmFjdENvbnRyb2wpOiBWYWxpZGF0aW9uRXJyb3JzIHwgbnVsbCB7XHJcbiAgICBjb25zdCB2YWx1ZSA9IGMudmFsdWU7XHJcblxyXG4gICAgaWYgKHZhbHVlICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAvLyBXZSBwb3N0IHByb2Nlc3MgdGhlIG1pbiAmIG1heCBkYXRlIGJlY2F1c2Ugc29tZXRpbWVzIHRoaXMgcHV0cyB0aGUgZGF0ZSBvdXRzaWRlIG9mIHRoZSBhbGxvd2VkIHJhbmdlLlxyXG4gICAgICBpZiAodGhpcy5taW5EYXRlICYmIHZhbHVlIDwgdGhpcy5taW5EYXRlKSB7XHJcbiAgICAgICAgcmV0dXJuIHtmdWlNaW5EYXRlOiB7cmVxdWlyZWQ6IHRoaXMubWluRGF0ZSwgYWN0dWFsOiB2YWx1ZX19O1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAodGhpcy5tYXhEYXRlICYmIHZhbHVlID4gdGhpcy5tYXhEYXRlKSB7XHJcbiAgICAgICAgcmV0dXJuIHtmdWlNYXhEYXRlOiB7cmVxdWlyZWQ6IHRoaXMubWF4RGF0ZSwgYWN0dWFsOiB2YWx1ZX19O1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQW5ndWxhciBleHBlY3RzIG51bGxcclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1udWxsLWtleXdvcmRcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHdyaXRlVmFsdWUodmFsdWU6IERhdGUgfCB1bmRlZmluZWQpOiB2b2lkIHtcclxuICAgIHRoaXMuc2VsZWN0ZWREYXRlID0gdmFsdWU7XHJcblxyXG4gICAgaWYgKHRoaXMuY29tcG9uZW50SW5zdGFuY2UpIHtcclxuICAgICAgdGhpcy5jb21wb25lbnRJbnN0YW5jZS5zZXJ2aWNlLnNlbGVjdGVkRGF0ZSA9IHZhbHVlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgQEhvc3RMaXN0ZW5lcigna2V5ZG93bicsIFsnJGV2ZW50J10pXHJcbiAgcHVibGljIG9uS2V5RG93bihlOiBLZXlib2FyZEV2ZW50KTogdm9pZCB7XHJcbiAgICBpZiAoZS5rZXlDb2RlID09PSBLZXlDb2RlLkVzY2FwZSkge1xyXG4gICAgICB0aGlzLmNsb3NlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG9uTG9jYWxlVXBkYXRlKCk6IHZvaWQge1xyXG4gICAgdGhpcy5fbG9jYWxlVmFsdWVzID0gdGhpcy5sb2NhbGl6YXRpb25TZXJ2aWNlLmdldCgpLmRhdGVwaWNrZXI7XHJcbiAgfVxyXG59XHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICBzZWxlY3RvcjogJ1tmdWlEYXRlcGlja2VyXScsXHJcbiAgaG9zdDogeycocGlja2VyU2VsZWN0ZWREYXRlQ2hhbmdlKSc6ICdvbkNoYW5nZSgkZXZlbnQpJ30sXHJcbiAgcHJvdmlkZXJzOiBbY3VzdG9tVmFsdWVBY2Nlc3NvckZhY3RvcnkoRnVpRGF0ZXBpY2tlckRpcmVjdGl2ZVZhbHVlQWNjZXNzb3IpXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgRnVpRGF0ZXBpY2tlckRpcmVjdGl2ZVZhbHVlQWNjZXNzb3IgZXh0ZW5kcyBDdXN0b21WYWx1ZUFjY2Vzc29yPERhdGUsIEZ1aURhdGVwaWNrZXJEaXJlY3RpdmU+IHtcclxuICBjb25zdHJ1Y3RvcihwdWJsaWMgaG9zdDogRnVpRGF0ZXBpY2tlckRpcmVjdGl2ZSkge1xyXG4gICAgc3VwZXIoaG9zdCk7XHJcbiAgfVxyXG59XHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICBzZWxlY3RvcjogJ1tmdWlEYXRlcGlja2VyXScsXHJcbiAgaG9zdDogeycocGlja2VyVmFsaWRhdG9yQ2hhbmdlKSc6ICdvblZhbGlkYXRvckNoYW5nZSgpJ30sXHJcbiAgcHJvdmlkZXJzOiBbY3VzdG9tVmFsaWRhdG9yRmFjdG9yeShGdWlEYXRlcGlja2VyRGlyZWN0aXZlVmFsaWRhdG9yKV1cclxufSlcclxuZXhwb3J0IGNsYXNzIEZ1aURhdGVwaWNrZXJEaXJlY3RpdmVWYWxpZGF0b3IgZXh0ZW5kcyBDdXN0b21WYWxpZGF0b3I8RnVpRGF0ZXBpY2tlckRpcmVjdGl2ZT4ge1xyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBob3N0OiBGdWlEYXRlcGlja2VyRGlyZWN0aXZlKSB7XHJcbiAgICBzdXBlcihob3N0KTtcclxuICB9XHJcbn1cclxuIl19