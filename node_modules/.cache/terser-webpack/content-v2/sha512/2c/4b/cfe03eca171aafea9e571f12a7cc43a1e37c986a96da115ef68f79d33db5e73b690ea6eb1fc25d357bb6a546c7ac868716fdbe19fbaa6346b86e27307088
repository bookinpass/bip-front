{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{DrXB:function(module,__webpack_exports__,__webpack_require__){\"use strict\";__webpack_require__.d(__webpack_exports__,\"a\",(function(){return MustMatch})),__webpack_require__.d(__webpack_exports__,\"b\",(function(){return OptionalValidator})),__webpack_require__.d(__webpack_exports__,\"c\",(function(){return ValidPhone}));var _angular_forms__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(\"3Pt+\"),libphonenumber_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(\"PoRY\");function MustMatch(controlName,matchingControlName){return formGroup=>{const matchingControl=formGroup.controls[matchingControlName];matchingControl.errors&&!matchingControl.errors.mustMatch||matchingControl.setErrors(formGroup.controls[controlName].value!==matchingControl.value?{mustMatch:!0}:null)}}function OptionalValidator(validators){return control=>control.value?_angular_forms__WEBPACK_IMPORTED_MODULE_0__.w.compose(validators)(control):null}function ValidPhone(countryCodeControlName,telephoneControlName){return formGroup=>{const country=formGroup.controls[countryCodeControlName],telephone=formGroup.controls[telephoneControlName];telephone.errors&&!telephone.errors.checkTelephone||country.errors&&!telephone.errors.required||(Object(libphonenumber_js__WEBPACK_IMPORTED_MODULE_1__.c)(telephone.value,country.value.toUpperCase())?telephone.setErrors(null):telephone.setErrors({validPhone:!0}))}}},oVPa:function(module,__webpack_exports__,__webpack_require__){\"use strict\";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,\"PaymentModule\",(function(){return payment_module_PaymentModule}));var common=__webpack_require__(\"ofXK\"),router=__webpack_require__(\"tyNb\"),payment_component=__webpack_require__(\"ywLJ\"),core=__webpack_require__(\"fXoL\");const routes=[{path:\"\",component:payment_component.a}];let payment_routing_module_PaymentRoutingModule=(()=>{class PaymentRoutingModule{}return PaymentRoutingModule.ɵmod=core.Ob({type:PaymentRoutingModule}),PaymentRoutingModule.ɵinj=core.Nb({factory:function(t){return new(t||PaymentRoutingModule)},imports:[[router.g.forChild(routes)],router.g]}),PaymentRoutingModule})();var fesm2015_forms=__webpack_require__(\"3Pt+\"),dialog=__webpack_require__(\"0IaG\");let payment_module_PaymentModule=(()=>{class PaymentModule{}return PaymentModule.ɵmod=core.Ob({type:PaymentModule}),PaymentModule.ɵinj=core.Nb({factory:function(t){return new(t||PaymentModule)},imports:[[common.c,payment_routing_module_PaymentRoutingModule,fesm2015_forms.i,dialog.f]]}),PaymentModule})()},ywLJ:function(module,__webpack_exports__,__webpack_require__){\"use strict\";__webpack_require__.d(__webpack_exports__,\"a\",(function(){return payment_component_PaymentComponent}));var core=__webpack_require__(\"fXoL\"),url_config=__webpack_require__(\"QnqH\"),Swal_config=__webpack_require__(\"BapT\"),Country_FR_json=__webpack_require__(\"QmTJ\"),Country_json=__webpack_require__(\"MsxN\"),scavenger=__webpack_require__(\"+0XT\"),sweetalert2_all=__webpack_require__(\"PSD3\"),sweetalert2_all_default=__webpack_require__.n(sweetalert2_all),index_es6=__webpack_require__(\"PoRY\"),fesm2015_dialog=__webpack_require__(\"0IaG\"),addHours=__webpack_require__(\"Da6A\"),retry=__webpack_require__(\"un/a\"),common=__webpack_require__(\"ofXK\"),fesm2015_http=__webpack_require__(\"tk/3\");let currency_service_CurrencyService=(()=>{class CurrencyService{constructor(http){this.http=http,this.config=new url_config.a}getCurrencyConverterRate(from,to,amount){const param=new fesm2015_http.f({fromObject:{format:\"json\",from:from,to:to,amount:amount.toString()}}),header=new fesm2015_http.e({\"x-rapidapi-host\":\"currency-converter5.p.rapidapi.com\",\"x-rapidapi-key\":\"67568f8200msh5098fd2bce948a2p156272jsn548d1cf520b5\"});return this.http.get(\"https://currency-converter5.p.rapidapi.com/currency/convert\",{headers:header,params:param})}sendNotificationSMS(tel,msg){return tel=tel.replace(\"+\",\"\"),this.http.post(`${this.config.mainHost}${this.config.sendSmsNotification}?telephone=${tel}`,JSON.stringify(msg))}}return CurrencyService.ɵfac=function(t){return new(t||CurrencyService)(core.ec(fesm2015_http.b))},CurrencyService.ɵprov=core.Mb({token:CurrencyService,factory:CurrencyService.ɵfac,providedIn:\"root\"}),CurrencyService})();var fesm2015_forms=__webpack_require__(\"3Pt+\");function CashPaymentComponent_option_19_Template(rf,ctx){if(1&rf&&(core.Wb(0,\"option\",18),core.Uc(1),core.Vb()),2&rf){const country_r314=ctx.$implicit;core.uc(\"value\",country_r314.code),core.Cb(1),core.Vc(country_r314.name)}}let cash_payment_component_CashPaymentComponent=(()=>{class CashPaymentComponent{constructor(dialogRef,data,datePipe,currency){this.dialogRef=dialogRef,this.data=data,this.datePipe=datePipe,this.currency=currency,this.loading=!1,this.countries=(new Country_FR_json.a).countries,this.status=!1,this.scavenger=new scavenger.Scavenger(this)}ngOnInit(){this.payer=this.data.payer,this.price=this.data.price}ngOnDestroy(){}getCountryDialingCode(){return(new Country_json.a).countries.find(x=>x.code.equalIgnoreCase(this.payer.countryCode)).dial_code}cancelRequest(){sweetalert2_all_default.a.fire(\"Annulé\",\"Vous avez annulé le processus de paiement\",\"info\").then(res=>{res&&(this.data.status=\"canceled\",this.dialogRef.close(this.status))})}validateRequest(){this.checkPhoneNumber()?(this.loading=!0,setTimeout(()=>{sweetalert2_all_default.a.fire({title:\"Cash payment\",html:'<p class=\"text-center\">Votre reservation a été enregistrée. Un message vous sera envoyé avec le code de rérservation suivant: SN892JI7P<br/><br/>Rendez vous dans le point relais le plus proche pour valider votre reservation avant le '+this.datePipe.transform(Object(addHours.a)(new Date,5),\"EEEE, dd MMMM yyyy à HH:mm\")+\"</p>\",icon:\"success\",showCancelButton:!1,confirmButtonText:\"OK\",allowEnterKey:!0,allowOutsideClick:!1,allowEscapeKey:!1}).then(res=>{if(res){this.loading=!1,this.status=!0;const sms=\"Bonjour, votre réservation a bien été enregistrée. Numéro de votre dossier: SN892JI7P. Rendez-vous au point de relai le plus proche.\",tel=(new Country_json.a).countries.find(x=>x.code===this.payer.countryCode).dial_code.replace(\"+\",\"\").concat(this.payer.telephone);this.currency.sendNotificationSMS(tel,sms).pipe(this.scavenger.collect(),Object(retry.a)(2)).subscribe(()=>this.dialogRef.close(this.status))}})},1e3)):sweetalert2_all_default.a.fire(\"Erreur\",\"Ce numero de telephone ne represente pas un numero valide pour le \"+this.countries.find(x=>x.code.equalIgnoreCase(this.payer.countryCode)).name)}checkPhoneNumber(){return Object(index_es6.d)(this.payer.telephone,this.payer.countryCode)}}return CashPaymentComponent.ɵfac=function(t){return new(t||CashPaymentComponent)(core.Qb(fesm2015_dialog.g),core.Qb(fesm2015_dialog.a),core.Qb(common.f),core.Qb(currency_service_CurrencyService))},CashPaymentComponent.ɵcmp=core.Kb({type:CashPaymentComponent,selectors:[[\"app-cash-payment\"]],decls:33,vars:10,consts:[[\"mat-dialog-title\",\"\",1,\"d-flex\",\"flex-column\",\"justify-content-start\",\"mb-2\"],[1,\"d-flex\",\"flex-row\",\"justify-content-between\"],[\"alt\",\"logo BIP\",\"height\",\"80px\",\"src\",\"../../../../assets/images/logo/bip-logo.png\",\"width\",\"130px\"],[\"alt\",\"logo paiement en espece\",\"height\",\"80px\",\"src\",\"../../../../assets/images/icons/cash.jpg\",\"width\",\"80px\"],[1,\"payment-text\"],[\"mat-dialog-content\",\"\",1,\"ui\",\"form\",\"w-100\",\"m-0\",\"p-0\",3,\"ngClass\"],[1,\"ui\",\"required\",\"field\"],[\"name\",\"firstName\",\"type\",\"text\",3,\"ngModel\",\"ngModelChange\"],[\"name\",\"lastName\",\"type\",\"text\",3,\"ngModel\",\"ngModelChange\"],[1,\"field\"],[1,\"ui\",\"compact\",\"selection\",\"dropdown\",3,\"ngModel\",\"ngModelChange\"],[3,\"value\",4,\"ngFor\",\"ngForOf\"],[1,\"ui\",\"labeled\",\"input\"],[1,\"ui\",\"basic\",\"label\"],[\"name\",\"phone\",\"type\",\"text\",1,\"phone\",3,\"ngModel\",\"ngModelChange\"],[\"mat-dialog-actions\",\"\",1,\"w-100\",\"d-flex\",\"flex-row\",\"justify-content-around\",\"align-items-center\"],[1,\"ui\",\"gray\",\"button\",3,\"click\"],[1,\"ui\",\"orange\",\"button\",3,\"click\"],[3,\"value\"]],template:function(rf,ctx){1&rf&&(core.Wb(0,\"div\",0),core.Wb(1,\"div\",1),core.Rb(2,\"img\",2),core.Rb(3,\"img\",3),core.Vb(),core.Wb(4,\"p\",4),core.Uc(5,\"Paiement en point de relai\"),core.Vb(),core.Vb(),core.Wb(6,\"div\",5),core.Wb(7,\"div\",6),core.Wb(8,\"label\"),core.Uc(9,\"Prénom\"),core.Vb(),core.Wb(10,\"input\",7),core.ic(\"ngModelChange\",(function($event){return ctx.payer.firstName=$event})),core.Vb(),core.Vb(),core.Wb(11,\"div\",6),core.Wb(12,\"label\"),core.Uc(13,\"Nom\"),core.Vb(),core.Wb(14,\"input\",8),core.ic(\"ngModelChange\",(function($event){return ctx.payer.lastName=$event})),core.Vb(),core.Vb(),core.Wb(15,\"div\",9),core.Wb(16,\"label\"),core.Uc(17,\"Pays\"),core.Vb(),core.Wb(18,\"select\",10),core.ic(\"ngModelChange\",(function($event){return ctx.payer.countryCode=$event})),core.Sc(19,CashPaymentComponent_option_19_Template,2,2,\"option\",11),core.Vb(),core.Vb(),core.Wb(20,\"div\",6),core.Wb(21,\"label\"),core.Uc(22,\"Téléphone\"),core.Vb(),core.Wb(23,\"div\",12),core.Wb(24,\"div\",13),core.Rb(25,\"i\"),core.Uc(26),core.Vb(),core.Wb(27,\"input\",14),core.ic(\"ngModelChange\",(function($event){return ctx.payer.telephone=$event})),core.Vb(),core.Vb(),core.Vb(),core.Wb(28,\"div\",15),core.Wb(29,\"button\",16),core.ic(\"click\",(function(){return ctx.cancelRequest()})),core.Uc(30,\"Annuler\"),core.Vb(),core.Wb(31,\"button\",17),core.ic(\"click\",(function(){return ctx.validateRequest()})),core.Uc(32,\"Valider\"),core.Vb(),core.Vb(),core.Vb()),2&rf&&(core.Cb(6),core.uc(\"ngClass\",ctx.loading?\"loading\":\"\"),core.Cb(4),core.uc(\"ngModel\",ctx.payer.firstName),core.Cb(4),core.uc(\"ngModel\",ctx.payer.lastName),core.Cb(4),core.uc(\"ngModel\",ctx.payer.countryCode),core.Cb(1),core.uc(\"ngForOf\",ctx.countries),core.Cb(6),core.Fb(\"\",ctx.payer.countryCode.toLowerCase(),\" flag\"),core.Cb(1),core.Wc(\"\",ctx.getCountryDialingCode(),\" \"),core.Cb(1),core.uc(\"ngModel\",ctx.payer.telephone))},directives:[fesm2015_dialog.h,fesm2015_dialog.e,common.o,fesm2015_forms.c,fesm2015_forms.n,fesm2015_forms.q,fesm2015_forms.v,common.p,fesm2015_dialog.c,fesm2015_forms.r,fesm2015_forms.x],styles:[\"\"]}),CashPaymentComponent})();var event_nomination_model=__webpack_require__(\"FfJ/\"),fesm2015_router=__webpack_require__(\"tyNb\");let payment_component_PaymentComponent=(()=>{class PaymentComponent{constructor(cashMatDialog,router){this.cashMatDialog=cashMatDialog,this.router=router,this.loader=new core.n}openCashPaymentDialog(){this.cashMatDialog.open(cash_payment_component_CashPaymentComponent,{width:window.innerWidth>400?\"400px\":\"360px\",height:\"max-content\",hasBackdrop:!0,disableClose:!0,closeOnNavigation:!0,data:{payer:new event_nomination_model.a,price:this.paymentRequest.item_price}}).afterClosed().subscribe(()=>{status&&this.router.navigate([\"/\"])})}pay(){const url=new url_config.a;this.loader.emit(!0),new PayExpresse({body:JSON.stringify(this.paymentRequest)}).withOption({requestTokenUrl:`${url.mainHost}${url.payExpressPaymentRequest}`,method:\"POST\",headers:{Accept:\"application/json\",\"Content-Type\":\"application/json\"},prensentationMode:PayExpresse.OPEN_IN_POPUP,didReceiveNonSuccessResponse(jsonResponse){if(jsonResponse.message.toString().includes(\"[\")){const x=jsonResponse.message.toString().split(\"[\");x[0]=\"\";const y=JSON.parse(x.join(\"\").slice(0,x.join(\"\").length-1).replace(\"]\",\"\"));jsonResponse.error=y.message,jsonResponse.message=y.error}(new Swal_config.a).ErrorSwalWithNoReturn(jsonResponse.error,jsonResponse.message)}}).send()}}return PaymentComponent.ɵfac=function(t){return new(t||PaymentComponent)(core.Qb(fesm2015_dialog.b),core.Qb(fesm2015_router.c))},PaymentComponent.ɵcmp=core.Kb({type:PaymentComponent,selectors:[[\"app-payment\"]],inputs:{payer:\"payer\",paymentRequest:\"paymentRequest\"},outputs:{loader:\"loader\"},decls:5,vars:0,consts:[[1,\"w-100\",\"d-flex\",\"flex-row\",\"justify-content-around\"],[1,\"cursor-pointer\",3,\"click\"],[\"alt\",\"logo cash payment\",\"src\",\"../../../assets/images/icons/cash.jpg\",\"width\",\"150px\"],[\"alt\",\"Pay with PayExpress\",\"src\",\"../../../assets/images/icons/payexpress.jpg\",\"width\",\"150px\"]],template:function(rf,ctx){1&rf&&(core.Wb(0,\"div\",0),core.Wb(1,\"div\",1),core.ic(\"click\",(function(){return ctx.openCashPaymentDialog()})),core.Rb(2,\"img\",2),core.Vb(),core.Wb(3,\"div\",1),core.ic(\"click\",(function(){return ctx.pay()})),core.Rb(4,\"img\",3),core.Vb(),core.Vb())},styles:[\"\"]}),PaymentComponent})()}}]);","extractedComments":[]}