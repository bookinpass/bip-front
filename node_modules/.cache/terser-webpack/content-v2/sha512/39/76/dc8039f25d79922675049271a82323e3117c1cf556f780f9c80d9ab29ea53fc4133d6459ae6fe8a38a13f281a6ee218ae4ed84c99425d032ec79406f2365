{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{DrXB:function(module,__webpack_exports__,__webpack_require__){\"use strict\";__webpack_require__.d(__webpack_exports__,\"a\",(function(){return MustMatch})),__webpack_require__.d(__webpack_exports__,\"b\",(function(){return OptionalValidator})),__webpack_require__.d(__webpack_exports__,\"c\",(function(){return ValidPhone}));var _angular_forms__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(\"3Pt+\"),libphonenumber_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(\"PoRY\");function MustMatch(controlName,matchingControlName){return formGroup=>{const matchingControl=formGroup.controls[matchingControlName];matchingControl.errors&&!matchingControl.errors.mustMatch||matchingControl.setErrors(formGroup.controls[controlName].value!==matchingControl.value?{mustMatch:!0}:null)}}function OptionalValidator(validators){return control=>control.value?_angular_forms__WEBPACK_IMPORTED_MODULE_0__.w.compose(validators)(control):null}function ValidPhone(countryCodeControlName,telephoneControlName){return formGroup=>{const country=formGroup.controls[countryCodeControlName],telephone=formGroup.controls[telephoneControlName];telephone.errors&&!telephone.errors.checkTelephone||country.errors&&!telephone.errors.required||(Object(libphonenumber_js__WEBPACK_IMPORTED_MODULE_1__.c)(telephone.value,country.value.toUpperCase())?telephone.setErrors(null):telephone.setErrors({validPhone:!0}))}}},oVPa:function(module,__webpack_exports__,__webpack_require__){\"use strict\";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,\"PaymentModule\",(function(){return payment_module_PaymentModule}));var core=__webpack_require__(\"fXoL\"),common=__webpack_require__(\"ofXK\"),router=__webpack_require__(\"tyNb\");const routes=[{path:\"\",component:__webpack_require__(\"ywLJ\").a}];let payment_routing_module_PaymentRoutingModule=(()=>{class PaymentRoutingModule{}return PaymentRoutingModule.ɵmod=core.Pb({type:PaymentRoutingModule}),PaymentRoutingModule.ɵinj=core.Ob({factory:function(t){return new(t||PaymentRoutingModule)},imports:[[router.g.forChild(routes)],router.g]}),PaymentRoutingModule})();var global_error_handler_service=__webpack_require__(\"AXpb\"),fesm2015_forms=__webpack_require__(\"3Pt+\"),dialog=__webpack_require__(\"0IaG\");let payment_module_PaymentModule=(()=>{class PaymentModule{}return PaymentModule.ɵmod=core.Pb({type:PaymentModule}),PaymentModule.ɵinj=core.Ob({factory:function(t){return new(t||PaymentModule)},providers:[{provide:core.m,useClass:global_error_handler_service.a}],imports:[[common.c,payment_routing_module_PaymentRoutingModule,fesm2015_forms.i,dialog.f]]}),PaymentModule})()},ywLJ:function(module,__webpack_exports__,__webpack_require__){\"use strict\";__webpack_require__.d(__webpack_exports__,\"a\",(function(){return payment_component_PaymentComponent}));var core=__webpack_require__(\"fXoL\"),url_config=__webpack_require__(\"QnqH\"),Swal_config=__webpack_require__(\"BapT\"),Country_FR_json=__webpack_require__(\"QmTJ\"),Country_json=__webpack_require__(\"MsxN\"),scavenger=__webpack_require__(\"+0XT\"),sweetalert2_all=__webpack_require__(\"PSD3\"),sweetalert2_all_default=__webpack_require__.n(sweetalert2_all),index_es6=__webpack_require__(\"PoRY\"),fesm2015_dialog=__webpack_require__(\"0IaG\"),addHours=__webpack_require__(\"Da6A\"),retry=__webpack_require__(\"un/a\"),common=__webpack_require__(\"ofXK\"),fesm2015_http=__webpack_require__(\"tk/3\");let currency_service_CurrencyService=(()=>{class CurrencyService{constructor(http){this.http=http,this.config=new url_config.a}getCurrencyConverterRate(from,to,amount){const param=new fesm2015_http.f({fromObject:{format:\"json\",from:from,to:to,amount:amount.toString()}}),header=new fesm2015_http.e({\"x-rapidapi-host\":\"currency-converter5.p.rapidapi.com\",\"x-rapidapi-key\":\"67568f8200msh5098fd2bce948a2p156272jsn548d1cf520b5\"});return this.http.get(\"https://currency-converter5.p.rapidapi.com/currency/convert\",{headers:header,params:param})}sendNotificationSMS(tel,msg){return tel=tel.replace(\"+\",\"\"),this.http.post(`${this.config.eventHost}${this.config.sendSmsNotification}?telephone=${tel}`,JSON.stringify(msg))}}return CurrencyService.ɵfac=function(t){return new(t||CurrencyService)(core.bc(fesm2015_http.b))},CurrencyService.ɵprov=core.Nb({token:CurrencyService,factory:CurrencyService.ɵfac,providedIn:\"root\"}),CurrencyService})();var fesm2015_forms=__webpack_require__(\"3Pt+\");function CashPaymentComponent_option_19_Template(rf,ctx){if(1&rf&&(core.Xb(0,\"option\",18),core.Rc(1),core.Wb()),2&rf){const country_r320=ctx.$implicit;core.rc(\"value\",country_r320.code),core.Db(1),core.Sc(country_r320.name)}}let cash_payment_component_CashPaymentComponent=(()=>{class CashPaymentComponent{constructor(dialogRef,data,datePipe,currency){this.dialogRef=dialogRef,this.data=data,this.datePipe=datePipe,this.currency=currency,this.loading=!1,this.countries=(new Country_FR_json.a).countries,this.status=!1,this.scavenger=new scavenger.Scavenger(this)}ngOnInit(){this.payer=this.data.payer,this.price=this.data.price}ngOnDestroy(){}getCountryDialingCode(){return(new Country_json.a).countries.find(x=>x.code.equalIgnoreCase(this.payer.countryCode)).dial_code}cancelRequest(){sweetalert2_all_default.a.fire(\"Annulé\",\"Vous avez annulé le processus de paiement\",\"info\").then(res=>{res&&(this.data.status=\"canceled\",this.dialogRef.close(this.status))})}validateRequest(){this.checkPhoneNumber()?(this.loading=!0,setTimeout(()=>{sweetalert2_all_default.a.fire({title:\"Cash payment\",html:'<p class=\"text-center\">Votre reservation a été enregistrée. Un message vous sera envoyé avec le code de rérservation suivant: SN892JI7P<br/><br/>Rendez vous dans le point relais le plus proche pour valider votre reservation avant le '+this.datePipe.transform(Object(addHours.a)(new Date,5),\"EEEE, dd MMMM yyyy à HH:mm\")+\"</p>\",icon:\"success\",showCancelButton:!1,confirmButtonText:\"OK\",allowEnterKey:!0,allowOutsideClick:!1,allowEscapeKey:!1}).then(res=>{if(res){this.loading=!1,this.status=!0;const sms=\"Bonjour, votre réservation a bien été enregistrée. Numéro de votre dossier: SN892JI7P. Rendez-vous au point de relai le plus proche.\",tel=(new Country_json.a).countries.find(x=>x.code===this.payer.countryCode).dial_code.replace(\"+\",\"\").concat(this.payer.telephone);this.currency.sendNotificationSMS(tel,sms).pipe(this.scavenger.collect(),Object(retry.a)(2)).subscribe(()=>this.dialogRef.close(this.status))}})},1e3)):sweetalert2_all_default.a.fire(\"Erreur\",\"Ce numero de telephone ne represente pas un numero valide pour le \"+this.countries.find(x=>x.code.equalIgnoreCase(this.payer.countryCode)).name)}checkPhoneNumber(){return Object(index_es6.d)(this.payer.telephone,this.payer.countryCode)}}return CashPaymentComponent.ɵfac=function(t){return new(t||CashPaymentComponent)(core.Rb(fesm2015_dialog.g),core.Rb(fesm2015_dialog.a),core.Rb(common.f),core.Rb(currency_service_CurrencyService))},CashPaymentComponent.ɵcmp=core.Lb({type:CashPaymentComponent,selectors:[[\"app-cash-payment\"]],decls:33,vars:10,consts:[[\"mat-dialog-title\",\"\",1,\"d-flex\",\"flex-column\",\"justify-content-start\",\"mb-2\"],[1,\"d-flex\",\"flex-row\",\"justify-content-between\"],[\"alt\",\"logo BIP\",\"height\",\"80px\",\"src\",\"../../../../assets/images/logo/bip-logo.png\",\"width\",\"130px\"],[\"alt\",\"logo paiement en espece\",\"height\",\"80px\",\"src\",\"../../../../assets/images/icons/cash.jpg\",\"width\",\"80px\"],[1,\"payment-text\"],[\"mat-dialog-content\",\"\",1,\"ui\",\"form\",\"w-100\",\"m-0\",\"p-0\",3,\"ngClass\"],[1,\"ui\",\"required\",\"field\"],[\"name\",\"firstName\",\"type\",\"text\",3,\"ngModel\",\"ngModelChange\"],[\"name\",\"lastName\",\"type\",\"text\",3,\"ngModel\",\"ngModelChange\"],[1,\"field\"],[1,\"ui\",\"compact\",\"selection\",\"dropdown\",3,\"ngModel\",\"ngModelChange\"],[3,\"value\",4,\"ngFor\",\"ngForOf\"],[1,\"ui\",\"labeled\",\"input\"],[1,\"ui\",\"basic\",\"label\"],[\"name\",\"phone\",\"type\",\"text\",1,\"phone\",3,\"ngModel\",\"ngModelChange\"],[\"mat-dialog-actions\",\"\",1,\"w-100\",\"d-flex\",\"flex-row\",\"justify-content-around\",\"align-items-center\"],[1,\"ui\",\"gray\",\"button\",3,\"click\"],[1,\"ui\",\"orange\",\"button\",3,\"click\"],[3,\"value\"]],template:function(rf,ctx){1&rf&&(core.Xb(0,\"div\",0),core.Xb(1,\"div\",1),core.Sb(2,\"img\",2),core.Sb(3,\"img\",3),core.Wb(),core.Xb(4,\"p\",4),core.Rc(5,\"Paiement en point de relai\"),core.Wb(),core.Wb(),core.Xb(6,\"div\",5),core.Xb(7,\"div\",6),core.Xb(8,\"label\"),core.Rc(9,\"Prénom\"),core.Wb(),core.Xb(10,\"input\",7),core.fc(\"ngModelChange\",(function($event){return ctx.payer.firstName=$event})),core.Wb(),core.Wb(),core.Xb(11,\"div\",6),core.Xb(12,\"label\"),core.Rc(13,\"Nom\"),core.Wb(),core.Xb(14,\"input\",8),core.fc(\"ngModelChange\",(function($event){return ctx.payer.lastName=$event})),core.Wb(),core.Wb(),core.Xb(15,\"div\",9),core.Xb(16,\"label\"),core.Rc(17,\"Pays\"),core.Wb(),core.Xb(18,\"select\",10),core.fc(\"ngModelChange\",(function($event){return ctx.payer.countryCode=$event})),core.Pc(19,CashPaymentComponent_option_19_Template,2,2,\"option\",11),core.Wb(),core.Wb(),core.Xb(20,\"div\",6),core.Xb(21,\"label\"),core.Rc(22,\"Téléphone\"),core.Wb(),core.Xb(23,\"div\",12),core.Xb(24,\"div\",13),core.Sb(25,\"i\"),core.Rc(26),core.Wb(),core.Xb(27,\"input\",14),core.fc(\"ngModelChange\",(function($event){return ctx.payer.telephone=$event})),core.Wb(),core.Wb(),core.Wb(),core.Xb(28,\"div\",15),core.Xb(29,\"button\",16),core.fc(\"click\",(function(){return ctx.cancelRequest()})),core.Rc(30,\"Annuler\"),core.Wb(),core.Xb(31,\"button\",17),core.fc(\"click\",(function(){return ctx.validateRequest()})),core.Rc(32,\"Valider\"),core.Wb(),core.Wb(),core.Wb()),2&rf&&(core.Db(6),core.rc(\"ngClass\",ctx.loading?\"loading\":\"\"),core.Db(4),core.rc(\"ngModel\",ctx.payer.firstName),core.Db(4),core.rc(\"ngModel\",ctx.payer.lastName),core.Db(4),core.rc(\"ngModel\",ctx.payer.countryCode),core.Db(1),core.rc(\"ngForOf\",ctx.countries),core.Db(6),core.Gb(\"\",ctx.payer.countryCode.toLowerCase(),\" flag\"),core.Db(1),core.Tc(\"\",ctx.getCountryDialingCode(),\" \"),core.Db(1),core.rc(\"ngModel\",ctx.payer.telephone))},directives:[fesm2015_dialog.h,fesm2015_dialog.e,common.n,fesm2015_forms.c,fesm2015_forms.n,fesm2015_forms.q,fesm2015_forms.v,common.o,fesm2015_dialog.c,fesm2015_forms.r,fesm2015_forms.x],styles:[\"\"]}),CashPaymentComponent})();var event_nomination_model=__webpack_require__(\"FfJ/\"),fesm2015_router=__webpack_require__(\"tyNb\");let payment_component_PaymentComponent=(()=>{class PaymentComponent{constructor(cashMatDialog,router){this.cashMatDialog=cashMatDialog,this.router=router,this.loader=new core.n}openCashPaymentDialog(){this.cashMatDialog.open(cash_payment_component_CashPaymentComponent,{width:window.innerWidth>400?\"400px\":\"360px\",height:\"max-content\",hasBackdrop:!0,disableClose:!0,closeOnNavigation:!0,data:{payer:new event_nomination_model.a,price:this.paymentRequest.item_price}}).afterClosed().subscribe(()=>{status&&this.router.navigate([\"/\"])})}pay(){this.loader.emit(!0),new PayExpresse({body:JSON.stringify(this.paymentRequest)}).withOption({requestTokenUrl:`${(new url_config.a).eventHost}/request-payment`,method:\"POST\",headers:{Accept:\"application/json\",\"Content-Type\":\"application/json\"},prensentationMode:PayExpresse.OPEN_IN_POPUP,didReceiveNonSuccessResponse(jsonResponse){if(jsonResponse.message.toString().includes(\"[\")){const x=jsonResponse.message.toString().split(\"[\");x[0]=\"\";const y=JSON.parse(x.join(\"\").slice(0,x.join(\"\").length-1).replace(\"]\",\"\"));jsonResponse.error=y.message,jsonResponse.message=y.error}(new Swal_config.a).ErrorSwalWithNoReturn(jsonResponse.error,jsonResponse.message)}}).send()}}return PaymentComponent.ɵfac=function(t){return new(t||PaymentComponent)(core.Rb(fesm2015_dialog.b),core.Rb(fesm2015_router.c))},PaymentComponent.ɵcmp=core.Lb({type:PaymentComponent,selectors:[[\"app-payment\"]],inputs:{payer:\"payer\",paymentRequest:\"paymentRequest\"},outputs:{loader:\"loader\"},decls:5,vars:0,consts:[[1,\"w-100\",\"d-flex\",\"flex-row\",\"justify-content-around\"],[1,\"cursor-pointer\",3,\"click\"],[\"alt\",\"logo cash payment\",\"src\",\"../../../assets/images/icons/cash.jpg\"],[\"alt\",\"Pay with PayExpress\",\"src\",\"../../../assets/images/icons/payexpress.jpg\"]],template:function(rf,ctx){1&rf&&(core.Xb(0,\"div\",0),core.Xb(1,\"div\",1),core.fc(\"click\",(function(){return ctx.openCashPaymentDialog()})),core.Sb(2,\"img\",2),core.Wb(),core.Xb(3,\"div\",1),core.fc(\"click\",(function(){return ctx.pay()})),core.Sb(4,\"img\",3),core.Wb(),core.Wb())},styles:[\"\"]}),PaymentComponent})()}}]);","extractedComments":[]}